<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agent Visualizer - AI Agent Â∑•‰ΩúÊµÅÁ®ãÂèØËßÜÂåñ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --border-color: #475569;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #8b5cf6;
            --accent-hover: #7c3aed;
            --success: #22c55e;
            --warning: #eab308;
            --error: #ef4444;
            --waiting: #6b7280;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        /* È°∂ÈÉ®ÊéßÂà∂Ê†è */
        .control-bar {
            height: 60px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }

        .control-bar h1 {
            font-size: 18px;
            font-weight: 600;
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #16a34a;
        }

        .btn-danger {
            background: var(--error);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Ëá™Âä®‰øùÂ≠òÊåáÁ§∫Âô® */
        .auto-save-indicator {
            font-size: 12px;
            padding: 4px 10px;
            border-radius: 12px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            transition: all 0.3s;
        }

        .auto-save-indicator.saved {
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
        }

        .auto-save-indicator.saving {
            background: rgba(234, 179, 8, 0.2);
            color: var(--warning);
        }

        /* ‰∏ªÂ∏ÉÂ±Ä */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Â∑¶‰æß Agent ÂàóË°® */
        .agent-list {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 16px;
            overflow-y: auto;
        }

        .agent-list h2 {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Agent ÂàÜÁªÑÊ†∑Âºè */
        .agent-group {
            margin-bottom: 12px;
        }

        .agent-group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            cursor: pointer;
            margin-bottom: 8px;
        }

        .agent-group-header:hover {
            background: var(--border-color);
        }

        .agent-group-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 500;
        }

        .agent-group-count {
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-primary);
            padding: 2px 8px;
            border-radius: 10px;
        }

        .agent-group-actions {
            display: flex;
            gap: 4px;
        }

        .agent-group-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .agent-group-btn:hover {
            background: var(--accent);
            color: white;
        }

        .agent-group-btn.delete:hover {
            background: var(--error);
        }

        .agent-group-items {
            padding-left: 8px;
        }

        .agent-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
            border: 1px solid transparent;
        }

        .agent-item:hover {
            background: var(--bg-tertiary);
        }

        /* Agent ËäÇÁÇπËøûÊé•ÁÇπ */
        .agent-node .connect-point {
            transition: opacity 0.2s;
        }

        .agent-node:hover .connect-point {
            opacity: 1 !important;
        }

        .agent-item.active {
            background: var(--bg-tertiary);
            border-color: var(--accent);
        }

        .agent-avatar {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
        }

        .agent-info {
            flex: 1;
        }

        .agent-name {
            font-weight: 500;
            font-size: 14px;
        }

        .agent-role {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .agent-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .status-running { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .status-waiting { background: var(--warning); }
        .status-completed { background: var(--waiting); }
        .status-failed { background: var(--error); }

        /* ÊâπÈáèÈÄâÊã©Ê†∑Âºè */
        .agent-checkbox {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--bg-tertiary);
            color: var(--accent);
        }

        .agent-checkbox.checked {
            background: var(--accent);
            border-color: var(--accent);
            color: white;
        }

        .agent-item.selected {
            background: rgba(139, 92, 246, 0.2);
            border-color: var(--accent);
        }

        .btn-accent {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            border: none;
        }

        .btn-accent:hover {
            opacity: 0.9;
            transform: scale(1.02);
        }

        /* ‰∏≠Èó¥ÂèØËßÜÂåñÂå∫Âüü */
        .visualization {
            flex: 1;
            position: relative;
            background: var(--bg-primary);
            overflow: hidden;
        }

        .visualization canvas {
            width: 100%;
            height: 100%;
        }

        #threeCanvas {
            position: absolute;
            top: 0;
            left: 0;
        }

        /* 3D ËßÜÂõæÊéßÂà∂ÊèêÁ§∫ */
        .view-hint {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            color: var(--text-secondary);
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .view-hint.show {
            opacity: 1;
        }

        .empty-state {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-secondary);
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Âè≥‰æßËØ¶ÊÉÖÈù¢Êùø */
        .details-panel {
            width: 320px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            padding: 16px;
            overflow-y: auto;
        }

        .details-panel.collapsed {
            width: 0;
            padding: 0;
            overflow: hidden;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .panel-header h2 {
            font-size: 16px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 20px;
        }

        .detail-section {
            margin-bottom: 20px;
        }

        .detail-section h3 {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .detail-label {
            color: var(--text-secondary);
            font-size: 13px;
        }

        .detail-value {
            font-size: 13px;
            font-weight: 500;
        }

        .message-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .message-item {
            padding: 12px;
            background: var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }

        .message-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .message-from {
            color: var(--accent);
            font-weight: 500;
        }

        .message-to {
            color: var(--success);
        }

        .message-time {
            color: var(--text-secondary);
        }

        .message-content {
            font-size: 13px;
            line-height: 1.5;
            color: var(--text-secondary);
        }

        /* Êó∂Èó¥Á∫ø */
        .timeline {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-secondary);
            padding: 12px 20px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .timeline-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .timeline-btn:hover {
            background: var(--accent);
        }

        .timeline-progress {
            width: 200px;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            cursor: pointer;
        }

        .timeline-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), #ec4899);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s;
        }

        .timeline-time {
            font-size: 13px;
            color: var(--text-secondary);
            min-width: 80px;
        }

        /* Ê∑ªÂä† Agent ÊåâÈíÆ */
        .add-agent-btn {
            width: 100%;
            padding: 12px;
            border: 2px dashed var(--border-color);
            border-radius: 10px;
            background: transparent;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 12px;
        }

        .add-agent-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* ÊãñÊãΩËßíËâ≤Âç°Áâå */
        .role-cards {
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid var(--border-color);
        }

        .role-cards-title {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-card {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            border-radius: 8px;
            cursor: grab;
            transition: all 0.2s;
            margin-bottom: 8px;
            background: var(--bg-tertiary);
            border: 1px solid transparent;
        }

        .role-card:hover {
            border-color: var(--accent);
            transform: translateX(4px);
        }

        .role-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }

        .role-card-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }

        .role-card-info {
            flex: 1;
        }

        .role-card-name {
            font-size: 13px;
            font-weight: 500;
        }

        .role-card-role {
            font-size: 11px;
            color: var(--text-secondary);
        }

        /* ÊãñÊãΩÊîæÁΩÆÂå∫Âüü */
        .visualization.drag-over {
            background: rgba(139, 92, 246, 0.1);
        }

        .visualization.drag-over::after {
            content: 'ÊãñÊîæÂà∞ËøôÈáåÂàõÂª∫ Agent';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: var(--accent);
            padding: 20px 40px;
            border: 2px dashed var(--accent);
            border-radius: 12px;
            background: var(--bg-secondary);
            pointer-events: none;
            z-index: 100;
        }

        .drop-indicator {
            position: absolute;
            width: 80px;
            height: 80px;
            border: 3px dashed var(--accent);
            border-radius: 12px;
            background: rgba(139, 92, 246, 0.2);
            pointer-events: none;
            display: none;
            justify-content: center;
            align-items: center;
            color: var(--accent);
            font-size: 24px;
        }

        .drop-indicator.show {
            display: flex;
        }

        /* ÊãñÊãΩËøûÊé•Á∫ø */
        .connection-line {
            stroke: var(--accent);
            stroke-width: 2;
            stroke-dasharray: 5, 5;
            fill: none;
            pointer-events: none;
        }

        .connection-preview {
            stroke: var(--accent);
            stroke-width: 3;
            stroke-dasharray: 8, 4;
            fill: none;
            pointer-events: none;
            opacity: 0.8;
        }

        /* ËøûÊé•ÊèêÁ§∫ */
        .connect-hint {
            position: absolute;
            background: var(--bg-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--text-secondary);
            pointer-events: none;
            z-index: 50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* ËøûÊé•Ê∂àÊÅØ Modal */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .message-modal.show {
            display: flex;
        }

        .message-modal .modal {
            width: 450px;
        }

        .message-modal textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 14px;
            resize: vertical;
            margin-bottom: 16px;
        }

        .message-modal textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .connection-preview-area {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
        }

        .connection-preview-from {
            color: var(--accent);
            font-weight: 500;
        }

        .connection-preview-to {
            color: var(--success);
            font-weight: 500;
        }

        /* Âä®Áîª */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes flow {
            0% { stroke-dashoffset: 20; }
            100% { stroke-dashoffset: 0; }
        }

        .flowing {
            stroke-dasharray: 10, 10;
            animation: flow 1s linear infinite;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* API Key Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 16px;
            width: 500px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .modal-header h2 {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-close:hover {
            color: var(--text-primary);
        }

        .modal-body {
            padding: 20px;
            max-height: 60vh;
            overflow-y: auto;
        }

        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .template-card {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .template-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
        }

        .template-card-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .template-icon {
            font-size: 24px;
        }

        .template-name {
            font-weight: 600;
            font-size: 14px;
        }

        .template-desc {
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .template-agents {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-top: 10px;
        }

        .template-agent-tag {
            background: var(--bg-secondary);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            color: var(--text-secondary);
        }

        .import-drop-zone {
            border: 2px dashed var(--border-color);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
        }

        .import-drop-zone:hover,
        .import-drop-zone.drag-over {
            border-color: var(--accent);
            background: rgba(139, 92, 246, 0.1);
        }

        .import-drop-zone svg {
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .import-drop-zone p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .btn-accent {
            background: linear-gradient(135deg, #8b5cf6, #ec4899);
            color: white;
            border: none;
        }

        .btn-accent:hover {
            opacity: 0.9;
        }

        .api-provider {
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .provider-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .provider-name {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .provider-status {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .provider-status.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }

        .provider-status.inactive {
            background: var(--waiting);
        }

        .api-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
            font-family: monospace;
        }

        .api-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .api-input::placeholder {
            color: var(--text-secondary);
        }

        .provider-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .modal-footer {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-input {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-input::placeholder {
            color: var(--text-secondary);
        }

        textarea.form-input {
            resize: vertical;
            min-height: 80px;
        }

        .my-template-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 12px;
            background: var(--bg-primary);
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .my-template-item:hover {
            background: var(--bg-tertiary);
        }

        .my-template-info {
            flex: 1;
        }

        .my-template-name {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .my-template-desc {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .my-template-actions {
            display: flex;
            gap: 8px;
        }

        .my-template-btn {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .my-template-btn.load {
            background: var(--accent);
            color: white;
        }

        .my-template-btn.delete {
            background: var(--error);
            color: white;
        }

        .api-key-list {
            margin-top: 12px;
        }

        .api-key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: var(--bg-primary);
            border-radius: 6px;
            margin-bottom: 6px;
            font-size: 12px;
        }

        .api-key-name {
            color: var(--text-secondary);
        }

        .api-key-preview {
            font-family: monospace;
            color: var(--text-secondary);
        }

        .api-key-delete {
            background: none;
            border: none;
            color: var(--error);
            cursor: pointer;
            font-size: 14px;
            padding: 4px;
        }

        .empty-keys {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 13px;
        }

        /* AI ÂØπËØùÈù¢Êùø */
        .ai-chat-panel {
            margin-top: 20px;
            border-top: 1px solid var(--border-color);
            padding-top: 16px;
        }

        .ai-chat-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-model-select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
            margin-bottom: 12px;
            cursor: pointer;
        }

        .ai-model-select:focus {
            outline: none;
            border-color: var(--accent);
        }

        .ai-chat-messages {
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 12px;
        }

        .ai-message {
            padding: 10px 12px;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 13px;
            line-height: 1.5;
        }

        .ai-message-user {
            background: var(--accent);
            color: white;
            margin-left: 20px;
        }

        .ai-message-ai {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            margin-right: 20px;
        }

        .ai-chat-input {
            display: flex;
            gap: 8px;
        }

        .ai-chat-input input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 13px;
        }

        .ai-chat-input input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .ai-chat-input button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: white;
            cursor: pointer;
            font-size: 13px;
        }

        .ai-chat-input button:hover {
            background: var(--accent-hover);
        }

        .ai-chat-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .model-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            margin-left: 8px;
        }

        .model-badge-openai { background: #10a98120; color: #10a981; }
        .model-badge-anthropic { background: #d9770620; color: #d97706; }
        .model-badge-google { background: #4285f420; color: #4285f4; }
        .model-badge-ollama { background: #8b5cf620; color: #8b5cf6; }

        .task-execution-panel {
            margin-top: 16px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            padding: 16px;
        }

        .task-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .task-desc {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .task-input-area textarea {
            width: 100%;
            min-height: 80px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 13px;
            resize: vertical;
            font-family: inherit;
        }

        .task-input-area textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .task-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .task-actions .btn {
            flex: 1;
            padding: 8px 16px;
        }

        .task-result {
            margin-top: 16px;
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            border-left: 3px solid var(--success);
        }

        .task-result-header {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .task-result-content {
            font-size: 13px;
            line-height: 1.6;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <!-- È°∂ÈÉ®ÊéßÂà∂Ê†è -->
    <header class="control-bar">
        <div style="display: flex; align-items: center; gap: 12px;">
            <h1>ü§ñ Agent Visualizer</h1>
            <span id="autoSaveIndicator" class="auto-save-indicator">Â∑≤Ëá™Âä®‰øùÂ≠ò</span>
        </div>
        <div class="controls">
            <button class="btn btn-secondary" onclick="exportPNG()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                ÂØºÂá∫ PNG
            </button>
            <button class="btn btn-secondary" onclick="exportJSON()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                </svg>
                ÂØºÂá∫ JSON
            </button>
            <button class="btn btn-secondary" onclick="openImportModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="17 8 12 3 7 8"/>
                    <line x1="12" y1="3" x2="12" y2="15"/>
                </svg>
                ÂØºÂÖ• JSON
            </button>
            <button class="btn btn-primary" onclick="toggle3DView()" id="viewToggle">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                    <path d="M2 17l10 5 10-5"/>
                    <path d="M2 12l10 5 10-5"/>
                </svg>
                3D ËßÜÂõæ
            </button>
            <button class="btn btn-secondary" onclick="openApiKeysModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/>
                </svg>
                API ÂØÜÈí•
            </button>
            <button class="btn btn-accent" onclick="openCollaborationModal()" id="collaborationBtn" title="ÂÆûÊó∂Âçè‰Ωú">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Âçè‰Ωú
            </button>
            <button class="btn btn-accent" onclick="openTemplateModal()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="3" y1="9" x2="21" y2="9"/>
                    <line x1="9" y1="21" x2="9" y2="9"/>
                </svg>
                È¢ÑËÆæÊ®°Êùø
            </button>
            <button class="btn btn-secondary" onclick="cloneWorkflow()" title="ÂÖãÈöÜÂΩìÂâçÂ∑•‰ΩúÊµÅ">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                </svg>
                ÂÖãÈöÜ
            </button>
            <button class="btn btn-secondary" onclick="openSaveTemplateModal()" title="‰øùÂ≠òÂΩìÂâçÂ∑•‰ΩúÊµÅ‰∏∫Ê®°Êùø">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                    <polyline points="17 21 17 13 7 13 7 21"/>
                    <polyline points="7 3 7 8 15 8"/>
                </svg>
                ‰øùÂ≠òÊ®°Êùø
            </button>
            <button class="btn btn-secondary" onclick="openVersionHistoryModal()" title="ÁâàÊú¨ÂéÜÂè≤">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                </svg>
                ÁâàÊú¨ÂéÜÂè≤
            </button>
            <button class="btn btn-secondary" id="batchSelectBtn" onclick="toggleBatchMode()" title="ÊâπÈáèÈÄâÊã©Ê®°Âºè">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                    <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
                Â§öÈÄâ
            </button>
            <button class="btn btn-danger" id="batchDeleteBtn" onclick="batchDeleteSelected()" style="display:none;" title="Âà†Èô§ÈÄâ‰∏≠ÁöÑ Agent">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="3 6 5 6 21 6"/>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                </svg>
                ÊâπÈáèÂà†Èô§
            </button>
            <button class="btn btn-secondary" onclick="openGroupModal()" title="ÁÆ°ÁêÜ Agent ÂàÜÁªÑ">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                ÂàÜÁªÑ
            </button>
        </div>
    </header>

    <div class="main-container">
        <!-- Â∑¶‰æß Agent ÂàóË°® -->
        <aside class="agent-list">
            <h2>Agent ÂàóË°®</h2>
            <div id="agentList"></div>
            <button class="add-agent-btn" onclick="addNewAgent()">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:inline;vertical-align:middle;margin-right:8px">
                    <line x1="12" y1="5" x2="12" y2="19"/>
                    <line x1="5" y1="12" x2="19" y2="12"/>
                </svg>
                Ê∑ªÂä† Agent
            </button>

            <!-- ÊãñÊãΩËßíËâ≤Âç°Áâå -->
            <div class="role-cards">
                <div class="role-cards-title">üëá ÊãñÊãΩËßíËâ≤ÂàõÂª∫ Agent</div>
                <div id="roleCards"></div>
            </div>
        </aside>

        <!-- ‰∏≠Èó¥ÂèØËßÜÂåñÂå∫Âüü -->
        <main class="visualization" id="visualization">
            <div class="drop-indicator" id="dropIndicator">+</div>
            <canvas id="threeCanvas" style="display:none; width:100%; height:100%;"></canvas>
            <svg id="flowCanvas" width="100%" height="100%">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#8b5cf6"/>
                    </marker>
                    <linearGradient id="lineGradient" x1="0%" y1="0%" x2="100%" y2="0%">
                        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:1" />
                        <stop offset="100%" style="stop-color:#ec4899;stop-opacity:1" />
                    </linearGradient>
                </defs>
                <g id="connections"></g>
                <g id="nodes"></g>
            </svg>
            <div class="empty-state" id="emptyState">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <circle cx="12" cy="12" r="3"/>
                    <circle cx="4" cy="6" r="2"/>
                    <circle cx="20" cy="6" r="2"/>
                    <circle cx="4" cy="18" r="2"/>
                    <circle cx="20" cy="18" r="2"/>
                    <line x1="6" y1="6" x2="9" y2="10"/>
                    <line x1="18" y1="6" x2="15" y2="10"/>
                    <line x1="6" y1="18" x2="9" y2="14"/>
                    <line x1="18" y1="18" x2="15" y2="14"/>
                </svg>
                <p>ÁÇπÂáª"Ê∑ªÂä† Agent"ÂºÄÂßãÂàõÂª∫Â∑•‰ΩúÊµÅÁ®ã</p>
            </div>
            <div class="view-hint" id="viewHint">
                üñ±Ô∏è ÊãñÊãΩÊóãËΩ¨ | ÊªöËΩÆÁº©Êîæ | Âè≥ÈîÆÂπ≥Áßª
            </div>
            <!-- Êó∂Èó¥Á∫ø -->
            <div class="timeline">
                <button class="timeline-btn" onclick="skipToStart()" title="Ë∑≥Âà∞ÂºÄÂßã">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="19 20 9 12 19 4 19 20"/>
                        <line x1="5" y1="19" x2="5" y2="5" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                <button class="timeline-btn" onclick="stepBackward()" title="‰∏ä‰∏ÄÊ≠•">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="11 19 2 12 11 5 11 19"/>
                        <polygon points="22 19 13 12 22 5 22 19"/>
                    </svg>
                </button>
                <button class="timeline-btn" id="playBtn" onclick="togglePlay()" title="Êí≠Êîæ/ÊöÇÂÅú">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" id="playIcon">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                    </svg>
                </button>
                <button class="timeline-btn" onclick="stepForward()" title="‰∏ã‰∏ÄÊ≠•">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="13 19 22 12 13 5 13 19"/>
                        <polygon points="2 19 11 12 2 5 2 19"/>
                    </svg>
                </button>
                <button class="timeline-btn" onclick="skipToEnd()" title="Ë∑≥Âà∞ÁªìÊùü">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 4 15 12 5 20 5 4"/>
                        <line x1="19" y1="5" x2="19" y2="19" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                <div class="timeline-progress" onclick="seekTimeline(event)">
                    <div class="timeline-progress-bar" id="progressBar"></div>
                </div>
                <span class="timeline-time" id="timelineTime">0:00 / 0:00</span>
            </div>
        </main>

        <!-- Âè≥‰æßËØ¶ÊÉÖÈù¢Êùø -->
        <aside class="details-panel" id="detailsPanel">
            <div class="panel-header">
                <h2>ËØ¶ÁªÜ‰ø°ÊÅØ</h2>
                <button class="close-btn" onclick="closeDetails()">√ó</button>
            </div>
            <div id="panelContent">
                <p style="color: var(--text-secondary); text-align: center; padding: 40px 0;">
                    ÈÄâÊã©‰∏Ä‰∏™ Agent Êü•ÁúãËØ¶ÊÉÖ
                </p>
            </div>
        </aside>
    </div>

    <!-- API Keys Modal -->
    <div class="modal-overlay" id="apiKeysModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üîë API ÂØÜÈí•ÁÆ°ÁêÜ</h2>
                <button class="modal-close" onclick="closeApiKeysModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                    ÈÖçÁΩÆÊÇ®ÁöÑ AI ÊúçÂä° API ÂØÜÈí•ÔºåÊîØÊåÅÂ§öÁßçÊ®°ÂûãÊèê‰æõÂïÜ„ÄÇÂØÜÈí•Â≠òÂÇ®Âú®Êú¨Âú∞ÊµèËßàÂô®‰∏≠Ôºå‰∏ç‰ºöÂèëÈÄÅÂà∞‰ªª‰ΩïÊúçÂä°Âô®„ÄÇ
                </p>

                <!-- OpenAI -->
                <div class="api-provider">
                    <div class="provider-header">
                        <span class="provider-name">
                            <span class="provider-status" id="openaiStatus"></span>
                            OpenAI (GPT-4o, GPT-4o mini)
                        </span>
                    </div>
                    <input type="password" class="api-input" id="openaiKey" placeholder="sk-..." oninput="updateKeyStatus('openai')">
                    <div class="provider-actions">
                        <button class="btn btn-success btn-small" onclick="saveApiKey('openai')">‰øùÂ≠ò</button>
                        <button class="btn btn-secondary btn-small" onclick="testApiKey('openai')">ÊµãËØï</button>
                    </div>
                    <div class="api-key-list" id="openaiKeysList"></div>
                </div>

                <!-- Anthropic -->
                <div class="api-provider">
                    <div class="provider-header">
                        <span class="provider-name">
                            <span class="provider-status" id="anthropicStatus"></span>
                            Anthropic (Claude)
                        </span>
                    </div>
                    <input type="password" class="api-input" id="anthropicKey" placeholder="sk-ant-..." oninput="updateKeyStatus('anthropic')">
                    <div class="provider-actions">
                        <button class="btn btn-success btn-small" onclick="saveApiKey('anthropic')">‰øùÂ≠ò</button>
                        <button class="btn btn-secondary btn-small" onclick="testApiKey('anthropic')">ÊµãËØï</button>
                    </div>
                    <div class="api-key-list" id="anthropicKeysList"></div>
                </div>

                <!-- Google -->
                <div class="api-provider">
                    <div class="provider-header">
                        <span class="provider-name">
                            <span class="provider-status" id="googleStatus"></span>
                            Google (Gemini)
                        </span>
                    </div>
                    <input type="password" class="api-input" id="googleKey" placeholder="AIza..." oninput="updateKeyStatus('google')">
                    <div class="provider-actions">
                        <button class="btn btn-success btn-small" onclick="saveApiKey('google')">‰øùÂ≠ò</button>
                        <button class="btn btn-secondary btn-small" onclick="testApiKey('google')">ÊµãËØï</button>
                    </div>
                    <div class="api-key-list" id="googleKeysList"></div>
                </div>

                <!-- Ollama -->
                <div class="api-provider">
                    <div class="provider-header">
                        <span class="provider-name">
                            <span class="provider-status" id="ollamaStatus"></span>
                            Ollama (Êú¨Âú∞Ê®°Âûã)
                        </span>
                    </div>
                    <input type="text" class="api-input" id="ollamaUrl" placeholder="http://localhost:11434" value="http://localhost:11434" oninput="updateKeyStatus('ollama')">
                    <div class="provider-actions">
                        <button class="btn btn-success btn-small" onclick="saveApiKey('ollama')">‰øùÂ≠ò</button>
                        <button class="btn btn-secondary btn-small" onclick="testApiKey('ollama')">ÊµãËØï</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeApiKeysModal()">ÂÖ≥Èó≠</button>
                <button class="btn btn-primary" onclick="exportKeys()">ÂØºÂá∫ÂØÜÈí•</button>
            </div>
        </div>
    </div>

    <!-- ‰øùÂ≠òÊ®°Êùø Modal -->
    <div class="modal-overlay" id="saveTemplateModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üíæ ‰øùÂ≠òÂ∑•‰ΩúÊµÅÊ®°Êùø</h2>
                <button class="modal-close" onclick="closeSaveTemplateModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Ê®°ÊùøÂêçÁß∞ *</label>
                    <input type="text" id="templateName" class="form-input" placeholder="ËæìÂÖ•Ê®°ÊùøÂêçÁß∞ÔºåÂ¶ÇÔºöÊàëÁöÑ‰∫ßÂìÅÂºÄÂèëÊµÅÁ®ã" maxlength="30">
                </div>
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">Ê®°ÊùøÊèèËø∞</label>
                    <textarea id="templateDesc" class="form-input" rows="3" placeholder="ÁÆÄË¶ÅÊèèËø∞Ëøô‰∏™Ê®°ÊùøÁöÑÁî®ÈÄî" maxlength="100"></textarea>
                </div>
                <div class="form-group">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">‰øùÂ≠ò‰ΩçÁΩÆ</label>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-secondary" onclick="saveTemplateToLocal()" style="flex:1;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            </svg>
                            Êú¨Âú∞‰øùÂ≠ò
                        </button>
                        <button class="btn btn-primary" onclick="generateShareLink()" style="flex:1;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="18" cy="5" r="3"/>
                                <circle cx="6" cy="12" r="3"/>
                                <circle cx="18" cy="19" r="3"/>
                                <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                                <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                            </svg>
                            ÁîüÊàêÂàÜ‰∫´ÈìæÊé•
                        </button>
                    </div>
                </div>
                <div id="shareLinkSection" style="display: none; margin-top: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÂàÜ‰∫´ÈìæÊé•</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="shareLinkInput" class="form-input" readonly style="flex:1;">
                        <button class="btn btn-primary" onclick="copyShareLink()">Â§çÂà∂</button>
                    </div>
                    <p style="font-size: 12px; color: var(--text-secondary); margin-top: 8px;">
                        Â§çÂà∂ÈìæÊé•ÂàÜ‰∫´Áªô‰ªñ‰∫∫ÔºåÊâìÂºÄÈìæÊé•Âç≥ÂèØÂØºÂÖ•Ê≠§Ê®°Êùø
                    </p>
                </div>
                <div id="myTemplatesSection" style="margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <label style="display: block; margin-bottom: 12px; font-weight: 500;">üìÅ ÊàëÁöÑÊ®°Êùø</label>
                    <div id="myTemplatesList" style="max-height: 200px; overflow-y: auto;">
                        <p style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px;">ÊöÇÊó†‰øùÂ≠òÁöÑÊ®°Êùø</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSaveTemplateModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ÂàÜÁªÑÁÆ°ÁêÜ Modal -->
    <div class="modal-overlay" id="groupModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üë• Agent ÂàÜÁªÑÁÆ°ÁêÜ</h2>
                <button class="modal-close" onclick="closeGroupModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÂàõÂª∫Êñ∞ÂàÜÁªÑ</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="newGroupName" class="form-input" placeholder="ËæìÂÖ•ÂàÜÁªÑÂêçÁß∞" maxlength="20" style="flex:1;">
                        <input type="color" id="newGroupColor" class="form-input" value="#8b5cf6" style="width: 50px; padding: 4px;">
                        <button class="btn btn-primary" onclick="createGroup()">ÂàõÂª∫</button>
                    </div>
                </div>
                <div id="groupsList" style="max-height: 300px; overflow-y: auto;">
                    <!-- ÂàÜÁªÑÂàóË°®Áî± JS Ê∏≤Êüì -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGroupModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- È¢ÑËÆæÊ®°Êùø Modal -->
    <div class="modal-overlay" id="templateModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2>üìã È¢ÑËÆæÂ∑•‰ΩúÊµÅÁ®ãÊ®°Êùø</h2>
                <button class="modal-close" onclick="closeTemplateModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                    ÈÄâÊã©‰∏Ä‰∏™È¢ÑËÆæÊ®°ÊùøÂø´ÈÄüÂàõÂª∫ AI Agent Â∑•‰ΩúÊµÅ
                </p>
                <div class="template-grid" id="templateGrid">
                    <!-- Ê®°ÊùøÂç°ÁâáÁî± JS Ê∏≤Êüì -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTemplateModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ÂØºÂÖ• JSON Modal -->
    <div class="modal-overlay" id="importModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üì• ÂØºÂÖ•Â∑•‰ΩúÊµÅ</h2>
                <button class="modal-close" onclick="closeImportModal()">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-secondary); font-size: 13px; margin-bottom: 16px;">
                    ÈÄâÊã©‰∏Ä‰∏™ JSON Êñá‰ª∂ÂØºÂÖ•Â∑•‰ΩúÊµÅÈÖçÁΩÆ
                </p>
                <div class="import-drop-zone" id="importDropZone">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                    <p>ÊãñÊãΩ JSON Êñá‰ª∂Âà∞Ê≠§Â§ÑÔºåÊàñÁÇπÂáªÈÄâÊã©Êñá‰ª∂</p>
                    <input type="file" id="importFileInput" accept=".json" style="display: none;">
                </div>
                <div id="importPreview" style="display: none; marginpx;">
                    -top: 16<h4 style="margin-bottom: 8px;">È¢ÑËßà‰ø°ÊÅØÔºö</h4>
                    <div id="importPreviewContent" style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; font-size: 13px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" id="confirmImportBtn" onclick="importJSON()" disabled>ÂØºÂÖ•</button>
            </div>
        </div>
    </div>

    <!-- ÁâàÊú¨ÂéÜÂè≤ Modal -->
    <div class="modal-overlay" id="versionHistoryModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2>üìú ÁâàÊú¨ÂéÜÂè≤</h2>
                <button class="modal-close" onclick="closeVersionHistoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px;">
                    <button class="btn btn-primary" onclick="saveVersion()" style="width: 100%;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        ‰øùÂ≠òÂΩìÂâçÁâàÊú¨
                    </button>
                </div>
                <div id="versionList" style="max-height: 300px; overflow-y: auto;">
                    <p style="color: var(--text-secondary); text-align: center; padding: 20px;">ÊöÇÊó†ÁâàÊú¨ËÆ∞ÂΩï</p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeVersionHistoryModal()">ÂÖ≥Èó≠</button>
                <button class="btn btn-danger" onclick="clearAllVersions()" title="Ê∏ÖÁ©∫ÊâÄÊúâÁâàÊú¨">Ê∏ÖÁ©∫ÂéÜÂè≤</button>
            </div>
        </div>
    </div>

    <!-- ÂÆûÊó∂Âçè‰Ωú Modal -->
    <div class="modal-overlay" id="collaborationModal">
        <div class="modal">
            <div class="modal-header">
                <h2>ü§ù ÂÆûÊó∂Âçè‰Ωú</h2>
                <button class="modal-close" onclick="closeCollaborationModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="collaborationSetup">
                    <div style="margin-bottom: 24px;">
                        <h3 style="margin-bottom: 12px; color: var(--text-primary);">ÂºÄÂßãÊñ∞Âçè‰Ωú</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 13px;">ÂàõÂª∫‰∏Ä‰∏™Âçè‰ΩúÊàøÈó¥ÔºåÂÖ∂‰ªñÁî®Êà∑ÂèØ‰ª•Âä†ÂÖ•Âπ∂ÂÆûÊó∂ÂêåÊ≠•Â∑•‰ΩúÊµÅ</p>
                        <button class="btn btn-primary" onclick="startCollaboration()" style="width: 100%;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 8px;">
                                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <line x1="23" y1="11" x2="17" y2="11"/>
                            </svg>
                            ÂàõÂª∫Âçè‰ΩúÊàøÈó¥
                        </button>
                    </div>
                    <div style="border-top: 1px solid var(--border-color); padding-top: 24px;">
                        <h3 style="margin-bottom: 12px; color: var(--text-primary);">Âä†ÂÖ•Â∑≤ÊúâÂçè‰Ωú</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 16px; font-size: 13px;">ËæìÂÖ•ÊàøÈó¥ ID Âä†ÂÖ•ÂÖ∂‰ªñ‰∫∫ÁöÑÂçè‰Ωú‰ºöËØù</p>
                        <div style="display: flex; gap: 8px;">
                            <input type="text" id="joinSessionId" class="form-input" placeholder="ËæìÂÖ•ÊàøÈó¥ ID" style="flex: 1;">
                            <button class="btn btn-secondary" onclick="joinCollaboration()">Âä†ÂÖ•</button>
                        </div>
                    </div>
                </div>
                <div id="collaborationActive" style="display: none;">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üéâ</div>
                        <h3 style="margin-bottom: 8px; color: var(--text-primary);">Âçè‰ΩúÂ∑≤ÂºÄÂêØ</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">ÊàøÈó¥ IDÔºö<strong id="currentSessionId" style="color: var(--primary);"></strong></p>
                        <button class="btn btn-secondary" onclick="copySessionId()" style="margin-bottom: 16px;">Â§çÂà∂ÊàøÈó¥ ID</button>
                    </div>
                    <div style="border-top: 1px solid var(--border-color); padding-top: 16px;">
                        <h4 style="margin-bottom: 12px; color: var(--text-primary);">Â∑≤ËøûÊé•ÁöÑÊàêÂëò (<span id="peerCount">0</span>)</h4>
                        <div id="peerList" style="max-height: 150px; overflow-y: auto;">
                            <p style="color: var(--text-secondary); text-align: center; padding: 10px;">Á≠âÂæÖÂÖ∂‰ªñÁî®Êà∑Âä†ÂÖ•...</p>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-danger" onclick="leaveCollaboration()" style="width: 100%;">Á¶ªÂºÄÂçè‰Ωú</button>
                    </div>
                </div>
                <div id="collaborationJoined" style="display: none;">
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 16px;">üëã</div>
                        <h3 style="margin-bottom: 8px; color: var(--text-primary);">Â∑≤Âä†ÂÖ•Âçè‰Ωú</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 16px;">Ê≠£Âú®‰∏éÂÖ∂‰ªñ‰∫∫ÂÆûÊó∂ÂêåÊ≠•Â∑•‰ΩúÊµÅ</p>
                    </div>
                    <div style="border-top: 1px solid var(--border-color); padding-top: 16px;">
                        <h4 style="margin-bottom: 12px; color: var(--text-primary);">ÊàøÈó¥ÊàêÂëò (<span id="joinedPeerCount">0</span>)</h4>
                        <div id="joinedPeerList" style="max-height: 150px; overflow-y: auto;">
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-danger" onclick="leaveCollaboration()" style="width: 100%;">Á¶ªÂºÄÂçè‰Ωú</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeCollaborationModal()">ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <!-- ËøûÊé•Ê∂àÊÅØ Modal -->
    <div class="message-modal" id="messageModal">
        <div class="modal">
            <div class="modal-header">
                <h2>üìù ÂàõÂª∫Ê∂àÊÅØËøûÊé•</h2>
                <button class="modal-close" onclick="closeMessageModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="connection-preview-area">
                    <span class="connection-preview-from" id="connFromName"></span>
                    <span> ‚Üí </span>
                    <span class="connection-preview-to" id="connToName"></span>
                </div>
                <textarea id="messageContent" placeholder="ËæìÂÖ•Ê∂àÊÅØÂÜÖÂÆπ..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeMessageModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="createConnection()">ÂàõÂª∫ËøûÊé•</button>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
        <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
        <script>
        // Three.js 3D Âú∫ÊôØÂèòÈáè
        let scene, camera, renderer, controls;
        let agentMeshes = [];
        let messageParticles = [];
        let is3DMode = false;
        let animationClock;

        // Agent Êï∞ÊçÆ
        let agents = [];
        let messages = [];
        let selectedAgent = null;
        let isPlaying = false;
        let currentTime = 0;
        let animationId = null;

        // È¢ÑËÆæÂ∑•‰ΩúÊµÅÁ®ãÊ®°Êùø
        const workflowTemplates = [
            {
                id: 'product-launch',
                name: '‰∫ßÂìÅÂèëÂ∏É',
                icon: 'üöÄ',
                desc: '‰ªéÈúÄÊ±ÇÂàÜÊûêÂà∞‰∫ßÂìÅ‰∏äÁ∫øÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Developer', 'QA', 'Marketing'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Developer', x: 400, y: 180 },
                    { role: 'QA', x: 600, y: 180 },
                    { role: 'Marketing', x: 400, y: 310 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'Êàë‰ª¨ÈúÄË¶Å‰∏Ä‰∏™Êñ∞‰∫ßÂìÅÁöÑÊäÄÊúØÊñπÊ°à' },
                    { from: 'CTO', to: 'Developer', content: 'ÂºÄÂßãÂºÄÂèëÂ∑•‰Ωú' },
                    { from: 'Developer', to: 'QA', content: 'Êèê‰∫§‰ª£Á†ÅÊµãËØï' },
                    { from: 'QA', to: 'Marketing', content: '‰∫ßÂìÅÊµãËØïÈÄöËøáÔºåÂáÜÂ§áÂèëÂ∏É' }
                ]
            },
            {
                id: 'code-review',
                name: '‰ª£Á†ÅÂÆ°Êü•',
                icon: 'üîç',
                desc: 'ÂºÄÂèëËÄÖÊèê‰∫§‰ª£Á†ÅÔºåCTO ÂÆ°Êü•ÁöÑÂçè‰ΩúÊµÅÁ®ã',
                agents: ['Developer', 'CTO', 'QA'],
                positions: [
                    { role: 'Developer', x: 200, y: 150 },
                    { role: 'CTO', x: 500, y: 150 },
                    { role: 'QA', x: 350, y: 300 }
                ],
                messageFlows: [
                    { from: 'Developer', to: 'CTO', content: 'Êèê‰∫§‰ª£Á†ÅÂÆ°Êü•' },
                    { from: 'CTO', to: 'Developer', content: '‰ª£Á†ÅÂÆ°Êü•ÂèçÈ¶àÔºöÈúÄË¶Å‰ºòÂåñ' },
                    { from: 'Developer', to: 'QA', content: '‰øÆÊîπÂÆåÊàêÔºåÊèê‰∫§ÊµãËØï' }
                ]
            },
            {
                id: 'marketing-campaign',
                name: 'Ëê•ÈîÄÊ¥ªÂä®',
                icon: 'üì¢',
                desc: '‰ªéÂàõÊÑèÁ≠ñÂàíÂà∞ÊâßË°åËêΩÂú∞ÁöÑËê•ÈîÄÊµÅÁ®ã',
                agents: ['Marketing', 'Designer', 'Sales', 'CEO'],
                positions: [
                    { role: 'Marketing', x: 350, y: 50 },
                    { role: 'Designer', x: 200, y: 180 },
                    { role: 'Sales', x: 500, y: 180 },
                    { role: 'CEO', x: 350, y: 310 }
                ],
                messageFlows: [
                    { from: 'Marketing', to: 'Designer', content: 'ÈúÄË¶ÅÂà∂‰ΩúÊ¥ªÂä®ÂÆ£‰º†Á¥†Êùê' },
                    { from: 'Designer', to: 'Marketing', content: 'Á¥†ÊùêÂ∑≤ÂÆåÊàê' },
                    { from: 'Marketing', to: 'Sales', content: 'Ê¥ªÂä®Á¥†ÊùêÂ∑≤ÂáÜÂ§áÂ•Ω' },
                    { from: 'Sales', to: 'CEO', content: 'Ëê•ÈîÄÊ¥ªÂä®ÊïàÊûúÊ±áÊä•' }
                ]
            },
            {
                id: 'research-project',
                name: 'Á†îÁ©∂È°πÁõÆ',
                icon: 'üî¨',
                desc: '‰ªéÂ∏ÇÂú∫Ë∞ÉÁ†îÂà∞‰∫ßÂìÅÊñπÊ°àÁöÑÁ†îÂèëÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'CTO', 'Designer'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'CTO', x: 400, y: 180 },
                    { role: 'Designer', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'Ë∞ÉÁ†îÂ∏ÇÂú∫ÈúÄÊ±Ç' },
                    { from: 'Researcher', to: 'CTO', content: 'Ë∞ÉÁ†îÊä•ÂëäÔºöÊäÄÊúØÂèØË°åÊÄßÂàÜÊûê' },
                    { from: 'CTO', to: 'Designer', content: 'ÊäÄÊúØÊñπÊ°àÁ°ÆÂÆöÔºåÈúÄË¶Å UI ËÆæËÆ°' },
                    { from: 'Researcher', to: 'CEO', content: 'ÊúÄÁªà‰∫ßÂìÅÊñπÊ°à' }
                ]
            },
            {
                id: 'customer-support',
                name: 'ÂÆ¢Êà∑ÊîØÊåÅ',
                icon: 'üí¨',
                desc: 'ÂÆ¢Êà∑ÂèçÈ¶àÂà∞ÈóÆÈ¢òËß£ÂÜ≥ÁöÑÊúçÂä°ÊµÅÁ®ã',
                agents: ['Sales', 'Developer', 'QA', 'CEO'],
                positions: [
                    { role: 'Sales', x: 200, y: 100 },
                    { role: 'Developer', x: 400, y: 100 },
                    { role: 'QA', x: 600, y: 100 },
                    { role: 'CEO', x: 400, y: 250 }
                ],
                messageFlows: [
                    { from: 'Sales', to: 'Developer', content: 'ÂÆ¢Êà∑ÂèçÈ¶àÔºö‰∫ßÂìÅ bug' },
                    { from: 'Developer', to: 'QA', content: '‰øÆÂ§çÂÆåÊàêÔºåÊèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'Sales', content: 'ÊµãËØïÈÄöËøáÔºåÂèØ‰ª•ÂõûÂ§çÂÆ¢Êà∑' },
                    { from: 'Sales', to: 'CEO', content: 'ÂÆ¢Êà∑Êª°ÊÑèÂ∫¶Êä•Âëä' }
                ]
            },
            {
                id: 'sprint-planning',
                name: 'ÊïèÊç∑ÂºÄÂèë',
                icon: '‚ö°',
                desc: 'Sprint ËÆ°Âàí‰ºöËÆÆÂà∞Ëø≠‰ª£‰∫§‰ªòÁöÑÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Developer', 'QA'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Developer', x: 400, y: 180 },
                    { role: 'QA', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'Á°ÆÂÆöÊú¨ Sprint ÁõÆÊ†á' },
                    { from: 'CTO', to: 'Developer', content: 'ÂàÜÈÖçÂºÄÂèë‰ªªÂä°' },
                    { from: 'Developer', to: 'QA', content: 'Êèê‰∫§‰ª£Á†ÅÊµãËØï' },
                    { from: 'QA', to: 'CEO', content: 'Sprint ‰∫§‰ªòÂÆåÊàê' }
                ]
            },
            {
                id: 'pricing-strategy',
                name: 'ÂÆö‰ª∑Á≠ñÁï•',
                icon: 'üíµ',
                desc: '‰∫ßÂìÅÂÆö‰ª∑Âà∞Êî∂ÁõäÂàÜÊûêÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['CEO', 'Sales', 'Researcher', 'CFO'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Sales', x: 200, y: 180 },
                    { role: 'Researcher', x: 400, y: 180 },
                    { role: 'CFO', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'Ë∞ÉÁ†îÂ∏ÇÂú∫Á´û‰∫âÂíåÁî®Êà∑‰ªòË¥πÊÑèÊÑø' },
                    { from: 'Researcher', to: 'Sales', content: 'Â∏ÇÂú∫Ë∞ÉÁ†îÊä•ÂëäÔºöÁ´ûÂìÅÂÆö‰ª∑ÂàÜÊûê' },
                    { from: 'Sales', to: 'CFO', content: 'Êèê‰æõÈîÄÂîÆÈ¢ÑÊúüÂíåÂÆö‰ª∑Âª∫ËÆÆ' },
                    { from: 'CFO', to: 'CEO', content: 'ÊàêÊú¨ÂíåÊî∂ÁõäÂàÜÊûêÊä•Âëä' }
                ]
            },
            {
                id: 'security-audit',
                name: 'ÂÆâÂÖ®ÂÆ°ËÆ°',
                icon: 'üîí',
                desc: '‰ª£Á†ÅÂÆâÂÖ®ÂÆ°Êü•ÂíåÈ£éÈô©ËØÑ‰º∞ÊµÅÁ®ã',
                agents: ['CTO', 'Developer', 'QA', 'Researcher'],
                positions: [
                    { role: 'CTO', x: 400, y: 50 },
                    { role: 'Developer', x: 200, y: 180 },
                    { role: 'QA', x: 400, y: 180 },
                    { role: 'Researcher', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'Developer', content: 'ÈúÄË¶ÅËøõË°åÂÆâÂÖ®‰ª£Á†ÅÂÆ°Êü•' },
                    { from: 'Developer', to: 'QA', content: '‰ª£Á†ÅÂÆâÂÖ®ÂÆ°Êü•Êä•Âëä' },
                    { from: 'QA', to: 'Researcher', content: 'ÂÆâÂÖ®ÊºèÊ¥ûÂàÜÊûê' },
                    { from: 'Researcher', to: 'CTO', content: 'ÂÆâÂÖ®È£éÈô©ËØÑ‰º∞Êä•Âëä' }
                ]
            },
            {
                id: 'product-design',
                name: '‰∫ßÂìÅËÆæËÆ°',
                icon: 'üéØ',
                desc: '‰ªéÈúÄÊ±ÇÂàÜÊûêÂà∞ÂéüÂûãËÆæËÆ°ÁöÑÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'Designer', 'CTO'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'Designer', x: 400, y: 180 },
                    { role: 'CTO', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'Á°ÆÂÆö‰∫ßÂìÅÈúÄÊ±ÇÊñπÂêë' },
                    { from: 'Researcher', to: 'Designer', content: 'Áî®Êà∑ÈúÄÊ±ÇÂàÜÊûêÊä•Âëä' },
                    { from: 'Designer', to: 'CTO', content: '‰∫ßÂìÅÂéüÂûãÂíåÊäÄÊúØÊñπÊ°à' },
                    { from: 'CTO', to: 'CEO', content: 'ÊäÄÊúØÂèØË°åÊÄßËØÑ‰º∞' }
                ]
            },
            {
                id: 'content-marketing',
                name: 'ÂÜÖÂÆπËê•ÈîÄ',
                icon: 'üìù',
                desc: 'ÂÜÖÂÆπÁ≠ñÂàíÂà∞ÂèëÂ∏ÉÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['Marketing', 'Researcher', 'Designer', 'Sales'],
                positions: [
                    { role: 'Marketing', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'Designer', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'Marketing', to: 'Researcher', content: 'Ë∞ÉÁ†îÁõÆÊ†áÁî®Êà∑ÂÖ¥Ë∂£' },
                    { from: 'Researcher', to: 'Designer', content: 'ÂÜÖÂÆπÁ≠ñÁï•Âª∫ËÆÆ' },
                    { from: 'Designer', to: 'Marketing', content: 'ÂÜÖÂÆπÁ¥†ÊùêËÆæËÆ°ÂÆåÊàê' },
                    { from: 'Marketing', to: 'Sales', content: 'ÂÜÖÂÆπÂèëÂ∏ÉËÆ°Âàí' }
                ]
            },
            {
                id: 'hr-onboarding',
                name: 'ÂëòÂ∑•ÂÖ•ËÅå',
                icon: 'üëã',
                desc: 'Êñ∞ÂëòÂ∑•ÂÖ•ËÅåÂà∞ËΩ¨Ê≠£ÁöÑÂÖ®ÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Developer', 'Sales'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Developer', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'ÊäÄÊúØÂ≤ó‰ΩçÊñ∞ÂëòÂ∑•ÂÖ•ËÅåÂÆâÊéí' },
                    { from: 'CTO', to: 'Developer', content: 'ÂØºÂ∏àÂàÜÈÖçÂíåÊäÄÊúØÂüπËÆ≠' },
                    { from: 'Developer', to: 'Sales', content: 'ÊäÄÊúØÂüπËÆ≠ÂÆåÊàêÊä•Âëä' },
                    { from: 'Sales', to: 'CEO', content: 'ÂÖ•ËÅåËØÑ‰º∞ÊÄªÁªì' }
                ]
            },
            {
                id: 'bug-fix',
                name: 'Bug ‰øÆÂ§ç',
                icon: 'üêõ',
                desc: '‰ªé bug ÂèëÁé∞Âà∞‰øÆÂ§ç‰∏äÁ∫øÁöÑÊµÅÁ®ã',
                agents: ['QA', 'Developer', 'CTO', 'Sales'],
                positions: [
                    { role: 'QA', x: 200, y: 100 },
                    { role: 'Developer', x: 400, y: 100 },
                    { role: 'CTO', x: 600, y: 100 },
                    { role: 'Sales', x: 400, y: 250 }
                ],
                messageFlows: [
                    { from: 'QA', to: 'Developer', content: 'Bug Êä•ÂëäÔºöÁîü‰∫ßÁéØÂ¢ÉÂ¥©Ê∫É' },
                    { from: 'Developer', to: 'CTO', content: 'Bug ‰øÆÂ§çÊñπÊ°à' },
                    { from: 'CTO', to: 'QA', content: '‰øÆÂ§çÂÆåÊàêÔºåÊèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'Sales', content: 'Bug Â∑≤‰øÆÂ§çÔºåÂÆ¢Êà∑ÈÄöÁü•' }
                ]
            },
            {
                id: 'user-research',
                name: 'Áî®Êà∑Ë∞ÉÁ†î',
                icon: 'üìä',
                desc: '‰ªéÈúÄÊ±ÇÊî∂ÈõÜÂà∞Áî®Êà∑ÁîªÂÉèÁöÑË∞ÉÁ†îÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'Designer', 'Marketing'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'Designer', x: 400, y: 180 },
                    { role: 'Marketing', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'Á°ÆÂÆöË∞ÉÁ†îÁõÆÊ†áÂíåÈóÆÈ¢ò' },
                    { from: 'Researcher', to: 'Marketing', content: 'ÊâßË°åÁî®Êà∑ËÆøË∞à' },
                    { from: 'Marketing', to: 'Designer', content: 'Áî®Êà∑ÂèçÈ¶àÊï¥ÁêÜ' },
                    { from: 'Researcher', to: 'CEO', content: 'Áî®Êà∑Ë∞ÉÁ†îÊä•Âëä' }
                ]
            },
            {
                id: 'data-analysis',
                name: 'Êï∞ÊçÆÂàÜÊûê',
                icon: 'üìà',
                desc: '‰ªéÊï∞ÊçÆÊî∂ÈõÜÂà∞Ê¥ûÂØüÊä•ÂëäÁöÑÂàÜÊûêÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'CTO', 'Sales'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'CTO', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'ÈúÄË¶ÅÊï∞ÊçÆÂüãÁÇπÊñπÊ°à' },
                    { from: 'CTO', to: 'Researcher', content: 'Êï∞ÊçÆÈááÈõÜÂÆåÊàê' },
                    { from: 'Researcher', to: 'Sales', content: 'Êï∞ÊçÆÂàÜÊûêÊä•Âëä' },
                    { from: 'Researcher', to: 'CEO', content: '‰∏öÂä°Ê¥ûÂØüÂíåÂª∫ËÆÆ' }
                ]
            },
            {
                id: 'product-iteration',
                name: '‰∫ßÂìÅËø≠‰ª£',
                icon: 'üîÑ',
                desc: '‰ªéÈúÄÊ±ÇËØÑÂÆ°Âà∞ÁâàÊú¨ÂèëÂ∏ÉÁöÑËø≠‰ª£ÊµÅÁ®ã',
                agents: ['CEO', 'Product Manager', 'Designer', 'Developer', 'QA'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Product Manager', x: 400, y: 120 },
                    { role: 'Designer', x: 200, y: 220 },
                    { role: 'Developer', x: 400, y: 220 },
                    { role: 'QA', x: 600, y: 220 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Product Manager', content: 'Á°ÆÂÆöÊú¨Ëø≠‰ª£ÈúÄÊ±Ç' },
                    { from: 'Product Manager', to: 'Designer', content: 'UI ËÆæËÆ°ÈúÄÊ±Ç' },
                    { from: 'Product Manager', to: 'Developer', content: 'ÂºÄÂèëÈúÄÊ±ÇËØÑÂÆ°' },
                    { from: 'Designer', to: 'Developer', content: 'ËÆæËÆ°Á®ø‰∫§‰ªò' },
                    { from: 'Developer', to: 'QA', content: 'Êèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'CEO', content: 'ÁâàÊú¨ÂèëÂ∏ÉÊä•Âëä' }
                ]
            },
            {
                id: 'fundraising',
                name: 'ËûçËµÑË∑ØÊºî',
                icon: 'üéØ',
                desc: '‰ªéÂáÜÂ§áÊùêÊñôÂà∞Ëé∑ÂæóÊäïËµÑÁöÑÊµÅÁ®ã',
                agents: ['CEO', 'CFO', 'Researcher', 'Sales'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CFO', x: 200, y: 180 },
                    { role: 'Researcher', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CFO', content: 'ÂáÜÂ§áË¥¢Âä°Êï∞ÊçÆ' },
                    { from: 'CFO', to: 'Researcher', content: 'Â∏ÇÂú∫ËßÑÊ®°ÂàÜÊûê' },
                    { from: 'Researcher', to: 'Sales', content: 'Á´ûÂìÅÂàÜÊûêÊä•Âëä' },
                    { from: 'CEO', to: 'Sales', content: 'Ë∑ØÊºîÂáÜÂ§áÂÆåÊàê' }
                ]
            },
            {
                id: 'crisis-management',
                name: 'Âç±Êú∫Â§ÑÁêÜ',
                icon: 'üö®',
                desc: '‰ªéÈóÆÈ¢òÂèëÁé∞Âà∞Ëß£ÂÜ≥Âç±Êú∫ÁöÑÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Sales', 'Marketing'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Sales', x: 400, y: 180 },
                    { role: 'Marketing', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'ÊäÄÊúØÈóÆÈ¢òÊéíÊü•' },
                    { from: 'CTO', to: 'CEO', content: 'ÈóÆÈ¢òÂéüÂõ†ÂàÜÊûê' },
                    { from: 'CEO', to: 'Sales', content: 'ÂÆ¢Êà∑Ê≤üÈÄöÁ≠ñÁï•' },
                    { from: 'CEO', to: 'Marketing', content: 'ÂÖ¨ÂÖ≥Â∫îÂØπÊñπÊ°à' }
                ]
            },
            {
                id: 'recruitment',
                name: 'ÊãõËÅòÊµÅÁ®ã',
                icon: 'üë•',
                desc: '‰ªéÂ≤ó‰ΩçÈúÄÊ±ÇÂà∞ÂÄôÈÄâ‰∫∫ÂÖ•ËÅåÁöÑÊãõËÅòÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Sales', 'HR'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Sales', x: 400, y: 180 },
                    { role: 'HR', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CTO', content: 'ÊäÄÊúØÂ≤ó‰ΩçÊãõËÅòÈúÄÊ±Ç' },
                    { from: 'CTO', to: 'HR', content: 'ÊäÄÊúØÈù¢ËØïËØÑ‰º∞' },
                    { from: 'CEO', to: 'Sales', content: 'ÈîÄÂîÆÂ≤ó‰ΩçÊãõËÅòÈúÄÊ±Ç' },
                    { from: 'Sales', to: 'HR', content: 'ÈîÄÂîÆÈù¢ËØïËØÑ‰º∞' },
                    { from: 'HR', to: 'CEO', content: 'ÊãõËÅòÁªìÊûúÊ±áÊÄª' }
                ]
            },
            {
                id: 'api-design',
                name: 'API ËÆæËÆ°',
                icon: 'üîå',
                desc: '‰ªéÈúÄÊ±ÇÂàÜÊûêÂà∞ API ÊñáÊ°£ÁöÑËÆæËÆ°ÊµÅÁ®ã',
                agents: ['CTO', 'Developer', 'Researcher', 'QA'],
                positions: [
                    { role: 'CTO', x: 400, y: 50 },
                    { role: 'Developer', x: 200, y: 180 },
                    { role: 'Researcher', x: 400, y: 180 },
                    { role: 'QA', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'Researcher', content: 'API ÈúÄÊ±ÇÂàÜÊûê' },
                    { from: 'Researcher', to: 'Developer', content: 'API ËÆæËÆ°ÊñπÊ°à' },
                    { from: 'Developer', to: 'QA', content: 'API ÂçïÂÖÉÊµãËØï' },
                    { from: 'Developer', to: 'CTO', content: 'API ÊñáÊ°£ÂÆåÊàê' }
                ]
            },
            {
                id: 'user-onboarding',
                name: 'Áî®Êà∑ onboarding',
                icon: 'üéì',
                desc: '‰ªéÊñ∞Áî®Êà∑Ê≥®ÂÜåÂà∞ÂÆåÊàêÈ¶ñÊ¨°‰ΩøÁî®ÁöÑÂºïÂØºÊµÅÁ®ã',
                agents: ['Sales', 'Marketing', 'Developer', 'CEO'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Sales', x: 200, y: 180 },
                    { role: 'Marketing', x: 400, y: 180 },
                    { role: 'Developer', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Sales', content: 'Á°ÆÂÆöÁî®Êà∑ÂºïÂØºÁ≠ñÁï•' },
                    { from: 'Sales', to: 'Marketing', content: 'Áî®Êà∑Êèê‰æõÂèçÈ¶à' },
                    { from: 'Marketing', to: 'Developer', content: '‰∫ßÂìÅ‰ºòÂåñÂª∫ËÆÆ' },
                    { from: 'Developer', to: 'CEO', content: 'Êñ∞ÂäüËÉΩ‰∏äÁ∫øÊä•Âëä' }
                ]
            },
            {
                id: 'competitor-analysis',
                name: 'Á´ûÂìÅÂàÜÊûê',
                icon: 'ü•ä',
                desc: '‰ªéÁ´û‰∫âÂØπÊâãË∞ÉÁ†îÂà∞Â∑ÆÂºÇÂåñÁ≠ñÁï•ÁöÑÂà∂ÂÆöÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'Marketing', 'Sales'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'Researcher', x: 200, y: 180 },
                    { role: 'Marketing', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'Ë∞ÉÁ†îÁ´ûÂìÅÂäüËÉΩÂíåÂÆö‰ª∑' },
                    { from: 'Researcher', to: 'Marketing', content: 'Á´ûÂìÅÂàÜÊûêÊä•Âëä' },
                    { from: 'Marketing', to: 'Sales', content: 'Â∑ÆÂºÇÂåñÁ´û‰∫âÁ≠ñÁï•' },
                    { from: 'Sales', to: 'CEO', content: 'Â∏ÇÂú∫Á≠ñÁï•Âª∫ËÆÆ' }
                ]
            },
            {
                id: 'performance-review',
                name: 'Áª©ÊïàËØÑ‰º∞',
                icon: 'üìä',
                desc: 'ËÆæÂÆöÂà∞Áª©Êïà‰ªéÁõÆÊ†áÂèçÈ¶àÁöÑÂÆåÊï¥ËØÑ‰º∞ÊµÅÁ®ã',
                agents: ['CEO', 'CTO', 'Sales', 'HR'],
                positions: [
                    { role: 'CEO', x: 400, y: 50 },
                    { role: 'CTO', x: 200, y: 180 },
                    { role: 'Sales', x: 400, y: 180 },
                    { role: 'HR', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'HR', content: 'Âà∂ÂÆöËØÑ‰º∞Ê†áÂáÜ' },
                    { from: 'HR', to: 'CTO', content: 'ÊäÄÊúØÂõ¢ÈòüÁª©ÊïàËØÑ‰º∞' },
                    { from: 'HR', to: 'Sales', content: 'ÈîÄÂîÆÂõ¢ÈòüÁª©ÊïàËØÑ‰º∞' },
                    { from: 'HR', to: 'CEO', content: 'Áª©ÊïàËØÑ‰º∞Êä•Âëä' }
                ]
            },
            {
                id: 'incident-response',
                name: 'ÊïÖÈöúÂìçÂ∫î',
                icon: 'üöë',
                desc: '‰ªéÈóÆÈ¢òÂèëÁé∞Âà∞ÊúçÂä°ÊÅ¢Â§çÁöÑÂ∫îÊÄ•ÊµÅÁ®ã',
                agents: ['CTO', 'Developer', 'QA', 'Sales'],
                positions: [
                    { role: 'CTO', x: 400, y: 50 },
                    { role: 'Developer', x: 200, y: 180 },
                    { role: 'QA', x: 400, y: 180 },
                    { role: 'Sales', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'Developer', content: 'Á´ãÂç≥ÊéíÊü•ÈóÆÈ¢ò' },
                    { from: 'Developer', to: 'QA', content: '‰øÆÂ§çÊñπÊ°àÊµãËØï' },
                    { from: 'QA', to: 'CTO', content: '‰øÆÂ§çÈ™åËØÅÈÄöËøá' },
                    { from: 'CTO', to: 'Sales', content: 'ÊúçÂä°ÊÅ¢Â§çÈÄöÁü•' }
                ]
            },
            {
                id: 'feature-request',
                name: 'ÈúÄÊ±ÇËØÑÂÆ°',
                icon: 'üìù',
                desc: '‰ªéÈúÄÊ±ÇÊî∂ÈõÜÂà∞ÂºÄÂèëÊéíÊúüÁöÑËØÑÂÆ°ÊµÅÁ®ã',
                agents: ['CEO', 'Product Manager', 'Designer', 'Developer', 'QA'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Product Manager', x: 200, y: 120 },
                    { role: 'Designer', x: 400, y: 120 },
                    { role: 'Developer', x: 200, y: 220 },
                    { role: 'QA', x: 400, y: 220 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Product Manager', content: 'Á°ÆÂÆöÊñ∞ÈúÄÊ±ÇÊñπÂêë' },
                    { from: 'Product Manager', to: 'Designer', content: 'ÈúÄÊ±ÇÂéüÂûãËÆæËÆ°' },
                    { from: 'Product Manager', to: 'Developer', content: 'ÊäÄÊúØËØÑ‰º∞' },
                    { from: 'Designer', to: 'Developer', content: 'ËÆæËÆ°Á®ø‰∫§‰ªò' },
                    { from: 'Developer', to: 'QA', content: 'ÊµãËØïÁî®‰æãËØÑÂÆ°' }
                ]
            },
            {
                id: 'cloud-migration',
                name: '‰∫ëËøÅÁßª',
                icon: '‚òÅÔ∏è',
                desc: '‰ªéÊú¨Âú∞ÊúçÂä°ËøÅÁßªÂà∞‰∫ëÁ´ØÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['CTO', 'Developer', 'QA', 'Researcher'],
                positions: [
                    { role: 'CTO', x: 400, y: 50 },
                    { role: 'Developer', x: 200, y: 180 },
                    { role: 'QA', x: 400, y: 180 },
                    { role: 'Researcher', x: 600, y: 180 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'Researcher', content: 'Âà∂ÂÆöËøÅÁßªÊñπÊ°à' },
                    { from: 'Researcher', to: 'Developer', content: 'ÊäÄÊúØÊñπÊ°àÁ°ÆËÆ§' },
                    { from: 'Developer', to: 'QA', content: 'ËøÅÁßªÊµãËØï' },
                    { from: 'QA', to: 'CTO', content: 'ËøÅÁßªÈ™åËØÅÊä•Âëä' }
                ]
            },
            {
                id: 'brand-launch',
                name: 'ÂìÅÁâåÂèëÂ∏É',
                icon: 'üè∑Ô∏è',
                desc: '‰ªéÂìÅÁâåÁ≠ñÂàíÂà∞ÂÖ®Èù¢ÂèëÂ∏ÉÁöÑËê•ÈîÄÊµÅÁ®ã',
                agents: ['CEO', 'Marketing', 'Designer', 'Sales', 'Researcher'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Marketing', x: 400, y: 120 },
                    { role: 'Researcher', x: 200, y: 220 },
                    { role: 'Designer', x: 400, y: 220 },
                    { role: 'Sales', x: 600, y: 220 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Marketing', content: 'Á°ÆÂÆöÂìÅÁâåÂÆö‰Ωç' },
                    { from: 'Marketing', to: 'Researcher', content: 'Â∏ÇÂú∫Ë∞ÉÁ†î' },
                    { from: 'Researcher', to: 'Designer', content: 'ÂìÅÁâåËÆæËÆ°ÈúÄÊ±Ç' },
                    { from: 'Designer', to: 'Marketing', content: 'ÂìÅÁâåËßÜËßâÂÆåÊàê' },
                    { from: 'Marketing', to: 'Sales', content: 'ÂìÅÁâåÂèëÂ∏ÉËÆ°Âàí' }
                ]
            },
            // Êñ∞Â¢ûÊ®°Êùø - ‰ΩøÁî®Êñ∞ Agent ËßíËâ≤
            {
                id: 'data-analysis',
                name: 'Êï∞ÊçÆÂàÜÊûê',
                icon: 'üìä',
                desc: '‰ªéÊï∞ÊçÆÊî∂ÈõÜÂà∞Ê¥ûÂØüÊä•ÂëäÁöÑÂàÜÊûêÊµÅÁ®ã',
                agents: ['CEO', 'Data Analyst', 'Researcher', 'Product Manager'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 400, y: 130 },
                    { role: 'Researcher', x: 200, y: 250 },
                    { role: 'Product Manager', x: 600, y: 250 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Data Analyst', content: 'ÈúÄË¶ÅÂàÜÊûêÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ' },
                    { from: 'Data Analyst', to: 'Researcher', content: 'Êï∞ÊçÆÊ∏ÖÊ¥óÂíåÈ¢ÑÂ§ÑÁêÜÂÆåÊàê' },
                    { from: 'Researcher', to: 'Product Manager', content: 'Êï∞ÊçÆÂàÜÊûêÊä•ÂëäÔºöÁî®Êà∑ÁïôÂ≠òÂàÜÊûê' },
                    { from: 'Product Manager', to: 'CEO', content: 'Âü∫‰∫éÊï∞ÊçÆÁöÑ‰∫ßÂìÅ‰ºòÂåñÂª∫ËÆÆ' }
                ]
            },
            {
                id: 'infrastructure',
                name: 'Âü∫Á°ÄËÆæÊñΩÂª∫ËÆæ',
                icon: 'üèóÔ∏è',
                desc: '‰ªéÊû∂ÊûÑËÆæËÆ°Âà∞ÈÉ®ÁΩ≤‰∏äÁ∫øÁöÑËøêÁª¥ÊµÅÁ®ã',
                agents: ['CTO', 'DevOps', 'Developer', 'Security', 'QA'],
                positions: [
                    { role: 'CTO', x: 400, y: 30 },
                    { role: 'DevOps', x: 200, y: 130 },
                    { role: 'Developer', x: 400, y: 130 },
                    { role: 'Security', x: 600, y: 130 },
                    { role: 'QA', x: 400, y: 250 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'DevOps', content: 'ËÆæËÆ°Âü∫Á°ÄËÆæÊñΩÊû∂ÊûÑ' },
                    { from: 'DevOps', to: 'Developer', content: 'CI/CD ÊµÅÊ∞¥Á∫øÂ∞±Áª™' },
                    { from: 'DevOps', to: 'Security', content: 'ÂÆâÂÖ®ÂêàËßÑÊ£ÄÊü•' },
                    { from: 'Developer', to: 'QA', content: 'ÈÉ®ÁΩ≤ÊµãËØïÁéØÂ¢É' },
                    { from: 'Security', to: 'CTO', content: 'ÂÆâÂÖ®ÂÆ°ËÆ°Êä•Âëä' }
                ]
            },
            {
                id: 'incident-response',
                name: 'ÊïÖÈöúÂìçÂ∫î',
                icon: 'üö®',
                desc: '‰ªéÈóÆÈ¢òÂèëÁé∞Âà∞ÊúçÂä°ÊÅ¢Â§çÁöÑÂ∫îÊÄ•ÊµÅÁ®ã',
                agents: ['CTO', 'DevOps', 'Developer', 'Customer Support', 'CEO'],
                positions: [
                    { role: 'CTO', x: 400, y: 30 },
                    { role: 'DevOps', x: 200, y: 130 },
                    { role: 'Developer', x: 400, y: 130 },
                    { role: 'Customer Support', x: 600, y: 130 },
                    { role: 'CEO', x: 400, y: 250 }
                ],
                messageFlows: [
                    { from: 'CTO', to: 'DevOps', content: 'Áîü‰∫ßÁéØÂ¢ÉÂá∫Áé∞ÊïÖÈöúÔºåÂêØÂä®Â∫îÊÄ•È¢ÑÊ°à' },
                    { from: 'DevOps', to: 'Developer', content: 'ÂÆö‰ΩçÈóÆÈ¢òÔºöÊï∞ÊçÆÂ∫ìËøûÊé•Ê±†ËÄóÂ∞Ω' },
                    { from: 'Developer', to: 'DevOps', content: '‰øÆÂ§ç‰ª£Á†ÅÂ∑≤ÈÉ®ÁΩ≤' },
                    { from: 'DevOps', to: 'Customer Support', content: 'ÊúçÂä°Â∑≤ÊÅ¢Â§çÔºåÂèØ‰ª•ÈÄöÁü•ÂÆ¢Êà∑' },
                    { from: 'Customer Support', to: 'CEO', content: 'ÊïÖÈöúÂ§ÑÁêÜÊÄªÁªìÊä•Âëä' }
                ]
            },
            {
                id: 'project-management',
                name: 'È°πÁõÆÁÆ°ÁêÜ',
                icon: 'üìå',
                desc: '‰ªéÈ°πÁõÆÂêØÂä®Âà∞‰∫§‰ªòÂÆåÊàêÁöÑÁÆ°ÁêÜÊµÅÁ®ã',
                agents: ['CEO', 'Project Manager', 'Developer', 'QA', 'Customer Support'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Project Manager', x: 400, y: 130 },
                    { role: 'Developer', x: 200, y: 250 },
                    { role: 'QA', x: 400, y: 250 },
                    { role: 'Customer Support', x: 600, y: 250 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Project Manager', content: 'ÂêØÂä®Êñ∞È°πÁõÆÔºöÂÆ¢Êà∑ÁÆ°ÁêÜÁ≥ªÁªü' },
                    { from: 'Project Manager', to: 'Developer', content: 'ÂàÜÈÖçÂºÄÂèë‰ªªÂä°ÂíåÈáåÁ®ãÁ¢ë' },
                    { from: 'Developer', to: 'QA', content: 'ÂäüËÉΩÂºÄÂèëÂÆåÊàêÔºåÊèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'Project Manager', content: 'ÊµãËØïÊä•ÂëäÔºöÂèëÁé∞ 3 ‰∏™ bug' },
                    { from: 'Project Manager', to: 'Customer Support', content: 'È°πÁõÆ‰∫§‰ªòÔºåÂÆ¢Êà∑ÂüπËÆ≠ËÆ°Âàí' }
                ]
            },
            {
                id: 'customer-success',
                name: 'ÂÆ¢Êà∑ÊàêÂäü',
                icon: 'ü§ù',
                desc: '‰ªéÂÆ¢Êà∑ onboarding Âà∞ÊåÅÁª≠‰ª∑ÂÄº‰∫§‰ªòÁöÑÊµÅÁ®ã',
                agents: ['Sales', 'Customer Support', 'Product Manager', 'Operations', 'CEO'],
                positions: [
                    { role: 'Sales', x: 400, y: 30 },
                    { role: 'Customer Support', x: 200, y: 130 },
                    { role: 'Product Manager', x: 600, y: 130 },
                    { role: 'Operations', x: 200, y: 250 },
                    { role: 'CEO', x: 400, y: 250 }
                ],
                messageFlows: [
                    { from: 'Sales', to: 'Customer Support', content: 'Êñ∞ÂÆ¢Êà∑Á≠æÁ∫¶ÊàêÂäü' },
                    { from: 'Customer Support', to: 'Operations', content: 'ÂÆ¢Êà∑ onboarding ÂÆåÊàê' },
                    { from: 'Customer Support', to: 'Product Manager', content: 'ÂÆ¢Êà∑ÂèçÈ¶àÔºöÈúÄË¶ÅÊñ∞ÂäüËÉΩ' },
                    { from: 'Operations', to: 'CEO', content: 'ÂÆ¢Êà∑Êª°ÊÑèÂ∫¶Êä•Âëä' },
                    { from: 'Product Manager', to: 'CEO', content: '‰∫ßÂìÅË∑ØÁ∫øÂõæËßÑÂàí' }
                ]
            },
            {
                id: 'ab-testing',
                name: 'A/B ÊµãËØï',
                icon: 'üß™',
                desc: '‰ªéÂÆûÈ™åËÆæËÆ°Âà∞ÁªìÊûúÂàÜÊûêÁöÑÊµãËØïÊµÅÁ®ã',
                agents: ['Product Manager', 'Data Analyst', 'Developer', 'Designer'],
                positions: [
                    { role: 'Product Manager', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Developer', x: 400, y: 150 },
                    { role: 'Designer', x: 600, y: 150 }
                ],
                messageFlows: [
                    { from: 'Product Manager', to: 'Data Analyst', content: 'Á°ÆÂÆöÂÆûÈ™åÂÅáËÆæÂíåÊåáÊ†á' },
                    { from: 'Data Analyst', to: 'Designer', content: 'ËÆæËÆ°ÂÆûÈ™åÊñπÊ°à' },
                    { from: 'Designer', to: 'Developer', content: 'UI/UX ËÆæËÆ°Á®ø' },
                    { from: 'Developer', to: 'Data Analyst', content: 'A/B ÊµãËØïÂÆûÊñΩÂÆåÊàê' },
                    { from: 'Data Analyst', to: 'Product Manager', content: 'ÂÆûÈ™åÁªìÊûúÂàÜÊûêÊä•Âëä' }
                ]
            },
            {
                id: 'data-annotation',
                name: 'Êï∞ÊçÆÊ†áÊ≥®',
                icon: 'üè∑Ô∏è',
                desc: '‰ªéÊï∞ÊçÆÊî∂ÈõÜÂà∞Ê†áÊ≥®Ë¥®ÈáèÁÆ°ÁêÜÁöÑÊµÅÁ®ã',
                agents: ['Data Analyst', 'Developer', 'QA', 'Operations'],
                positions: [
                    { role: 'Data Analyst', x: 400, y: 30 },
                    { role: 'Developer', x: 200, y: 150 },
                    { role: 'QA', x: 600, y: 150 },
                    { role: 'Operations', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Data Analyst', to: 'Developer', content: 'Ê†áÊ≥®Â∑•ÂÖ∑ÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'Data Analyst', content: 'Ê†áÊ≥®Â∑•ÂÖ∑ÂºÄÂèëÂÆåÊàê' },
                    { from: 'Data Analyst', to: 'Operations', content: 'Ê†áÊ≥®‰ªªÂä°ÂàÜÈÖç' },
                    { from: 'Operations', to: 'QA', content: 'Ê†áÊ≥®Êï∞ÊçÆÊèê‰∫§ÂÆ°Ê†∏' },
                    { from: 'QA', to: 'Data Analyst', content: 'Ê†áÊ≥®Ë¥®ÈáèÊä•Âëä' }
                ]
            },
            {
                id: 'quality-assurance',
                name: 'Ë¥®Èáè‰øùËØÅ',
                icon: '‚úÖ',
                desc: '‰ªéÊµãËØïËÆ°ÂàíÂà∞Ë¥®ÈáèÂ∫¶ÈáèÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['QA Lead', 'QA', 'Developer', 'CTO'],
                positions: [
                    { role: 'QA Lead', x: 400, y: 30 },
                    { role: 'QA', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'CTO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'QA Lead', to: 'QA', content: 'Âà∂ÂÆöÊµãËØïËÆ°Âàí' },
                    { from: 'QA Lead', to: 'Developer', content: 'ÊµãËØïÁéØÂ¢ÉÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'QA', content: '‰ª£Á†ÅÊèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'QA Lead', content: 'ÊµãËØïÊä•Âëä' },
                    { from: 'QA Lead', to: 'CTO', content: 'Ë¥®ÈáèÂ∫¶ÈáèÊä•Âëä' }
                ]
            },
            {
                id: 'technical-docs',
                name: 'ÊäÄÊúØÊñáÊ°£',
                icon: 'üìö',
                desc: '‰ªéÊñáÊ°£ËßÑÂàíÂà∞ÂèëÂ∏ÉÁöÑÂÜô‰ΩúÊµÅÁ®ã',
                agents: ['Technical Writer', 'Developer', 'Product Manager', 'QA'],
                positions: [
                    { role: 'Technical Writer', x: 400, y: 30 },
                    { role: 'Developer', x: 200, y: 150 },
                    { role: 'Product Manager', x: 600, y: 150 },
                    { role: 'QA', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Technical Writer', to: 'Product Manager', content: 'Á°ÆÂÆöÊñáÊ°£ÈúÄÊ±Ç' },
                    { from: 'Product Manager', to: 'Technical Writer', content: '‰∫ßÂìÅÂäüËÉΩËØ¥Êòé' },
                    { from: 'Technical Writer', to: 'Developer', content: 'API ÊñáÊ°£ÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'Technical Writer', content: 'ÊäÄÊúØÁªÜËäÇÊèê‰æõ' },
                    { from: 'Technical Writer', to: 'QA', content: 'ÊñáÊ°£ÂÆ°ÈòÖËØ∑Ê±Ç' },
                    { from: 'QA', to: 'Technical Writer', content: 'ÊñáÊ°£ÂÆ°Ê†∏ÂèçÈ¶à' }
                ]
            },
            {
                id: 'ux-research',
                name: 'Áî®Êà∑‰ΩìÈ™åÁ†îÁ©∂',
                icon: 'üîç',
                desc: '‰ªéÁ†îÁ©∂ËÆ°ÂàíÂà∞Ê¥ûÂØüÊä•ÂëäÁöÑ UX ÊµÅÁ®ã',
                agents: ['UX Researcher', 'Designer', 'Product Manager', 'CEO'],
                positions: [
                    { role: 'UX Researcher', x: 400, y: 30 },
                    { role: 'Designer', x: 200, y: 150 },
                    { role: 'Product Manager', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'UX Researcher', to: 'Product Manager', content: 'Á°ÆÂÆöÁ†îÁ©∂ÁõÆÊ†á' },
                    { from: 'Product Manager', to: 'UX Researcher', content: 'Áî®Êà∑ÈóÆÈ¢òÊèèËø∞' },
                    { from: 'UX Researcher', to: 'Designer', content: 'Áî®Êà∑Á†îÁ©∂ÊñπÊ≥ïÂª∫ËÆÆ' },
                    { from: 'UX Researcher', to: 'CEO', content: 'Áî®Êà∑‰ΩìÈ™åÊ¥ûÂØüÊä•Âëä' },
                    { from: 'Designer', to: 'Product Manager', content: 'ËÆæËÆ°ÊñπÊ°àÂª∫ËÆÆ' }
                ]
            },
            {
                id: 'legal-review',
                name: 'Ê≥ïÂä°ÂÆ°Ê†∏',
                icon: '‚öñÔ∏è',
                desc: '‰ªéÂêàÂêåÂÆ°Ê†∏Âà∞ÂêàËßÑÊ£ÄÊü•ÁöÑÊ≥ïÂä°ÊµÅÁ®ã',
                agents: ['Legal Counsel', 'CEO', 'Sales', 'Operations'],
                positions: [
                    { role: 'Legal Counsel', x: 400, y: 30 },
                    { role: 'CEO', x: 200, y: 150 },
                    { role: 'Sales', x: 600, y: 150 },
                    { role: 'Operations', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Sales', to: 'Legal Counsel', content: 'Êñ∞ÂêàÂêåÂÆ°Ê†∏ËØ∑Ê±Ç' },
                    { from: 'Legal Counsel', to: 'CEO', content: 'ÂêàÂêåÈ£éÈô©ËØÑ‰º∞' },
                    { from: 'CEO', to: 'Legal Counsel', content: 'ÂÆ°ÊâπÊÑèËßÅ' },
                    { from: 'Legal Counsel', to: 'Operations', content: 'ÂêàËßÑÊ£ÄÊü•Ê∏ÖÂçï' },
                    { from: 'Operations', to: 'Legal Counsel', content: 'ÂêàËßÑÊä•ÂëäÊèê‰∫§' }
                ]
            },
            // Êñ∞Â¢ûÊ®°Êùø
            {
                id: 'ai-ml-development',
                name: 'AI/ML ÂºÄÂèë',
                icon: 'ü§ñ',
                desc: '‰ªéÊ®°ÂûãËÆ≠ÁªÉÂà∞ÈÉ®ÁΩ≤ÁöÑÊú∫Âô®Â≠¶‰π†ÂºÄÂèëÊµÅÁ®ã',
                agents: ['Data Engineer', 'ML Engineer', 'Developer', 'QA', 'DevOps'],
                positions: [
                    { role: 'Data Engineer', x: 400, y: 30 },
                    { role: 'ML Engineer', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'QA', x: 200, y: 270 },
                    { role: 'DevOps', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Data Engineer', to: 'ML Engineer', content: 'Êï∞ÊçÆÂáÜÂ§áÂÆåÊàêÔºåÂèØ‰ª•ÂºÄÂßãËÆ≠ÁªÉ' },
                    { from: 'ML Engineer', to: 'Developer', content: 'Ê®°ÂûãËÆ≠ÁªÉÂÆåÊàêÔºåAPI Êé•Âè£ÊñáÊ°£' },
                    { from: 'Developer', to: 'QA', content: 'ML ÊúçÂä°ÈÉ®ÁΩ≤ÂÆåÊàê' },
                    { from: 'QA', to: 'DevOps', content: 'Ê®°ÂûãÊÄßËÉΩÊµãËØïÊä•Âëä' },
                    { from: 'DevOps', to: 'Data Engineer', content: 'Áîü‰∫ßÁéØÂ¢ÉÁõëÊéßÈÖçÁΩÆÂÆåÊàê' }
                ]
            },
            {
                id: 'architecture-review',
                name: 'Êû∂ÊûÑËÆæËÆ°ËØÑÂÆ°',
                icon: 'üèóÔ∏è',
                desc: '‰ªéÈúÄÊ±ÇÂàÜÊûêÂà∞Êû∂ÊûÑËØÑÂÆ°ÁöÑÂÆåÊï¥ÊµÅÁ®ã',
                agents: ['Architect', 'CTO', 'Developer', 'DevOps', 'Security'],
                positions: [
                    { role: 'Architect', x: 400, y: 30 },
                    { role: 'CTO', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'DevOps', x: 200, y: 270 },
                    { role: 'Security', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Architect', to: 'CTO', content: 'Êû∂ÊûÑËÆæËÆ°ÊñπÊ°à' },
                    { from: 'CTO', to: 'Developer', content: 'ÊäÄÊúØÂèØË°åÊÄßËØÑ‰º∞' },
                    { from: 'Developer', to: 'DevOps', content: 'ÈÉ®ÁΩ≤ÊñπÊ°àÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'Security', content: 'ÂÆâÂÖ®ÂêàËßÑÈúÄÊ±Ç' },
                    { from: 'Security', to: 'Architect', content: 'ÂÆâÂÖ®ÂÆ°Êü•ÂèçÈ¶à' },
                    { from: 'DevOps', to: 'Architect', content: 'ËøêÁª¥ÂèØË°åÊÄßËØÑ‰º∞' }
                ]
            },
            {
                id: 'mvp-development',
                name: 'MVP ÂºÄÂèë',
                icon: 'üöÄ',
                desc: 'Âàõ‰∏öÂÖ¨Âè∏ÊúÄÂ∞èÂèØË°å‰∫ßÂìÅÂø´ÈÄüËø≠‰ª£ÊµÅÁ®ã',
                agents: ['CEO', 'Product Designer', 'Developer', 'Marketing', 'Sales'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Product Designer', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'Marketing', x: 200, y: 270 },
                    { role: 'Sales', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Product Designer', content: 'MVP ‰∫ßÂìÅÈúÄÊ±ÇÂÆö‰πâ' },
                    { from: 'Product Designer', to: 'Developer', content: '‰∫ßÂìÅÂéüÂûãÂíåËÆæËÆ°Á®ø' },
                    { from: 'Developer', to: 'CEO', content: 'MVP ÂºÄÂèëÂÆåÊàê' },
                    { from: 'CEO', to: 'Marketing', content: 'ÂêØÂä®Â∏ÇÂú∫Êé®Âπø' },
                    { from: 'Marketing', to: 'Sales', content: 'Ëé∑ÂèñÈ¶ñÊâπÁî®Êà∑ÂèçÈ¶à' },
                    { from: 'Sales', to: 'CEO', content: 'Áî®Êà∑ÂèçÈ¶àÂíå‰∫ßÂìÅËø≠‰ª£Âª∫ËÆÆ' }
                ]
            },
            {
                id: 'mobile-app-development',
                name: 'ÁßªÂä®Â∫îÁî®ÂºÄÂèë',
                icon: 'üì±',
                desc: '‰ªéËÆæËÆ°Âà∞ÂèëÂ∏ÉÁöÑÁßªÂä®Â∫îÁî®ÂºÄÂèëÊµÅÁ®ã',
                agents: ['Product Manager', 'Product Designer', 'Developer', 'QA', 'Marketing'],
                positions: [
                    { role: 'Product Manager', x: 400, y: 30 },
                    { role: 'Product Designer', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'QA', x: 200, y: 270 },
                    { role: 'Marketing', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Product Manager', to: 'Product Designer', content: '‰∫ßÂìÅÈúÄÊ±ÇÊñáÊ°£' },
                    { from: 'Product Designer', to: 'Developer', content: 'UI/UX ËÆæËÆ°Á®øÂíå‰∫§‰∫í' },
                    { from: 'Developer', to: 'QA', content: 'Â∫îÁî®ÊûÑÂª∫ÂÆåÊàêÔºåÊèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'Developer', content: 'ÊµãËØïÊä•ÂëäÔºöÂèëÁé∞ 5 ‰∏™ bug' },
                    { from: 'Developer', to: 'Product Manager', content: '‰øÆÂ§çÂÆåÊàêÔºåÂáÜÂ§áÂèëÂ∏É' },
                    { from: 'Product Manager', to: 'Marketing', content: 'Â∫îÁî®‰∏äÁ∫øÊé®ÂπøËÆ°Âàí' }
                ]
            },
            {
                id: 'data-pipeline',
                name: 'Êï∞ÊçÆÁÆ°ÈÅìÊê≠Âª∫',
                icon: 'üîÆ',
                desc: '‰ªéÊï∞ÊçÆÈááÈõÜÂà∞ÂèØËßÜÂåñÁöÑÂÆåÊï¥Êï∞ÊçÆÊµÅÁ®ã',
                agents: ['Data Engineer', 'Data Analyst', 'Architect', 'Developer', 'Business Analyst'],
                positions: [
                    { role: 'Data Engineer', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Architect', x: 600, y: 150 },
                    { role: 'Developer', x: 200, y: 270 },
                    { role: 'Business Analyst', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Data Engineer', to: 'Architect', content: 'Êï∞ÊçÆÁÆ°ÈÅìÊû∂ÊûÑËÆæËÆ°' },
                    { from: 'Architect', to: 'Developer', content: 'ÊäÄÊúØÊû∂ÊûÑÁ°ÆËÆ§' },
                    { from: 'Developer', to: 'Data Engineer', content: 'Êï∞ÊçÆÁÆ°ÈÅìÂºÄÂèëÂÆåÊàê' },
                    { from: 'Data Engineer', to: 'Data Analyst', content: 'Êï∞ÊçÆÊ∏ÖÊ¥óÂÆåÊàê' },
                    { from: 'Data Analyst', to: 'Business Analyst', content: 'Êï∞ÊçÆÂàÜÊûêÊä•Âëä' }
                ]
            },
            {
                id: 'growth-hacking',
                name: 'Áî®Êà∑Â¢ûÈïøÈªëÂÆ¢',
                icon: 'üìà',
                desc: '‰ªéÂàõÊÑèÂà∞ÊâßË°åÁöÑÁî®Êà∑Â¢ûÈïøÂÆûÈ™åÊµÅÁ®ã',
                agents: ['Marketing', 'Data Analyst', 'Developer', 'Product Designer', 'CEO'],
                positions: [
                    { role: 'Marketing', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'Product Designer', x: 200, y: 270 },
                    { role: 'CEO', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Marketing', to: 'Data Analyst', content: 'ÂàÜÊûêÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆÔºåÂØªÊâæÂ¢ûÈïøÁÇπ' },
                    { from: 'Data Analyst', to: 'Marketing', content: 'Â¢ûÈïøÊú∫‰ºöÂàÜÊûêÊä•Âëä' },
                    { from: 'Marketing', to: 'Product Designer', content: 'ËÆæËÆ°Â¢ûÈïøÂÆûÈ™åÊñπÊ°à' },
                    { from: 'Product Designer', to: 'Developer', content: 'ÂÆûÈ™åËêΩÂú∞È°µËÆæËÆ°' },
                    { from: 'Developer', to: 'Marketing', content: 'ÂÆûÈ™åÂäüËÉΩÂºÄÂèëÂÆåÊàê' },
                    { from: 'Marketing', to: 'CEO', content: 'ÂÆûÈ™åÁªìÊûúÂíåÂ¢ûÈïøÂª∫ËÆÆ' }
                ]
            },
            // Êñ∞Â¢ûÊ®°Êùø
            {
                id: 'seo-optimization',
                name: 'SEO ‰ºòÂåñ',
                icon: 'üîé',
                desc: '‰ªéÂÖ≥ÈîÆËØçÁ†îÁ©∂Âà∞ÊêúÁ¥¢ÊéíÂêçÊèêÂçáÁöÑ SEO ÊµÅÁ®ã',
                agents: ['SEO Specialist', 'Content Strategist', 'Developer', 'Marketing', 'Data Analyst'],
                positions: [
                    { role: 'SEO Specialist', x: 400, y: 30 },
                    { role: 'Content Strategist', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'Marketing', x: 200, y: 270 },
                    { role: 'Data Analyst', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'SEO Specialist', to: 'Content Strategist', content: 'ÂÖ≥ÈîÆËØçÁ†îÁ©∂ÂíåÁ´û‰∫âÂàÜÊûê' },
                    { from: 'Content Strategist', to: 'Developer', content: 'ÂÜÖÂÆπ‰ºòÂåñÂª∫ËÆÆ' },
                    { from: 'Developer', to: 'SEO Specialist', content: 'ÊäÄÊúØ SEO ‰ºòÂåñÂÆåÊàê' },
                    { from: 'SEO Specialist', to: 'Data Analyst', content: 'ÊéíÂêçÊï∞ÊçÆÁõëÊéß' },
                    { from: 'Data Analyst', to: 'Marketing', content: 'SEO ÊïàÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'community-management',
                name: 'Á§æÂå∫ËøêËê•',
                icon: 'üåê',
                desc: '‰ªéÁî®Êà∑Á§æÂå∫Âª∫Á´ãÂà∞Ê¥ªË∑ÉÂ∫¶ÊèêÂçáÁöÑËøêËê•ÊµÅÁ®ã',
                agents: ['Community Manager', 'Content Strategist', 'Customer Support', 'Marketing', 'CEO'],
                positions: [
                    { role: 'Community Manager', x: 400, y: 30 },
                    { role: 'Content Strategist', x: 200, y: 150 },
                    { role: 'Customer Support', x: 600, y: 150 },
                    { role: 'Marketing', x: 200, y: 270 },
                    { role: 'CEO', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Community Manager', to: 'Content Strategist', content: 'Á§æÂå∫ÂÜÖÂÆπËßÑÂàí' },
                    { from: 'Content Strategist', to: 'Community Manager', content: 'ÂÜÖÂÆπÁ¥†ÊùêÊèê‰æõ' },
                    { from: 'Customer Support', to: 'Community Manager', content: 'Áî®Êà∑ÂèçÈ¶àÊ±áÊÄª' },
                    { from: 'Community Manager', to: 'Marketing', content: 'Á§æÂå∫Ê¥ªÂä®ÊñπÊ°à' },
                    { from: 'Marketing', to: 'CEO', content: 'Á§æÂå∫Â¢ûÈïøÊä•Âëä' }
                ]
            },
            {
                id: 'content-strategy',
                name: 'ÂÜÖÂÆπÁ≠ñÁï•',
                icon: '‚úçÔ∏è',
                desc: '‰ªéÂÜÖÂÆπËßÑÂàíÂà∞Â§öÊ∏†ÈÅìÂàÜÂèëÁöÑÂÜÖÂÆπËê•ÈîÄÊµÅÁ®ã',
                agents: ['Content Strategist', 'SEO Specialist', 'Designer', 'Marketing', 'Data Analyst'],
                positions: [
                    { role: 'Content Strategist', x: 400, y: 30 },
                    { role: 'SEO Specialist', x: 200, y: 150 },
                    { role: 'Designer', x: 600, y: 150 },
                    { role: 'Marketing', x: 200, y: 270 },
                    { role: 'Data Analyst', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Content Strategist', to: 'SEO Specialist', content: 'ÂÜÖÂÆπÂÖ≥ÈîÆËØçËßÑÂàí' },
                    { from: 'SEO Specialist', to: 'Content Strategist', content: 'SEO ‰ºòÂåñÂª∫ËÆÆ' },
                    { from: 'Content Strategist', to: 'Designer', content: 'ÂÜÖÂÆπËßÜËßâËÆæËÆ°ÈúÄÊ±Ç' },
                    { from: 'Designer', to: 'Marketing', content: 'ËÆæËÆ°Á®øÂÆåÊàê' },
                    { from: 'Marketing', to: 'Data Analyst', content: 'ÂÜÖÂÆπÊïàÊûúÊï∞ÊçÆ' }
                ]
            },
            {
                id: 'bi-analysis',
                name: 'ÂïÜ‰∏öÊô∫ËÉΩÂàÜÊûê',
                icon: 'üìä',
                desc: '‰ªéÊï∞ÊçÆÊï¥ÂêàÂà∞ÂïÜ‰∏öÊ¥ûÂØüÁöÑ BI ÂàÜÊûêÊµÅÁ®ã',
                agents: ['BI Analyst', 'Data Engineer', 'Data Analyst', 'Business Analyst', 'CEO'],
                positions: [
                    { role: 'BI Analyst', x: 400, y: 30 },
                    { role: 'Data Engineer', x: 200, y: 150 },
                    { role: 'Data Analyst', x: 600, y: 150 },
                    { role: 'Business Analyst', x: 200, y: 270 },
                    { role: 'CEO', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'BI Analyst', to: 'Data Engineer', content: 'Êï∞ÊçÆÊ∫êÊï¥ÂêàÈúÄÊ±Ç' },
                    { from: 'Data Engineer', to: 'BI Analyst', content: 'Êï∞ÊçÆ‰ªìÂ∫ìÊûÑÂª∫ÂÆåÊàê' },
                    { from: 'BI Analyst', to: 'Data Analyst', content: 'Êï∞ÊçÆÂàÜÊûê‰ªªÂä°' },
                    { from: 'Data Analyst', to: 'Business Analyst', content: 'Êï∞ÊçÆÂàÜÊûêÊä•Âëä' },
                    { from: 'Business Analyst', to: 'CEO', content: 'ÂïÜ‰∏öÊ¥ûÂØüÂíåÂª∫ËÆÆ' }
                ]
            },
            {
                id: 'user-retention',
                name: 'Áî®Êà∑ÁïôÂ≠ò',
                icon: 'üíé',
                desc: '‰ªéÁî®Êà∑Ë°å‰∏∫ÂàÜÊûêÂà∞ÁïôÂ≠òÁéáÊèêÂçáÁöÑËøêËê•ÊµÅÁ®ã',
                agents: ['Growth Hacker', 'Data Analyst', 'Product Manager', 'Designer', 'Customer Support'],
                positions: [
                    { role: 'Growth Hacker', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Product Manager', x: 600, y: 150 },
                    { role: 'Designer', x: 200, y: 270 },
                    { role: 'Customer Support', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'Growth Hacker', to: 'Data Analyst', content: 'ÂàÜÊûêÁî®Êà∑ÊµÅÂ§±ÂéüÂõ†' },
                    { from: 'Data Analyst', to: 'Growth Hacker', content: 'ÁïôÂ≠òÊï∞ÊçÆÂàÜÊûêÊä•Âëä' },
                    { from: 'Growth Hacker', to: 'Product Manager', content: 'ÁïôÂ≠ò‰ºòÂåñÊñπÊ°à' },
                    { from: 'Product Manager', to: 'Designer', content: '‰∫ßÂìÅÂäüËÉΩ‰ºòÂåñËÆæËÆ°' },
                    { from: 'Product Manager', to: 'Customer Support', content: 'Áî®Êà∑Ê≤üÈÄöÁ≠ñÁï•' }
                ]
            },
            {
                id: 'product-globalization',
                name: '‰∫ßÂìÅÂÖ®ÁêÉÂåñ',
                icon: 'üåç',
                desc: '‰ªéÂ∏ÇÂú∫Ë∞ÉÁ†îÂà∞ÂÖ®ÁêÉÂèëÂ∏ÉÁöÑÂõΩÈôÖÂåñÊµÅÁ®ã',
                agents: ['CEO', 'Researcher', 'Content Strategist', 'Marketing', 'Operations'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Researcher', x: 200, y: 150 },
                    { role: 'Content Strategist', x: 600, y: 150 },
                    { role: 'Marketing', x: 200, y: 270 },
                    { role: 'Operations', x: 600, y: 270 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Researcher', content: 'ÁõÆÊ†áÊµ∑Â§ñÂ∏ÇÂú∫Ë∞ÉÁ†î' },
                    { from: 'Researcher', to: 'CEO', content: 'Â∏ÇÂú∫ÂàÜÊûêÊä•Âëä' },
                    { from: 'CEO', to: 'Content Strategist', content: 'Êú¨Âú∞ÂåñÂÜÖÂÆπÁ≠ñÁï•' },
                    { from: 'Content Strategist', to: 'Marketing', content: 'Êú¨Âú∞ÂåñÂÜÖÂÆπÂÆåÊàê' },
                    { from: 'Marketing', to: 'Operations', content: 'Êµ∑Â§ñËøêËê•ÂáÜÂ§á' },
                    { from: 'Operations', to: 'CEO', content: 'ÂÖ®ÁêÉÂèëÂ∏ÉÂáÜÂ§áÂ∞±Áª™' }
                ]
            },
            // Cycle 271 Êñ∞Â¢ûÊ®°Êùø
            {
                id: 'viral-marketing',
                name: 'ÁóÖÊØíÂºèËê•ÈîÄ',
                icon: 'ü¶†',
                desc: '‰ªéÁóÖÊØí‰º†Êí≠Á≠ñÂàíÂà∞ÂÖ®ÁΩëË£ÇÂèòÁöÑËê•ÈîÄÊµÅÁ®ã',
                agents: ['Growth Hacker', 'Content Strategist', 'Designer', 'Community Manager', 'Marketing'],
                positions: [
                    { role: 'Growth Hacker', x: 400, y: 30 },
                    { role: 'Content Strategist', x: 200, y: 130 },
                    { role: 'Designer', x: 600, y: 130 },
                    { role: 'Community Manager', x: 200, y: 250 },
                    { role: 'Marketing', x: 600, y: 250 }
                ],
                messageFlows: [
                    { from: 'Growth Hacker', to: 'Content Strategist', content: 'ÁóÖÊØíÂÜÖÂÆπÂàõÊÑèÈúÄÊ±Ç' },
                    { from: 'Content Strategist', to: 'Designer', content: 'ËßÜËßâÁ¥†ÊùêÈúÄÊ±Ç' },
                    { from: 'Designer', to: 'Community Manager', content: '‰º†Êí≠Á¥†ÊùêÂÆåÊàê' },
                    { from: 'Community Manager', to: 'Growth Hacker', content: '‰º†Êí≠Á≠ñÁï•Âª∫ËÆÆ' },
                    { from: 'Growth Hacker', to: 'Marketing', content: 'ÁóÖÊØí‰º†Êí≠ÊïàÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'product-update',
                name: '‰∫ßÂìÅÊõ¥Êñ∞ÂèëÂ∏É',
                icon: 'üì¶',
                desc: '‰ªéÁâàÊú¨ËßÑÂàíÂà∞Áî®Êà∑ÈÄöÁü•ÁöÑÂÆåÊï¥ÂèëÂ∏ÉÊµÅÁ®ã',
                agents: ['Product Manager', 'Developer', 'QA', 'Marketing', 'Community Manager'],
                positions: [
                    { role: 'Product Manager', x: 400, y: 30 },
                    { role: 'Developer', x: 200, y: 130 },
                    { role: 'QA', x: 600, y: 130 },
                    { role: 'Marketing', x: 200, y: 250 },
                    { role: 'Community Manager', x: 600, y: 250 }
                ],
                messageFlows: [
                    { from: 'Product Manager', to: 'Developer', content: 'ÁâàÊú¨ÂºÄÂèëÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'QA', content: 'Êèê‰∫§ÊµãËØï' },
                    { from: 'QA', to: 'Product Manager', content: 'ÊµãËØïÊä•Âëä' },
                    { from: 'Product Manager', to: 'Marketing', content: 'Êõ¥Êñ∞ËØ¥ÊòéÊñáÊ°£' },
                    { from: 'Marketing', to: 'Community Manager', content: 'Áî®Êà∑ÈÄöÁü•ÂÜÖÂÆπ' },
                    { from: 'Community Manager', to: 'Product Manager', content: 'Áî®Êà∑ÂèçÈ¶àÊ±áÊÄª' }
                ]
            },
            {
                id: 'paid-ads',
                name: '‰ªòË¥πÂπøÂëäÊäïÊîæ',
                icon: 'üí≥',
                desc: '‰ªéÂπøÂëäÁ≠ñÁï•Âà∂ÂÆöÂà∞ÊïàÊûú‰ºòÂåñÁöÑÊäïÊîæÊµÅÁ®ã',
                agents: ['Marketing', 'Data Analyst', 'Content Strategist', 'Operations'],
                positions: [
                    { role: 'Marketing', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Content Strategist', x: 600, y: 150 },
                    { role: 'Operations', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Marketing', to: 'Data Analyst', content: 'ÁõÆÊ†áÂèó‰ºóÂàÜÊûêÈúÄÊ±Ç' },
                    { from: 'Data Analyst', to: 'Marketing', content: 'Áî®Êà∑ÁîªÂÉèÊä•Âëä' },
                    { from: 'Marketing', to: 'Content Strategist', content: 'ÂπøÂëäÂàõÊÑèÈúÄÊ±Ç' },
                    { from: 'Content Strategist', to: 'Marketing', content: 'ÂπøÂëäÁ¥†Êùê' },
                    { from: 'Marketing', to: 'Operations', content: 'ÊäïÊîæËÆ°Âàí' },
                    { from: 'Operations', to: 'Marketing', content: 'ÊäïÊîæÊïàÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'partnership',
                name: 'ÊàòÁï•Âêà‰Ωú',
                icon: 'ü§ù',
                desc: '‰ªéÂêà‰Ωú‰ºô‰º¥Á≠õÈÄâÂà∞Âêà‰ΩúËææÊàêÁöÑÂïÜÂä°ÊµÅÁ®ã',
                agents: ['CEO', 'Sales', 'Legal Counsel', 'Operations'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Sales', x: 200, y: 150 },
                    { role: 'Legal Counsel', x: 600, y: 150 },
                    { role: 'Operations', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Sales', content: 'Âêà‰Ωú‰ºô‰º¥Á≠õÈÄâÊ†áÂáÜ' },
                    { from: 'Sales', to: 'CEO', content: 'ÊΩúÂú®Âêà‰Ωú‰ºô‰º¥ÂêçÂçï' },
                    { from: 'CEO', to: 'Legal Counsel', content: 'Âêà‰ΩúÊù°Ê¨æÂÆ°Ê†∏' },
                    { from: 'Legal Counsel', to: 'Sales', content: 'ÂêàÂêåËçâÊ°à' },
                    { from: 'Sales', to: 'Operations', content: 'Âêà‰ΩúÊâßË°åËÆ°Âàí' },
                    { from: 'Operations', to: 'CEO', content: 'Âêà‰ΩúÊàêÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'crisis-pr',
                name: 'Âç±Êú∫ÂÖ¨ÂÖ≥',
                icon: 'üõ°Ô∏è',
                desc: '‰ªéÂç±Êú∫ËØÜÂà´Âà∞ÂÖ¨ÂÖ≥Â∫îÂØπÁöÑÂ∫îÊÄ•ÊµÅÁ®ã',
                agents: ['CEO', 'Marketing', 'Community Manager', 'Legal Counsel'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'Marketing', x: 200, y: 150 },
                    { role: 'Community Manager', x: 600, y: 150 },
                    { role: 'Legal Counsel', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'Marketing', content: 'ÂêØÂä®Âç±Êú∫ÂÖ¨ÂÖ≥È¢ÑÊ°à' },
                    { from: 'Marketing', to: 'Community Manager', content: 'Á§æ‰∫§Â™í‰ΩìÁõëÊéßÈúÄÊ±Ç' },
                    { from: 'Community Manager', to: 'Marketing', content: 'ËàÜÊÉÖÂàÜÊûêÊä•Âëä' },
                    { from: 'Marketing', to: 'Legal Counsel', content: 'Ê≥ïÂæãÈ£éÈô©ËØÑ‰º∞' },
                    { from: 'Legal Counsel', to: 'CEO', content: 'Â∫îÂØπÁ≠ñÁï•Âª∫ËÆÆ' },
                    { from: 'Marketing', to: 'CEO', content: 'ÂÖ¨ÂÖ≥ÊïàÊûúËØÑ‰º∞' }
                ]
            },
            {
                id: 'user-interview',
                name: 'Áî®Êà∑ËÆøË∞à',
                icon: 'üé§',
                desc: '‰ªéËÆøË∞àÂáÜÂ§áÂà∞Ê¥ûÂØüÊèêÁÇºÁöÑÁî®Êà∑Á†îÁ©∂ÊµÅÁ®ã',
                agents: ['UX Researcher', 'Product Manager', 'Data Analyst', 'Customer Support'],
                positions: [
                    { role: 'UX Researcher', x: 400, y: 30 },
                    { role: 'Product Manager', x: 200, y: 150 },
                    { role: 'Data Analyst', x: 600, y: 150 },
                    { role: 'Customer Support', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'UX Researcher', to: 'Product Manager', content: 'ËÆøË∞àÁõÆÊ†áÁ°ÆÂÆö' },
                    { from: 'Product Manager', to: 'Customer Support', content: 'Á≠õÈÄâËÆøË∞àÁî®Êà∑' },
                    { from: 'Customer Support', to: 'UX Researcher', content: 'Áî®Êà∑ÂêçÂçïÊèê‰æõ' },
                    { from: 'UX Researcher', to: 'Data Analyst', content: 'ËÆøË∞àÊï∞ÊçÆÂàÜÊûê' },
                    { from: 'Data Analyst', to: 'UX Researcher', content: 'ÂàÜÊûêÁªìÊûú' },
                    { from: 'UX Researcher', to: 'Product Manager', content: 'Áî®Êà∑Ê¥ûÂØüÊä•Âëä' }
                ]
            },
            {
                id: 'app-store-optimization',
                name: 'ASO ‰ºòÂåñ',
                icon: 'üì±',
                desc: '‰ªéÂÖ≥ÈîÆËØç‰ºòÂåñÂà∞Â∫îÁî®ÂïÜÂ∫óÊéíÂêçÁöÑ‰ºòÂåñÊµÅÁ®ã',
                agents: ['SEO Specialist', 'Designer', 'Developer', 'Marketing'],
                positions: [
                    { role: 'SEO Specialist', x: 400, y: 30 },
                    { role: 'Designer', x: 200, y: 150 },
                    { role: 'Developer', x: 600, y: 150 },
                    { role: 'Marketing', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'SEO Specialist', to: 'Developer', content: 'ASO ÊäÄÊúØ‰ºòÂåñÈúÄÊ±Ç' },
                    { from: 'Developer', to: 'SEO Specialist', content: 'ÊäÄÊúØ‰ºòÂåñÂÆåÊàê' },
                    { from: 'SEO Specialist', to: 'Designer', content: 'Â∫îÁî®ÂõæÊ†áÂíåÊà™Âõæ‰ºòÂåñ' },
                    { from: 'Designer', to: 'Marketing', content: 'Á¥†ÊùêÂÆåÊàê' },
                    { from: 'Marketing', to: 'SEO Specialist', content: '‰ºòÂåñÊïàÊûúÊä•Âëä' }
                ]
            },
            // Êñ∞Â¢ûÊ®°Êùø
            {
                id: 'talent-recruitment',
                name: '‰∫∫ÊâçÊãõËÅò',
                icon: 'üéØ',
                desc: '‰ªéÂ≤ó‰ΩçÈúÄÊ±ÇÂà∞ÂÄôÈÄâ‰∫∫ÂÖ•ËÅåÁöÑÊãõËÅòÊµÅÁ®ã',
                agents: ['HR', 'Technical Recruiter', 'CTO', 'CEO'],
                positions: [
                    { role: 'HR', x: 400, y: 30 },
                    { role: 'Technical Recruiter', x: 200, y: 150 },
                    { role: 'CTO', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'HR', to: 'Technical Recruiter', content: 'ÂèëÂ∏ÉÊãõËÅòÈúÄÊ±Ç' },
                    { from: 'Technical Recruiter', to: 'CTO', content: 'Á≠õÈÄâÁÆÄÂéÜ' },
                    { from: 'CTO', to: 'Technical Recruiter', content: 'ÊäÄÊúØÈù¢ËØïÂèçÈ¶à' },
                    { from: 'Technical Recruiter', to: 'HR', content: 'ÂÄôÈÄâ‰∫∫ËØÑ‰º∞Êä•Âëä' },
                    { from: 'HR', to: 'CEO', content: 'ÂΩïÁî®ÂÜ≥Á≠ñ' },
                    { from: 'HR', to: 'Technical Recruiter', content: 'offerÂèëÊîæ' }
                ]
            },
            {
                id: 'brand-strategy',
                name: 'ÂìÅÁâåÂª∫ËÆæ',
                icon: 'üíé',
                desc: '‰ªéÂìÅÁâåÂÆö‰ΩçÂà∞ÂÖ®Ê∏†ÈÅì‰º†Êí≠ÁöÑÂìÅÁâåÁ≠ñÁï•ÊµÅÁ®ã',
                agents: ['Brand Strategist', 'Designer', 'Marketing', 'Content Strategist'],
                positions: [
                    { role: 'Brand Strategist', x: 400, y: 30 },
                    { role: 'Designer', x: 200, y: 150 },
                    { role: 'Marketing', x: 600, y: 150 },
                    { role: 'Content Strategist', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Brand Strategist', to: 'Designer', content: 'ÂìÅÁâåËßÜËßâËÆæËÆ°ÈúÄÊ±Ç' },
                    { from: 'Designer', to: 'Brand Strategist', content: 'ÂìÅÁâåËßÜËßâÊñπÊ°à' },
                    { from: 'Brand Strategist', to: 'Content Strategist', content: 'ÂìÅÁâåÂÜÖÂÆπÁ≠ñÁï•' },
                    { from: 'Content Strategist', to: 'Marketing', content: 'ÂÜÖÂÆπÂàÜÂèëËÆ°Âàí' },
                    { from: 'Marketing', to: 'Brand Strategist', content: 'ÂìÅÁâå‰º†Êí≠ÊïàÊûú' }
                ]
            },
            {
                id: 'product-launch',
                name: '‰∫ßÂìÅËê•ÈîÄ',
                icon: 'üì£',
                desc: '‰ªé‰∫ßÂìÅÂèëÂ∏ÉÂà∞Â∏ÇÂú∫Êé®ÂπøÁöÑËê•ÈîÄÊµÅÁ®ã',
                agents: ['Product Marketing', 'Designer', 'Content Strategist', 'Sales', 'CEO'],
                positions: [
                    { role: 'Product Marketing', x: 400, y: 30 },
                    { role: 'Designer', x: 200, y: 150 },
                    { role: 'Content Strategist', x: 600, y: 150 },
                    { role: 'Sales', x: 300, y: 270 },
                    { role: 'CEO', x: 500, y: 270 }
                ],
                messageFlows: [
                    { from: 'Product Marketing', to: 'Designer', content: '‰∫ßÂìÅÂÆ£‰º†Á¥†ÊùêÈúÄÊ±Ç' },
                    { from: 'Designer', to: 'Product Marketing', content: 'ÂÆ£‰º†Á¥†ÊùêÂÆåÊàê' },
                    { from: 'Product Marketing', to: 'Content Strategist', content: '‰∫ßÂìÅÊñáÊ°àÈúÄÊ±Ç' },
                    { from: 'Content Strategist', to: 'Product Marketing', content: 'ÊñáÊ°àÂÆåÊàê' },
                    { from: 'Product Marketing', to: 'Sales', content: 'ÈîÄÂîÆËØùÊúØÂüπËÆ≠' },
                    { from: 'Sales', to: 'CEO', content: 'ÈîÄÂîÆ‰∏öÁª©Êä•Âëä' }
                ]
            },
            {
                id: 'investor-pitch',
                name: 'ËûçËµÑË∑ØÊºî',
                icon: 'üíº',
                desc: '‰ªéÂáÜÂ§áÊùêÊñôÂà∞Ëé∑ÂæóÊäïËµÑÁöÑËûçËµÑÊµÅÁ®ã',
                agents: ['CEO', 'CFO', 'Investment Analyst', 'Product Manager'],
                positions: [
                    { role: 'CEO', x: 400, y: 30 },
                    { role: 'CFO', x: 200, y: 150 },
                    { role: 'Investment Analyst', x: 600, y: 150 },
                    { role: 'Product Manager', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'CEO', to: 'CFO', content: 'ÂáÜÂ§áË¥¢Âä°Êï∞ÊçÆ' },
                    { from: 'CFO', to: 'Investment Analyst', content: 'Ë¥¢Âä°Ê®°ÂûãÂàÜÊûê' },
                    { from: 'Investment Analyst', to: 'CEO', content: 'ËûçËµÑÊùêÊñôÂª∫ËÆÆ' },
                    { from: 'CEO', to: 'Product Manager', content: '‰∫ßÂìÅ‰∫ÆÁÇπÊï¥ÁêÜ' },
                    { from: 'Product Manager', to: 'CEO', content: '‰∫ßÂìÅÊºîÁ§∫ÊùêÊñô' },
                    { from: 'CEO', to: 'Investment Analyst', content: 'Ë∑ØÊºîÂáÜÂ§áÂÆåÊàê' }
                ]
            },
            {
                id: 'customer-success',
                name: 'ÂÆ¢Êà∑ÊàêÂäü',
                icon: 'ü§ù',
                desc: '‰ªéÂÆ¢Êà∑ onboarding Âà∞ÊåÅÁª≠‰ª∑ÂÄº‰∫§‰ªòÁöÑÊµÅÁ®ã',
                agents: ['Customer Success', 'Customer Support', 'Product Manager', 'Sales'],
                positions: [
                    { role: 'Customer Success', x: 400, y: 30 },
                    { role: 'Customer Support', x: 200, y: 150 },
                    { role: 'Product Manager', x: 600, y: 150 },
                    { role: 'Sales', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Customer Success', to: 'Customer Support', content: 'ÂÆ¢Êà∑ onboarding ËÆ°Âàí' },
                    { from: 'Customer Support', to: 'Customer Success', content: 'ÂÆ¢Êà∑ÈóÆÈ¢òÊ±áÊÄª' },
                    { from: 'Customer Success', to: 'Product Manager', content: 'ÂÆ¢Êà∑ÈúÄÊ±ÇÂèçÈ¶à' },
                    { from: 'Product Manager', to: 'Customer Success', content: '‰∫ßÂìÅ‰ºòÂåñËÆ°Âàí' },
                    { from: 'Customer Success', to: 'Sales', content: 'ÂÆ¢Êà∑Áª≠Ë¥πËØÑ‰º∞' },
                    { from: 'Sales', to: 'Customer Success', content: 'Áª≠Ë¥πÁªìÊûúÂèçÈ¶à' }
                ]
            },
            {
                id: 'data-driven-decision',
                name: 'Êï∞ÊçÆÈ©±Âä®ÂÜ≥Á≠ñ',
                icon: 'üìä',
                desc: '‰ªéÊï∞ÊçÆÊî∂ÈõÜÂà∞ÂïÜ‰∏öÊ¥ûÂØüÁöÑÂÜ≥Á≠ñÊµÅÁ®ã',
                agents: ['BI Analyst', 'Data Engineer', 'Business Analyst', 'CEO'],
                positions: [
                    { role: 'BI Analyst', x: 400, y: 30 },
                    { role: 'Data Engineer', x: 200, y: 150 },
                    { role: 'Business Analyst', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'BI Analyst', to: 'Data Engineer', content: 'Êï∞ÊçÆÈúÄÊ±ÇÊ∏ÖÂçï' },
                    { from: 'Data Engineer', to: 'BI Analyst', content: 'Êï∞ÊçÆÁÆ°ÈÅìÂ∞±Áª™' },
                    { from: 'BI Analyst', to: 'Business Analyst', content: 'Êï∞ÊçÆÂàÜÊûêÈúÄÊ±Ç' },
                    { from: 'Business Analyst', to: 'BI Analyst', content: 'ÂàÜÊûêÁªìÊûú' },
                    { from: 'BI Analyst', to: 'CEO', content: 'ÂïÜ‰∏öÊ¥ûÂØüÊä•Âëä' }
                ]
            },
            {
                id: 'growth-experiment',
                name: 'Â¢ûÈïøÂÆûÈ™å',
                icon: 'üß™',
                desc: '‰ªéÂÅáËÆæÈ™åËØÅÂà∞Â¢ûÈïøÁ≠ñÁï•Ëø≠‰ª£ÁöÑÊµÅÁ®ã',
                agents: ['Growth Hacker', 'Data Analyst', 'Product Designer', 'Marketing'],
                positions: [
                    { role: 'Growth Hacker', x: 400, y: 30 },
                    { role: 'Data Analyst', x: 200, y: 150 },
                    { role: 'Product Designer', x: 600, y: 150 },
                    { role: 'Marketing', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Growth Hacker', to: 'Data Analyst', content: 'ÂàÜÊûêÁî®Êà∑Ë°å‰∏∫Êï∞ÊçÆ' },
                    { from: 'Data Analyst', to: 'Growth Hacker', content: 'Â¢ûÈïøÊú∫‰ºöÂàÜÊûê' },
                    { from: 'Growth Hacker', to: 'Product Designer', content: 'ÂÆûÈ™åÊñπÊ°àËÆæËÆ°' },
                    { from: 'Product Designer', to: 'Growth Hacker', content: 'ÂÆûÈ™åÂéüÂûã' },
                    { from: 'Growth Hacker', to: 'Marketing', content: 'ÂÆûÈ™åÊé®ÂπøËÆ°Âàí' },
                    { from: 'Marketing', to: 'Growth Hacker', content: 'ÂÆûÈ™åÁªìÊûúÂèçÈ¶à' }
                ]
            },
            // Êñ∞Â¢ûÊ®°Êùø
            {
                id: 'risk-management',
                name: 'È£éÈô©ÁÆ°ÁêÜ',
                icon: '‚ö†Ô∏è',
                desc: '‰ªéÈ£éÈô©ËØÜÂà´Âà∞Â∫îÂØπÊé™ÊñΩÁöÑÈ£éÈô©ÁÆ°ÁêÜÊµÅÁ®ã',
                agents: ['Risk Control', 'CFO', 'Legal Counsel', 'CEO'],
                positions: [
                    { role: 'Risk Control', x: 400, y: 30 },
                    { role: 'CFO', x: 200, y: 150 },
                    { role: 'Legal Counsel', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Risk Control', to: 'CFO', content: 'Ë¥¢Âä°È£éÈô©ËØÑ‰º∞Êä•Âëä' },
                    { from: 'CFO', to: 'Risk Control', content: 'È£éÈô©Â∫îÂØπÂª∫ËÆÆ' },
                    { from: 'Risk Control', to: 'Legal Counsel', content: 'Ê≥ïÂæãÈ£éÈô©ËØÑ‰º∞ÈúÄÊ±Ç' },
                    { from: 'Legal Counsel', to: 'Risk Control', content: 'ÂêàËßÑÈ£éÈô©ÂàÜÊûê' },
                    { from: 'Risk Control', to: 'CEO', content: 'ÁªºÂêàÈ£éÈô©ËØÑ‰º∞Êä•Âëä' }
                ]
            },
            {
                id: 'business-development',
                name: 'ÂïÜÂä°ÊãìÂ±ï',
                icon: 'ü§ù',
                desc: '‰ªéÂ∏ÇÂú∫ÂºÄÊãìÂà∞Âêà‰ΩúËææÊàêÁöÑÂïÜÂä°ÊãìÂ±ïÊµÅÁ®ã',
                agents: ['Business Development', 'Sales', 'Legal Counsel', 'CEO'],
                positions: [
                    { role: 'Business Development', x: 400, y: 30 },
                    { role: 'Sales', x: 200, y: 150 },
                    { role: 'Legal Counsel', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Business Development', to: 'Sales', content: 'ÊΩúÂú®ÂÆ¢Êà∑ÂêçÂçï' },
                    { from: 'Sales', to: 'Business Development', content: 'ÂÆ¢Êà∑ÈúÄÊ±ÇÂàÜÊûê' },
                    { from: 'Business Development', to: 'Legal Counsel', content: 'ÂêàÂêåÊù°Ê¨æÂÆ°Ê†∏' },
                    { from: 'Legal Counsel', to: 'Business Development', content: 'Ê≥ïÂæãÊÑèËßÅ' },
                    { from: 'Business Development', to: 'CEO', content: 'Âêà‰ΩúÊàêÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'pr-campaign',
                name: 'ÂÖ¨ÂÖ≥Ê¥ªÂä®',
                icon: 'üì£',
                desc: '‰ªéÁ≠ñÂàíÂà∞ÊâßË°åÁöÑÂìÅÁâåÂÖ¨ÂÖ≥Ê¥ªÂä®ÊµÅÁ®ã',
                agents: ['PR Manager', 'Brand Strategist', 'Content Strategist', 'CEO'],
                positions: [
                    { role: 'PR Manager', x: 400, y: 30 },
                    { role: 'Brand Strategist', x: 200, y: 150 },
                    { role: 'Content Strategist', x: 600, y: 150 },
                    { role: 'CEO', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'PR Manager', to: 'Brand Strategist', content: 'ÂìÅÁâåÂÖ¨ÂÖ≥Á≠ñÁï•ÈúÄÊ±Ç' },
                    { from: 'Brand Strategist', to: 'PR Manager', content: 'ÂìÅÁâåÂÆö‰ΩçÂª∫ËÆÆ' },
                    { from: 'PR Manager', to: 'Content Strategist', content: 'ÂÖ¨ÂÖ≥ÂÜÖÂÆπÈúÄÊ±Ç' },
                    { from: 'Content Strategist', to: 'PR Manager', content: 'ÂÜÖÂÆπÁ¥†Êùê' },
                    { from: 'PR Manager', to: 'CEO', content: 'ÂÖ¨ÂÖ≥Ê¥ªÂä®ÊïàÊûúÊä•Âëä' }
                ]
            },
            {
                id: 'strategic-planning',
                name: 'ÊàòÁï•ËßÑÂàí',
                icon: 'üéØ',
                desc: '‰ªéÁõÆÊ†áËÆæÂÆöÂà∞ÊàòÁï•ÊâßË°åÁöÑËßÑÂàíÊµÅÁ®ã',
                agents: ['Strategic Planner', 'CEO', 'CFO', 'Operations'],
                positions: [
                    { role: 'Strategic Planner', x: 400, y: 30 },
                    { role: 'CEO', x: 200, y: 150 },
                    { role: 'CFO', x: 600, y: 150 },
                    { role: 'Operations', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Strategic Planner', to: 'CEO', content: 'ÊàòÁï•ÁõÆÊ†áÂª∫ËÆÆ' },
                    { from: 'CEO', to: 'Strategic Planner', content: 'ÊàòÁï•ÊñπÂêëÁ°ÆËÆ§' },
                    { from: 'Strategic Planner', to: 'CFO', content: 'Ë¥¢Âä°È¢ÑÊµãÈúÄÊ±Ç' },
                    { from: 'CFO', to: 'Strategic Planner', content: 'Ë¥¢Âä°ÂèØË°åÊÄßÂàÜÊûê' },
                    { from: 'Strategic Planner', to: 'Operations', content: 'ÊâßË°åËÆ°Âàí' },
                    { from: 'Operations', to: 'CEO', content: 'ÊâßË°åËøõÂ∫¶Êä•Âëä' }
                ]
            },
            {
                id: 'channel-management',
                name: 'Ê∏†ÈÅìÁÆ°ÁêÜ',
                icon: 'üì°',
                desc: '‰ªéÊ∏†ÈÅìÂºÄÂèëÂà∞ËøêËê•ÁÆ°ÁêÜÁöÑÊ∏†ÈÅìÁ≠ñÁï•ÊµÅÁ®ã',
                agents: ['Channel Manager', 'Sales', 'Operations', 'Marketing'],
                positions: [
                    { role: 'Channel Manager', x: 400, y: 30 },
                    { role: 'Sales', x: 200, y: 150 },
                    { role: 'Operations', x: 600, y: 150 },
                    { role: 'Marketing', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Channel Manager', to: 'Sales', content: 'Ê∏†ÈÅìÈîÄÂîÆÁõÆÊ†á' },
                    { from: 'Sales', to: 'Channel Manager', content: 'Ê∏†ÈÅì‰∏öÁª©ÂèçÈ¶à' },
                    { from: 'Channel Manager', to: 'Operations', content: 'Ê∏†ÈÅìÁâ©ÊµÅÈúÄÊ±Ç' },
                    { from: 'Operations', to: 'Channel Manager', content: 'Ê∏†ÈÅìËøêËê•Êä•Âëä' },
                    { from: 'Channel Manager', to: 'Marketing', content: 'Ê∏†ÈÅìÊé®ÂπøËÆ°Âàí' },
                    { from: 'Marketing', to: 'Channel Manager', content: 'Êé®ÂπøÊïàÊûúÊï∞ÊçÆ' }
                ]
            },
            {
                id: 'investor-relations',
                name: 'ÊäïËµÑËÄÖÂÖ≥Á≥ª',
                icon: 'üíº',
                desc: '‰ªé‰ø°ÊÅØÊä´Èú≤Âà∞ÊäïËµÑËÄÖÊ≤üÈÄöÁöÑIRÊµÅÁ®ã',
                agents: ['Investment Analyst', 'CFO', 'CEO', 'PR Manager'],
                positions: [
                    { role: 'Investment Analyst', x: 400, y: 30 },
                    { role: 'CFO', x: 200, y: 150 },
                    { role: 'CEO', x: 600, y: 150 },
                    { role: 'PR Manager', x: 400, y: 270 }
                ],
                messageFlows: [
                    { from: 'Investment Analyst', to: 'CFO', content: 'Ë¥¢Âä°Êï∞ÊçÆÈúÄÊ±Ç' },
                    { from: 'CFO', to: 'Investment Analyst', content: 'Ë¥¢Âä°Êï∞ÊçÆÊèê‰æõ' },
                    { from: 'Investment Analyst', to: 'CEO', content: 'ÊäïËµÑËÄÖ‰ºöËÆÆÂáÜÂ§á' },
                    { from: 'CEO', to: 'Investment Analyst', content: 'Ë∑ØÊºîÊùêÊñôÁ°ÆËÆ§' },
                    { from: 'Investment Analyst', to: 'PR Manager', content: '‰ø°ÊÅØÊä´Èú≤ÈúÄÊ±Ç' },
                    { from: 'PR Manager', to: 'Investment Analyst', content: 'Â™í‰ΩìÂÖ≥Á≥ªÊä•Âëä' }
                ]
            }
        ];

        // Agent ËßíËâ≤ÈÖçÁΩÆ
        const agentRoles = {
            'CEO': { icon: 'üëî', color: '#8b5cf6', role: 'ÂÜ≥Á≠ñËÄÖ' },
            'CTO': { icon: 'üíª', color: '#3b82f6', role: 'ÊäÄÊúØ‰∏ªÁÆ°' },
            'Researcher': { icon: 'üîç', color: '#10b981', role: 'Á†îÁ©∂Âëò' },
            'Designer': { icon: 'üé®', color: '#ec4899', role: 'ËÆæËÆ°Â∏à' },
            'Developer': { icon: '‚ö°', color: '#f59e0b', role: 'ÂºÄÂèëËÄÖ' },
            'QA': { icon: 'üß™', color: '#06b6d4', role: 'ÊµãËØïÂ∑•Á®ãÂ∏à' },
            'Marketing': { icon: 'üì¢', color: '#ef4444', role: 'Â∏ÇÂú∫ÊÄªÁõë' },
            'Sales': { icon: 'üí∞', color: '#84cc16', role: 'ÈîÄÂîÆÊÄªÁõë' },
            'Product Manager': { icon: 'üìã', color: '#f97316', role: '‰∫ßÂìÅÁªèÁêÜ' },
            'CFO': { icon: 'üíπ', color: '#14b8a6', role: 'Ë¥¢Âä°ÊÄªÁõë' },
            'HR': { icon: 'üë§', color: '#a855f7', role: '‰∫∫ÂäõËµÑÊ∫ê' },
            // Êñ∞Â¢ûËßíËâ≤
            'Operations': { icon: '‚öôÔ∏è', color: '#64748b', role: 'ËøêËê•ÁªèÁêÜ' },
            'Data Analyst': { icon: 'üìä', color: '#0ea5e9', role: 'Êï∞ÊçÆÂàÜÊûêÂ∏à' },
            'Customer Support': { icon: 'üéß', color: '#22c55e', role: 'ÂÆ¢Êúç‰ª£Ë°®' },
            'Project Manager': { icon: 'üìå', color: '#e11d48', role: 'È°πÁõÆÁªèÁêÜ' },
            'DevOps': { icon: 'üîß', color: '#0891b2', role: 'ËøêÁª¥Â∑•Á®ãÂ∏à' },
            'Security': { icon: 'üõ°Ô∏è', color: '#dc2626', role: 'ÂÆâÂÖ®Â∑•Á®ãÂ∏à' },
            // Êñ∞Â¢ûËßíËâ≤
            'Legal Counsel': { icon: '‚öñÔ∏è', color: '#7c3aed', role: 'Ê≥ïÂä°È°æÈóÆ' },
            'QA Lead': { icon: 'üéØ', color: '#0d9488', role: 'QAË¥üË¥£‰∫∫' },
            'Technical Writer': { icon: 'üìù', color: '#6366f1', role: 'ÊäÄÊúØÊñáÊ°£Â∑•Á®ãÂ∏à' },
            'UX Researcher': { icon: 'üî¨', color: '#db2777', role: 'Áî®Êà∑‰ΩìÈ™åÁ†îÁ©∂Âëò' },
            // Êñ∞Â¢ûËßíËâ≤
            'Architect': { icon: 'üèóÔ∏è', color: '#0d9488', role: 'Á≥ªÁªüÊû∂ÊûÑÂ∏à' },
            'Data Engineer': { icon: 'üîÆ', color: '#8b5cf6', role: 'Êï∞ÊçÆÂ∑•Á®ãÂ∏à' },
            'ML Engineer': { icon: 'ü§ñ', color: '#ec4899', role: 'Êú∫Âô®Â≠¶‰π†Â∑•Á®ãÂ∏à' },
            'Product Designer': { icon: 'üéØ', color: '#f59e0b', role: '‰∫ßÂìÅËÆæËÆ°Â∏à' },
            'Business Analyst': { icon: 'üìà', color: '#22c55e', role: '‰∏öÂä°ÂàÜÊûêÂ∏à' },
            // Êñ∞Â¢ûËßíËâ≤
            'Growth Hacker': { icon: 'üöÄ', color: '#f97316', role: 'Â¢ûÈïøÈªëÂÆ¢' },
            'BI Analyst': { icon: 'üìä', color: '#06b6d4', role: 'ÂïÜ‰∏öÊô∫ËÉΩÂàÜÊûêÂ∏à' },
            'Content Strategist': { icon: '‚úçÔ∏è', color: '#a855f7', role: 'ÂÜÖÂÆπÁ≠ñÁï•Â∏à' },
            'SEO Specialist': { icon: 'üîé', color: '#84cc16', role: 'SEO ‰∏ìÂÆ∂' },
            'Community Manager': { icon: 'üåê', color: '#14b8a6', role: 'Á§æÂå∫ÁªèÁêÜ' },
            // Êñ∞Â¢ûËßíËâ≤
            'Technical Recruiter': { icon: 'üéØ', color: '#ec4899', role: 'ÊäÄÊúØÊãõËÅò‰∏ìÂëò' },
            'Brand Strategist': { icon: 'üíé', color: '#f59e0b', role: 'ÂìÅÁâåÁ≠ñÁï•Â∏à' },
            'Product Marketing': { icon: 'üì£', color: '#8b5cf6', role: '‰∫ßÂìÅËê•ÈîÄÁªèÁêÜ' },
            'Investment Analyst': { icon: 'üíº', color: '#0ea5e9', role: 'ÊäïËµÑÂàÜÊûêÂ∏à' },
            'Customer Success': { icon: 'ü§ù', color: '#22c55e', role: 'ÂÆ¢Êà∑ÊàêÂäüÁªèÁêÜ' },
            // Êñ∞Â¢ûËßíËâ≤
            'Risk Control': { icon: '‚ö†Ô∏è', color: '#dc2626', role: 'È£éÈô©ÊéßÂà∂‰∏ìÂëò' },
            'Business Development': { icon: 'ü§ù', color: '#7c3aed', role: 'ÂïÜÂä°ÊãìÂ±ïÁªèÁêÜ' },
            'PR Manager': { icon: 'üì£', color: '#f59e0b', role: 'ÂÖ¨ÂÖ≥ÁªèÁêÜ' },
            'Strategic Planner': { icon: 'üéØ', color: '#0d9488', role: 'ÊàòÁï•ËßÑÂàíÂ∏à' },
            'Channel Manager': { icon: 'üì°', color: '#06b6d4', role: 'Ê∏†ÈÅìÁÆ°ÁêÜÁªèÁêÜ' }
        };

        // ÊãñÊãΩÁõ∏ÂÖ≥ÂèòÈáè
        let draggedRole = null;
        let dragOverX = 0;
        let dragOverY = 0;

        // ËøûÊé•Áõ∏ÂÖ≥ÂèòÈáè
        let isConnecting = false;
        let connectFromAgent = null;
        let connectionLine = null;

        // Ê∏≤ÊüìËßíËâ≤Âç°ÁâåÔºàÁî®‰∫éÊãñÊãΩÔºâ
        function renderRoleCards() {
            const container = document.getElementById('roleCards');
            const roles = Object.entries(agentRoles);

            container.innerHTML = roles.map(([key, value]) => `
                <div class="role-card" draggable="true" data-role="${key}">
                    <div class="role-card-icon" style="background: ${value.color}20; color: ${value.color}">
                        ${value.icon}
                    </div>
                    <div class="role-card-info">
                        <div class="role-card-name">${key}</div>
                        <div class="role-card-role">${value.role}</div>
                    </div>
                </div>
            `).join('');

            // Ê∑ªÂä†ÊãñÊãΩ‰∫ã‰ª∂ÁõëÂê¨
            document.querySelectorAll('.role-card').forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });
        }

        // ÊãñÊãΩÂºÄÂßã
        function handleDragStart(e) {
            draggedRole = e.target.dataset.role;
            e.target.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'copy';
            e.dataTransfer.setData('text/plain', draggedRole);

            // ÊòæÁ§∫ÊîæÁΩÆÂå∫Âüü
            const visualization = document.getElementById('visualization');
            visualization.classList.add('drag-over');
        }

        // ÊãñÊãΩÁªìÊùü
        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
            draggedRole = null;

            // ÈöêËóèÊîæÁΩÆÂå∫Âüü
            const visualization = document.getElementById('visualization');
            visualization.classList.remove('drag-over');
            document.getElementById('dropIndicator').classList.remove('show');
        }

        // ÂèØËßÜÂåñÂå∫ÂüüÊãñÊãΩ‰∫ã‰ª∂
        const visualization = document.getElementById('visualization');

        visualization.addEventListener('dragover', function(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'copy';

            // Êõ¥Êñ∞ÊîæÁΩÆÊåáÁ§∫Âô®‰ΩçÁΩÆ
            const rect = visualization.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            const indicator = document.getElementById('dropIndicator');
            indicator.style.left = (x - 40) + 'px';
            indicator.style.top = (y - 40) + 'px';
            indicator.classList.add('show');

            visualization.classList.add('drag-over');
        });

        visualization.addEventListener('dragleave', function(e) {
            if (!visualization.contains(e.relatedTarget)) {
                visualization.classList.remove('drag-over');
                document.getElementById('dropIndicator').classList.remove('show');
            }
        });

        visualization.addEventListener('drop', function(e) {
            e.preventDefault();
            visualization.classList.remove('drag-over');
            document.getElementById('dropIndicator').classList.remove('show');

            const role = e.dataTransfer.getData('text/plain') || draggedRole;
            if (!role || !agentRoles[role]) return;

            // ËÆ°ÁÆóÊîæÁΩÆ‰ΩçÁΩÆ
            const rect = visualization.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // ÂàõÂª∫Êñ∞ Agent
            const newId = Math.max(...agents.map(a => a.id), 0) + 1;
            const roleInfo = agentRoles[role];
            const newAgent = {
                id: newId,
                name: role,
                role: role,
                status: 'waiting',
                x: x,
                y: y
            };
            agents.push(newAgent);

            // Â¶ÇÊûúÂú® 3D Ê®°ÂºèÔºåÊõ¥Êñ∞ 3D Âú∫ÊôØ
            if (is3DMode && scene) {
                updateAgentMeshes();
                updateMessageParticles();
            }

            renderAgents();
            renderFlow();
            selectAgent(newId);

            showNotification(`Â∑≤ÂàõÂª∫ ${roleInfo.role}: ${role}`, 'success');
        });

        // ÂàùÂßãÂåñÁ§∫‰æãÊï∞ÊçÆ
        function initDemo() {
            agents = [
                { id: 1, name: 'Bezos', role: 'CEO', status: 'running', x: 400, y: 300 },
                { id: 2, name: 'Vogels', role: 'CTO', status: 'waiting', x: 200, y: 150 },
                { id: 3, name: 'Thompson', role: 'Researcher', status: 'completed', x: 200, y: 450 },
                { id: 4, name: 'Duarte', role: 'Designer', status: 'waiting', x: 600, y: 150 },
                { id: 5, name: 'Bach', role: 'QA', status: 'waiting', x: 600, y: 450 }
            ];

            messages = [
                { from: 1, to: 2, content: 'ÂàÜÊûêÊñ∞È°πÁõÆÊäÄÊúØÊñπÊ°à', time: '10:00' },
                { from: 1, to: 3, content: 'Ë∞ÉÁ†îÂ∏ÇÂú∫ËßÑÊ®°', time: '10:05' },
                { from: 2, to: 4, content: 'ÈúÄË¶ÅUIËÆæËÆ°Á®ø', time: '10:15' },
                { from: 3, to: 1, content: 'Â∏ÇÂú∫ËßÑÊ®°Ë∞ÉÁ†îÂÆåÊàê', time: '10:30' },
                { from: 4, to: 1, content: 'ËÆæËÆ°Á®øÂ∑≤ÂÆåÊàê', time: '10:45' },
                { from: 1, to: 5, content: 'ÂáÜÂ§áÊµãËØïËÆ°Âàí', time: '11:00' }
            ];

            renderAgents();
            renderRoleCards();
            renderFlow();
            updateTimeline();
        }

        // Ê∏≤Êüì Agent ÂàóË°®
        function renderAgents() {
            const list = document.getElementById('agentList');

            // Â¶ÇÊûúÊúâÂàÜÁªÑÔºåÊåâÂàÜÁªÑÊòæÁ§∫
            if (agentGroups.length > 0) {
                let html = '';

                // Â∑≤ÂàÜÁªÑÁöÑ Agent
                agentGroups.forEach(group => {
                    const groupAgents = agents.filter(a => group.agents.includes(a.id));
                    if (groupAgents.length > 0) {
                        html += `
                            <div class="agent-group">
                                <div class="agent-group-header" onclick="toggleGroupExpand('${group.id}')">
                                    <div class="agent-group-title">
                                        <span style="width: 10px; height: 10px; border-radius: 50%; background: ${group.color};"></span>
                                        ${group.name}
                                        <span class="agent-group-count">${groupAgents.length}</span>
                                    </div>
                                </div>
                                <div class="agent-group-items" id="group_${group.id}">
                                    ${groupAgents.map(agent => renderAgentItem(agent)).join('')}
                                </div>
                            </div>
                        `;
                    }
                });

                // Êú™ÂàÜÁªÑÁöÑ Agent
                const ungroupedAgents = agents.filter(a => !agentGroups.some(g => g.agents.includes(a.id)));
                if (ungroupedAgents.length > 0) {
                    html += `
                        <div class="agent-group">
                            <div class="agent-group-header" onclick="toggleGroupExpand('ungrouped')">
                                <div class="agent-group-title">
                                    <span style="width: 10px; height: 10px; border-radius: 50%; background: var(--text-secondary);"></span>
                                    Êú™ÂàÜÁªÑ
                                    <span class="agent-group-count">${ungroupedAgents.length}</span>
                                </div>
                            </div>
                            <div class="agent-group-items" id="group_ungrouped">
                                ${ungroupedAgents.map(agent => renderAgentItem(agent)).join('')}
                            </div>
                        </div>
                    `;
                }

                list.innerHTML = html;
            } else {
                // Êó†ÂàÜÁªÑÔºåÊ≠£Â∏∏ÊòæÁ§∫
                list.innerHTML = agents.map(agent => renderAgentItem(agent)).join('');
            }
        }

        // Ê∏≤ÊüìÂçï‰∏™ Agent È°π
        function renderAgentItem(agent) {
            return `
                <div class="agent-item ${selectedAgent === agent.id ? 'active' : ''} ${selectedAgents.has(agent.id) ? 'selected' : ''}" onclick="${batchMode ? `toggleAgentSelection(${agent.id})` : `selectAgent(${agent.id})`}">
                    ${batchMode ? `<div class="agent-checkbox ${selectedAgents.has(agent.id) ? 'checked' : ''}">${selectedAgents.has(agent.id) ? '‚úì' : ''}</div>` : ''}
                    <div class="agent-avatar" style="background: ${agentRoles[agent.role]?.color || '#6b7280'}20; color: ${agentRoles[agent.role]?.color || '#6b7280'}">
                        ${agentRoles[agent.role]?.icon || 'ü§ñ'}
                    </div>
                    <div class="agent-info">
                        <div class="agent-name">${agent.name}</div>
                        <div class="agent-role">${agentRoles[agent.role]?.role || agent.role}</div>
                    </div>
                    <div class="agent-status status-${agent.status}"></div>
                </div>
            `;
        }

        // ÂàáÊç¢ÂàÜÁªÑÂ±ïÂºÄ/Êî∂Ëµ∑
        function toggleGroupExpand(groupId) {
            const el = document.getElementById('group_' + groupId);
            if (el) {
                el.style.display = el.style.display === 'none' ? 'block' : 'none';
            }
        }

        // Ê∏≤ÊüìÊµÅÁ®ãÂõæ
        function renderFlow() {
            const nodesGroup = document.getElementById('nodes');
            const connectionsGroup = document.getElementById('connections');
            const emptyState = document.getElementById('emptyState');

            if (agents.length === 0) {
                emptyState.style.display = 'block';
                nodesGroup.innerHTML = '';
                connectionsGroup.innerHTML = '';
                return;
            }

            emptyState.style.display = 'none';

            // ÁªòÂà∂ËøûÁ∫ø
            connectionsGroup.innerHTML = messages.map((msg, idx) => {
                const fromAgent = agents.find(a => a.id === msg.from);
                const toAgent = agents.find(a => a.id === msg.to);
                if (!fromAgent || !toAgent) return '';

                return `
                    <line
                        x1="${fromAgent.x}" y1="${fromAgent.y}"
                        x2="${toAgent.x}" y2="${toAgent.y}"
                        stroke="url(#lineGradient)"
                        stroke-width="2"
                        marker-end="url(#arrowhead)"
                        class="flowing"
                        style="animation-delay: ${idx * 0.5}s"
                    />
                `;
            }).join('');

            // ÁªòÂà∂ËäÇÁÇπ
            nodesGroup.innerHTML = agents.map(agent => {
                const role = agentRoles[agent.role] || { color: '#6b7280', icon: 'ü§ñ' };
                const isSelected = selectedAgents.has(agent.id);
                const strokeWidth = isSelected ? 4 : 2;

                // Ê£ÄÊü•ÊòØÂê¶ÊúâÂÖ∂‰ªñÁî®Êà∑Ê≠£Âú®ÁºñËæëÊ≠§ Agent
                let beingEditedByOther = false;
                let editingPeerCount = 0;
                Object.values(peerSelections).forEach(selectedAgentId => {
                    if (selectedAgentId === agent.id) {
                        beingEditedByOther = true;
                        editingPeerCount++;
                    }
                });

                return `
                    <g class="agent-node ${isSelected ? 'selected' : ''}" onclick="${batchMode ? `toggleAgentSelection(${agent.id})` : `selectAgent(${agent.id})`}" onmousedown="startConnection(event, ${agent.id})" style="cursor: pointer">
                        ${beingEditedByOther ? `
                        <circle
                            cx="${agent.x}" cy="${agent.y}" r="40"
                            fill="none"
                            stroke="#f97316"
                            stroke-width="3"
                            stroke-dasharray="5,3"
                            opacity="0.8"
                        >
                            <animateTransform attributeName="transform" type="rotate" from="0 ${agent.x} ${agent.y}" to="360 ${agent.x} ${agent.y}" dur="3s" repeatCount="indefinite"/>
                        </circle>
                        ` : ''}
                        <circle
                            cx="${agent.x}" cy="${agent.y}" r="35"
                            fill="${role.color}20"
                            stroke="${isSelected ? '#fff' : role.color}"
                            stroke-width="${strokeWidth}"
                        />
                        ${batchMode ? `<circle cx="${agent.x - 25}" cy="${agent.y - 25}" r="10" fill="${isSelected ? '#8b5cf6' : '#334155'}" stroke="#fff" stroke-width="2"/><text x="${agent.x - 25}" y="${agent.y - 21}" text-anchor="middle" fill="#fff" font-size="10" font-weight="bold">${isSelected ? '‚úì' : ''}</text>` : ''}
                        <text x="${agent.x}" y="${agent.y - 5}" text-anchor="middle" fill="${role.color}" font-size="20">
                            ${role.icon}
                        </text>
                        <text x="${agent.x}" y="${agent.y + 18}" text-anchor="middle" fill="#f1f5f9" font-size="12" font-weight="500">
                            ${agent.name}
                        </text>
                        <circle
                            cx="${agent.x + 25}" cy="${agent.y - 25}" r="8"
                            fill="${getStatusColor(agent.status)}"
                            stroke="#1e293b"
                            stroke-width="2"
                        />
                        ${beingEditedByOther ? `
                        <circle cx="${agent.x - 25}" cy="${agent.y + 25}" r="12" fill="#f97316" stroke="#fff" stroke-width="2">
                            <title>ÂÖ∂‰ªñÁî®Êà∑Ê≠£Âú®ÁºñËæëÊ≠§ Agent</title>
                        </circle>
                        <text x="${agent.x - 25}" y="${agent.y + 29}" text-anchor="middle" fill="#fff" font-size="12">‚úèÔ∏è</text>
                        ` : ''}
                        <!-- ËøûÊé•ÁÇπ -->
                        <circle cx="${agent.x + 35}" cy="${agent.y}" r="6" fill="var(--accent)" opacity="0" class="connect-point">
                            <title>ÊãñÊãΩÂàõÂª∫ËøûÊé•</title>
                        </circle>
                    </g>
                `;
            }).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'running': '#22c55e',
                'waiting': '#eab308',
                'completed': '#6b7280',
                'failed': '#ef4444'
            };
            return colors[status] || '#6b7280';
        }

        // ======== ÊãñÊãΩËøûÊé•ÂäüËÉΩ ========

        // ÂºÄÂßãËøûÊé•
        function startConnection(event, agentId) {
            // Â¶ÇÊûúÊòØÁÇπÂáªËäÇÁÇπ‰∏äÁöÑÁâπÂÆöÂå∫ÂüüÔºàÂ¶ÇÁä∂ÊÄÅÁêÉÔºâÔºå‰∏çÂêØÂä®ËøûÊé•
            if (event.target.classList.contains('connect-point') || event.target.tagName === 'circle') {
                event.preventDefault();
                isConnecting = true;
                connectFromAgent = agentId;

                // ÂàõÂª∫ËøûÊé•Á∫ø
                const connectionsGroup = document.getElementById('connections');
                const svg = document.getElementById('flowCanvas');
                const rect = svg.getBoundingClientRect();

                const agent = agents.find(a => a.id === agentId);
                connectionLine = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                connectionLine.setAttribute('x1', agent.x);
                connectionLine.setAttribute('y1', agent.y);
                connectionLine.setAttribute('x2', agent.x);
                connectionLine.setAttribute('y2', agent.y);
                connectionLine.setAttribute('class', 'connection-preview');
                connectionsGroup.appendChild(connectionLine);

                // Ê∑ªÂä†ÂÖ®Â±ÄÈº†Ê†á‰∫ã‰ª∂
                document.addEventListener('mousemove', updateConnectionLine);
                document.addEventListener('mouseup', endConnection);

                // ÈòªÊ≠¢‰∫ã‰ª∂‰º†Êí≠
                event.stopPropagation();
            }
        }

        // Êõ¥Êñ∞ËøûÊé•Á∫ø
        function updateConnectionLine(event) {
            if (!isConnecting || !connectionLine) return;

            const svg = document.getElementById('flowCanvas');
            const rect = svg.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            connectionLine.setAttribute('x2', x);
            connectionLine.setAttribute('y2', y);
        }

        // ÁªìÊùüËøûÊé•
        function endConnection(event) {
            if (!isConnecting) return;

            // ÁßªÈô§‰∫ã‰ª∂ÁõëÂê¨
            document.removeEventListener('mousemove', updateConnectionLine);
            document.removeEventListener('mouseup', endConnection);

            // Ê£ÄÊü•ÊòØÂê¶ÈáäÊîæÁõÆÊ†áÊòØ‰∏Ä‰∏™ Agent
            const svg = document.getElementById('flowCanvas');
            const rect = svg.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            // Êü•ÊâæÁõÆÊ†á Agent
            const targetAgent = agents.find(agent => {
                const dx = agent.x - x;
                const dy = agent.y - y;
                return Math.sqrt(dx * dx + dy * dy) < 40;
            });

            if (targetAgent && targetAgent.id !== connectFromAgent) {
                // ÊâìÂºÄÊ∂àÊÅØËæìÂÖ•Ê°Ü
                openMessageModal(connectFromAgent, targetAgent.id);
            }

            // ÁßªÈô§ËøûÊé•Á∫ø
            if (connectionLine) {
                connectionLine.remove();
                connectionLine = null;
            }

            isConnecting = false;
            connectFromAgent = null;
        }

        // ÊâìÂºÄÊ∂àÊÅØËæìÂÖ•Ê°Ü
        function openMessageModal(fromId, toId) {
            const fromAgent = agents.find(a => a.id === fromId);
            const toAgent = agents.find(a => a.id === toId);

            document.getElementById('connFromName').textContent = fromAgent.name;
            document.getElementById('connToName').textContent = toAgent.name;
            document.getElementById('messageContent').value = '';
            document.getElementById('messageModal').classList.add('show');

            // Â≠òÂÇ®ËøûÊé•‰ø°ÊÅØ
            document.getElementById('messageModal').dataset.fromId = fromId;
            document.getElementById('messageModal').dataset.toId = toId;

            document.getElementById('messageContent').focus();
        }

        // ÂÖ≥Èó≠Ê∂àÊÅØËæìÂÖ•Ê°Ü
        function closeMessageModal() {
            document.getElementById('messageModal').classList.remove('show');
        }

        // ÂàõÂª∫ËøûÊé•
        function createConnection() {
            const modal = document.getElementById('messageModal');
            const fromId = parseInt(modal.dataset.fromId);
            const toId = parseInt(modal.dataset.toId);
            const content = document.getElementById('messageContent').value.trim();

            if (!content) {
                alert('ËØ∑ËæìÂÖ•Ê∂àÊÅØÂÜÖÂÆπ');
                return;
            }

            // ÂàõÂª∫Êñ∞Ê∂àÊÅØ
            const newMessage = {
                from: fromId,
                to: toId,
                content: content,
                time: new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' })
            };
            messages.push(newMessage);

            // Êõ¥Êñ∞ÊòæÁ§∫
            renderFlow();
            updateTimeline();

            // ÂπøÊí≠ÁªôÂçè‰ΩúËÄÖ
            if (collaborationStatus !== 'disconnected') {
                notifyCollaborators('add-message', { message: newMessage });
            }

            closeMessageModal();
            showNotification('Ê∂àÊÅØËøûÊé•Â∑≤ÂàõÂª∫', 'success');
        }

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('messageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeMessageModal();
            }
        });

        // ======== ÁªìÊùüÊãñÊãΩËøûÊé•ÂäüËÉΩ ========

        // ÈÄâÊã© Agent
        function selectAgent(id) {
            selectedAgent = id;
            renderAgents();
            renderDetails();

            // Âú®Âçè‰ΩúÊ®°Âºè‰∏ãÂπøÊí≠ÈÄâ‰∏≠ÁöÑ Agent
            if (collaborationStatus !== 'disconnected') {
                broadcastSelection(id);
            }
        }

        // ÂπøÊí≠ÈÄâ‰∏≠ÁöÑ Agent
        function broadcastSelection(agentId) {
            const message = {
                type: 'selection',
                data: {
                    agentId: agentId,
                    peerId: peer?.id || 'unknown'
                }
            };
            // Host ÂèëÈÄÅÁªôÊâÄÊúâËøûÊé•ËÄÖ
            if (isHost) {
                connections.forEach(conn => {
                    if (conn.open) {
                        conn.send(message);
                    }
                });
            }
            // ËøûÊé•ËÄÖÂèëÈÄÅÁªô host
            else if (peer) {
                connections.forEach(conn => {
                    if (conn.open) {
                        conn.send(message);
                    }
                });
            }
        }

        // Ê∏≤ÊüìËØ¶ÊÉÖÈù¢Êùø
        // ÂèØÁî®Ê®°ÂûãÈÖçÁΩÆ
        const availableModels = {
            openai: [
                { id: 'gpt-4o', name: 'GPT-4o' },
                { id: 'gpt-4o-mini', name: 'GPT-4o mini' },
                { id: 'gpt-4-turbo', name: 'GPT-4 Turbo' }
            ],
            anthropic: [
                { id: 'claude-3-5-sonnet-20241022', name: 'Claude 3.5 Sonnet' },
                { id: 'claude-3-opus-20240229', name: 'Claude 3 Opus' },
                { id: 'claude-3-haiku-20240307', name: 'Claude 3 Haiku' }
            ],
            google: [
                { id: 'gemini-1.5-pro', name: 'Gemini 1.5 Pro' },
                { id: 'gemini-1.5-flash', name: 'Gemini 1.5 Flash' },
                { id: 'gemini-1.0-pro', name: 'Gemini 1.0 Pro' }
            ],
            ollama: [
                { id: 'llama2', name: 'Llama 2' },
                { id: 'mistral', name: 'Mistral' },
                { id: 'qwen', name: 'Qwen' },
                { id: 'deepseek', name: 'DeepSeek' }
            ]
        };

        // Agent ÂØπËØùÂéÜÂè≤
        let agentChats = {};

        function getModelBadgeClass(provider) {
            return 'model-badge model-badge-' + provider;
        }

        function getProviderFromModel(modelId) {
            if (availableModels.openai.some(m => m.id === modelId)) return 'openai';
            if (availableModels.anthropic.some(m => m.id === modelId)) return 'anthropic';
            if (availableModels.google.some(m => m.id === modelId)) return 'google';
            return 'ollama';
        }

        function renderDetails() {
            const panel = document.getElementById('panelContent');
            const agent = agents.find(a => a.id === selectedAgent);

            if (!agent) {
                panel.innerHTML = `
                    <p style="color: var(--text-secondary); text-align: center; padding: 40px 0;">
                        ÈÄâÊã©‰∏Ä‰∏™ Agent Êü•ÁúãËØ¶ÊÉÖ
                    </p>
                `;
                return;
            }

            // ÂàùÂßãÂåñ agent ÁöÑÂØπËØùÂéÜÂè≤
            if (!agentChats[agent.id]) {
                agentChats[agent.id] = [];
            }

            const role = agentRoles[agent.role] || { role: agent.role };
            const agentMessages = messages.filter(m => m.from === agent.id || m.to === agent.id);
            const currentModel = agent.model || 'gpt-4o-mini';
            const currentProvider = getProviderFromModel(currentModel);

            // ÁîüÊàêÊ®°ÂûãÈÄâÈ°π
            let modelOptions = '';
            for (const [provider, models] of Object.entries(availableModels)) {
                const hasKeys = apiKeys[provider] && apiKeys[provider].length > 0;
                const disabled = !hasKeys && provider !== 'ollama';
                modelOptions += `<optgroup label="${provider.toUpperCase()}" ${disabled ? 'disabled' : ''}>`;
                models.forEach(m => {
                    const selected = m.id === currentModel ? 'selected' : '';
                    modelOptions += `<option value="${m.id}" ${selected}>${m.name}</option>`;
                });
                modelOptions += '</optgroup>';
            }

            panel.innerHTML = `
                <div class="detail-section">
                    <h3>Âü∫Êú¨‰ø°ÊÅØ</h3>
                    <div class="detail-item">
                        <span class="detail-label">ÂêçÁß∞</span>
                        <span class="detail-value">${agent.name}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">ËßíËâ≤</span>
                        <span class="detail-value">${role.role}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Áä∂ÊÄÅ</span>
                        <span class="detail-value" style="color: ${getStatusColor(agent.status)}">
                            ${getStatusText(agent.status)}
                        </span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">AI Ê®°Âûã</span>
                        <span class="detail-value">
                            ${availableModels[currentProvider]?.find(m => m.id === currentModel)?.name || currentModel}
                            <span class="${getModelBadgeClass(currentProvider)}">${currentProvider.toUpperCase()}</span>
                        </span>
                    </div>
                </div>
                <div class="detail-section">
                    <h3>Ê∂àÊÅØÂéÜÂè≤ (${agentMessages.length})</h3>
                    <div class="message-list">
                        ${agentMessages.length > 0 ? agentMessages.map(msg => {
                            const fromAgent = agents.find(a => a.id === msg.from);
                            const toAgent = agents.find(a => a.id === msg.to);
                            return `
                                <div class="message-item">
                                    <div class="message-header">
                                        <span>
                                            <span class="message-from">${fromAgent?.name || 'Êú™Áü•'}</span>
                                            ‚Üí
                                            <span class="message-to">${toAgent?.name || 'Êú™Áü•'}</span>
                                        </span>
                                        <span class="message-time">${msg.time}</span>
                                    </div>
                                    <div class="message-content">${msg.content}</div>
                                </div>
                            `;
                        }).join('') : '<p style="color: var(--text-secondary); font-size: 13px;">ÊöÇÊó†Ê∂àÊÅØ</p>'}
                    </div>
                </div>
                <div class="ai-chat-panel">
                    <div class="ai-chat-title">
                        <span>ü§ñ AI ÂØπËØù</span>
                    </div>
                    <select class="ai-model-select" id="modelSelect" onchange="changeAgentModel(${agent.id})">
                        ${modelOptions}
                    </select>
                    <div class="ai-chat-messages" id="chatMessages">
                        ${agentChats[agent.id].map(chat => `
                            <div class="ai-message ${chat.role === 'user' ? 'ai-message-user' : 'ai-message-ai'}">
                                ${chat.content}
                            </div>
                        `).join('')}
                    </div>
                    <div class="ai-chat-input">
                        <input type="text" id="chatInput" placeholder="ËæìÂÖ•Ê∂àÊÅØ‰∏é AI ÂØπËØù..." onkeypress="handleChatKeyPress(event, ${agent.id})">
                        <button onclick="sendChatMessage(${agent.id})" id="sendBtn">ÂèëÈÄÅ</button>
                    </div>
                </div>
                <div class="task-execution-panel">
                    <div class="task-title">
                        <span>‚ö° ‰ªªÂä°ÊâßË°å</span>
                    </div>
                    <div class="task-desc">
                        Áªô Agent ÂàÜÈÖçÂÖ∑‰Ωì‰ªªÂä°ÔºåËÆ©ÂÆÉÊâßË°åÂπ∂ËøîÂõûÁªìÊûú
                    </div>
                    <div class="task-input-area">
                        <textarea id="taskInput" placeholder="ÊèèËø∞Ë¶ÅÊâßË°åÁöÑ‰ªªÂä°Ôºå‰æãÂ¶ÇÔºö'Â∏ÆÊàëÂàÜÊûêËøô‰∏™È°πÁõÆÁöÑÊû∂ÊûÑ'"></textarea>
                    </div>
                    <div class="task-actions">
                        <button class="btn btn-primary" onclick="executeAgentTask(${agent.id})" id="executeTaskBtn">ÊâßË°å‰ªªÂä°</button>
                        <button class="btn btn-secondary" onclick="clearAgentTask(${agent.id})">Ê∏ÖÁ©∫</button>
                    </div>
                    <div class="task-result" id="taskResult" style="display: none;">
                        <div class="task-result-header">ÊâßË°åÁªìÊûúÔºö</div>
                        <div class="task-result-content" id="taskResultContent"></div>
                    </div>
                </div>
            `;
        }

        function changeAgentModel(agentId) {
            const select = document.getElementById('modelSelect');
            const agent = agents.find(a => a.id === agentId);
            if (agent && select) {
                agent.model = select.value;
                renderDetails();
                showNotification('Ê®°ÂûãÂ∑≤ÂàáÊç¢', 'success');
            }
        }

        function handleChatKeyPress(event, agentId) {
            if (event.key === 'Enter') {
                sendChatMessage(agentId);
            }
        }

        async function sendChatMessage(agentId) {
            const input = document.getElementById('chatInput');
            const sendBtn = document.getElementById('sendBtn');
            const content = input.value.trim();

            if (!content) return;

            const agent = agents.find(a => a.id === agentId);
            if (!agent) return;

            const model = agent.model || 'gpt-4o-mini';
            const provider = getProviderFromModel(model);

            // Ê£ÄÊü• API Key
            if (!apiKeys[provider] || apiKeys[provider].length === 0) {
                showNotification('ËØ∑ÂÖàÈÖçÁΩÆ ' + provider.toUpperCase() + ' API Key', 'error');
                openApiKeysModal();
                return;
            }

            // Ê∑ªÂä†Áî®Êà∑Ê∂àÊÅØ
            if (!agentChats[agentId]) {
                agentChats[agentId] = [];
            }
            agentChats[agentId].push({ role: 'user', content: content });

            // Êõ¥Êñ∞ UI
            renderDetails();

            // Á¶ÅÁî®ÊåâÈíÆ
            sendBtn.disabled = true;
            sendBtn.textContent = 'ÂèëÈÄÅ‰∏≠...';

            try {
                const response = await callAIApi(provider, model, agentChats[agentId], agent);
                agentChats[agentId].push({ role: 'assistant', content: response });
            } catch (error) {
                agentChats[agentId].push({ role: 'assistant', content: 'Êä±Ê≠âÔºåÂèëÁîüÈîôËØØ: ' + error.message });
            }

            // ÈáçÊñ∞Ê∏≤Êüì
            renderDetails();

            // ÊªöÂä®Âà∞Â∫ïÈÉ®
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                if (chatMessages) {
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            }, 100);
        }

        // ======== Agent ‰ªªÂä°ÊâßË°åÂäüËÉΩ ========
        async function executeAgentTask(agentId) {
            const taskInput = document.getElementById('taskInput');
            const executeBtn = document.getElementById('executeTaskBtn');
            const taskResult = document.getElementById('taskResult');
            const taskResultContent = document.getElementById('taskResultContent');

            const task = taskInput.value.trim();
            if (!task) {
                showNotification('ËØ∑ËæìÂÖ•‰ªªÂä°ÊèèËø∞', 'error');
                return;
            }

            const agent = agents.find(a => a.id === agentId);
            if (!agent) return;

            const model = agent.model || 'gpt-4o-mini';
            const provider = getProviderFromModel(model);

            // Ê£ÄÊü• API Key
            if (!apiKeys[provider] || apiKeys[provider].length === 0) {
                showNotification('ËØ∑ÂÖàÈÖçÁΩÆ ' + provider.toUpperCase() + ' API Key', 'error');
                openApiKeysModal();
                return;
            }

            // Êõ¥Êñ∞ Agent Áä∂ÊÄÅ
            agent.status = 'running';
            renderAgents();

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            executeBtn.disabled = true;
            executeBtn.textContent = 'ÊâßË°å‰∏≠...';
            taskResult.style.display = 'none';

            try {
                // ÊûÑÂª∫‰ªªÂä°‰∏ä‰∏ãÊñá
                const roleInfo = agentRoles[agent.role] || { role: agent.role };
                const taskContext = [
                    {
                        role: 'system',
                        content: `‰Ω†ÊòØ‰∏Ä‰∏™‰∏ì‰∏öÁöÑ ${roleInfo.role} (${agent.name})„ÄÇ‰Ω†ÁöÑËÅåË¥£ÊòØÔºö${getAgentSystemPrompt(agent.role)}`
                    },
                    {
                        role: 'user',
                        content: `ËØ∑ÊâßË°å‰ª•‰∏ã‰ªªÂä°Ôºö\n\n${task}\n\nËØ∑Êèê‰æõËØ¶ÁªÜÁöÑÊâßË°åÊ≠•È™§ÂíåÁªìÊûú„ÄÇ`
                    }
                ];

                const response = await callAIApi(provider, model, taskContext, agent);

                // ÊòæÁ§∫ÁªìÊûú
                taskResultContent.textContent = response;
                taskResult.style.display = 'block';

                // ‰øùÂ≠òÂà∞Ê∂àÊÅØÂéÜÂè≤
                messages.push({
                    id: messages.length + 1,
                    from: agentId,
                    to: agentId,
                    content: `[‰ªªÂä°ÊâßË°å] ${task}\n\n[ÁªìÊûú] ${response}`,
                    timestamp: messages.length,
                    time: new Date().toLocaleTimeString()
                });

                // Êõ¥Êñ∞ Agent Áä∂ÊÄÅ‰∏∫ÂÆåÊàê
                agent.status = 'completed';
                renderAgents();
                renderFlow();

                showNotification('‰ªªÂä°ÊâßË°åÂÆåÊàê', 'success');

            } catch (error) {
                showNotification('‰ªªÂä°ÊâßË°åÂ§±Ë¥•: ' + error.message, 'error');
                agent.status = 'failed';
                renderAgents();
            }

            // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
            executeBtn.disabled = false;
            executeBtn.textContent = 'ÊâßË°å‰ªªÂä°';
        }

        function clearAgentTask(agentId) {
            const taskInput = document.getElementById('taskInput');
            const taskResult = document.getElementById('taskResult');
            taskInput.value = '';
            taskResult.style.display = 'none';
        }

        function getAgentSystemPrompt(role) {
            const prompts = {
                'CEO': 'Âà∂ÂÆöÂÖ¨Âè∏ÊàòÁï•„ÄÅÂÅöÂá∫ÈáçÂ§ßÂÜ≥Á≠ñ„ÄÅËØÑ‰º∞‰∏öÂä°Êú∫‰ºö„ÄÅÁÆ°ÁêÜÂõ¢Èòü',
                'CTO': 'ÊäÄÊúØÊû∂ÊûÑËÆæËÆ°„ÄÅÊäÄÊúØÈÄâÂûã„ÄÅÁ≥ªÁªüÊÄßËÉΩ‰ºòÂåñ„ÄÅÊäÄÊúØÂõ¢ÈòüÁÆ°ÁêÜ',
                'Researcher': 'Â∏ÇÂú∫Ë∞ÉÁ†î„ÄÅÁ´ûÂìÅÂàÜÊûê„ÄÅË°å‰∏öË∂ãÂäøÂà§Êñ≠„ÄÅÁî®Êà∑ÈúÄÊ±ÇÈ™åËØÅ',
                'Designer': 'Áî®Êà∑ÁïåÈù¢ËÆæËÆ°„ÄÅÁî®Êà∑‰ΩìÈ™å‰ºòÂåñ„ÄÅÂìÅÁâåËßÜËßâËÆæËÆ°',
                'Developer': '‰ª£Á†ÅÁºñÂÜô„ÄÅÂäüËÉΩÂÆûÁé∞„ÄÅÊäÄÊúØÈöæÈ¢òËß£ÂÜ≥„ÄÅÁ≥ªÁªüÂºÄÂèë',
                'QA': 'ÊµãËØïËÆ°ÂàíÂà∂ÂÆö„ÄÅË¥®Èáè‰øùËØÅ„ÄÅbug ÂèëÁé∞‰∏éËøΩË∏™„ÄÅÊµãËØïÁî®‰æãÁºñÂÜô',
                'Marketing': 'Â∏ÇÂú∫Êé®Âπø„ÄÅÂìÅÁâåÂª∫ËÆæ„ÄÅÂÜÖÂÆπËê•ÈîÄ„ÄÅÁî®Êà∑Ëé∑Âèñ',
                'Sales': 'ÂÆ¢Êà∑ÂºÄÂèë„ÄÅÈîÄÂîÆË∞àÂà§„ÄÅ‰∏öÁª©ÁõÆÊ†áËææÊàê„ÄÅÂÆ¢Êà∑ÂÖ≥Á≥ªÁª¥Êä§'
            };
            return prompts[role] || 'ÂÆåÊàêÂàÜÈÖçÁöÑ‰ªªÂä°';
        }

        async function callAIApi(provider, model, conversation, agent) {
            const apiKey = apiKeys[provider][0].key;

            // ËΩ¨Êç¢ÂØπËØùÊ†ºÂºè
            const messages = conversation.map(c => ({
                role: c.role === 'assistant' ? 'assistant' : 'user',
                content: c.content
            }));

            if (provider === 'openai') {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API ËØ∑Ê±ÇÂ§±Ë¥•');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            if (provider === 'anthropic') {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01',
                        'content-type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API ËØ∑Ê±ÇÂ§±Ë¥•');
                }

                const data = await response.json();
                return data.content[0].text;
            }

            if (provider === 'google') {
                const response = await fetch('https://generativelanguage.googleapis.com/v1/models/' + model + ':generateContent?key=' + apiKey, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: messages.map(m => ({
                            role: m.role === 'user' ? 'user' : 'model',
                            parts: [{ text: m.content }]
                        })),
                        generationConfig: {
                            maxOutputTokens: 1000,
                            temperature: 0.9
                        }
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'API ËØ∑Ê±ÇÂ§±Ë¥•');
                }

                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            }

            if (provider === 'ollama') {
                const response = await fetch(apiKey + '/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: messages,
                        stream: false
                    })
                });

                if (!response.ok) {
                    throw new Error('Ollama ËØ∑Ê±ÇÂ§±Ë¥•');
                }

                const data = await response.json();
                return data.message.content;
            }

            throw new Error('‰∏çÊîØÊåÅÁöÑ provider: ' + provider);
        }

        function getStatusText(status) {
            const texts = {
                'running': 'ËøêË°å‰∏≠',
                'waiting': 'Á≠âÂæÖ‰∏≠',
                'completed': 'Â∑≤ÂÆåÊàê',
                'failed': 'Â§±Ë¥•'
            };
            return texts[status] || status;
        }

        // ÂÖ≥Èó≠ËØ¶ÊÉÖÈù¢Êùø
        function closeDetails() {
            document.getElementById('detailsPanel').classList.add('collapsed');
        }

        // Ê∑ªÂä†Êñ∞ Agent
        function addNewAgent() {
            const roles = Object.keys(agentRoles);
            const newId = Math.max(...agents.map(a => a.id), 0) + 1;
            const newRole = roles[Math.floor(Math.random() * roles.length)];
            const newAgent = {
                id: newId,
                name: `Agent ${newId}`,
                role: newRole,
                status: 'waiting',
                x: 200 + Math.random() * 400,
                y: 100 + Math.random() * 400
            };
            agents.push(newAgent);
            renderAgents();
            renderFlow();
            selectAgent(newId);

            // ÂπøÊí≠ÁªôÂçè‰ΩúËÄÖ
            if (collaborationStatus !== 'disconnected') {
                notifyCollaborators('add-agent', { agent: newAgent });
            }
        }

        // Êó∂Èó¥Á∫øÊéßÂà∂
        function togglePlay() {
            isPlaying = !isPlaying;
            document.getElementById('playIcon').innerHTML = isPlaying
                ? '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>'
                : '<polygon points="5 3 19 12 5 21 5 3"/>';

            if (isPlaying) {
                animate();
            } else {
                cancelAnimationFrame(animationId);
            }
        }

        function animate() {
            if (!isPlaying) return;
            currentTime += 0.1;
            if (currentTime >= messages.length) {
                currentTime = 0;
            }
            updateTimeline();
            animationId = requestAnimationFrame(animate);
        }

        function updateTimeline() {
            const progress = (currentTime / Math.max(messages.length, 1)) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            const currentM = Math.floor(currentTime);
            const totalM = messages.length;
            document.getElementById('timelineTime').textContent = `${currentM}:${Math.floor((currentTime % 1) * 60).toString().padStart(2, '0')} / ${totalM}:00`;
        }

        function skipToStart() {
            currentTime = 0;
            updateTimeline();
        }

        function skipToEnd() {
            currentTime = Math.max(0, messages.length - 1);
            updateTimeline();
        }

        function stepForward() {
            currentTime = Math.min(currentTime + 1, messages.length - 1);
            updateTimeline();
        }

        function stepBackward() {
            currentTime = Math.max(currentTime - 1, 0);
            updateTimeline();
        }

        function seekTimeline(event) {
            const rect = event.target.getBoundingClientRect();
            const percent = (event.clientX - rect.left) / rect.width;
            currentTime = percent * Math.max(0, messages.length - 1);
            updateTimeline();
        }

        // ÂØºÂá∫ÂäüËÉΩ
        function exportPNG() {
            alert('ÂØºÂá∫ PNG ÂäüËÉΩÂºÄÂèë‰∏≠...');
        }

        // Âä†ËΩΩÂ∑•‰ΩúÊµÅÊï∞ÊçÆ
        function loadWorkflowData(data) {
            if (!data || !data.agents) return;

            // ÈáçÁΩÆÁä∂ÊÄÅ
            agents = data.agents.map(a => ({
                ...a,
                status: a.status || 'waiting'
            }));
            messages = data.messages || [];
            connections = data.connections || [];

            // ÈáçÊñ∞Ê∏≤Êüì
            renderAgents();
            renderFlow();
            updateTimeline();
            clearSelection();
        }

        function exportJSON() {
            const data = {
                agents: agents,
                messages: messages,
                exportedAt: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agent-workflow.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ÂàùÂßãÂåñ
        initDemo();
        checkUrlForTemplate();

        // ======== Three.js 3D Âú∫ÊôØÂäüËÉΩ ========

        function init3DScene() {
            const container = document.getElementById('visualization');
            const canvas = document.getElementById('threeCanvas');

            // Âú∫ÊôØ
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0f172a);

            // Áõ∏Êú∫
            camera = new THREE.PerspectiveCamera(60, container.clientWidth / container.clientHeight, 0.1, 1000);
            camera.position.set(0, 300, 500);

            // Ê∏≤ÊüìÂô®
            renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(window.devicePixelRatio);

            // ËΩ®ÈÅìÊéßÂà∂
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.minDistance = 200;
            controls.maxDistance = 1000;

            // ÁÅØÂÖâ
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);

            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(100, 200, 100);
            scene.add(directionalLight);

            const pointLight = new THREE.PointLight(0x8b5cf6, 0.5, 500);
            pointLight.position.set(0, 100, 0);
            scene.add(pointLight);

            // ÁΩëÊ†ºÂú∞Èù¢
            const gridHelper = new THREE.GridHelper(800, 20, 0x334155, 0x1e293b);
            scene.add(gridHelper);

            // Âä®ÁîªÊó∂Èíü
            animationClock = new THREE.Clock();

            // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥
            window.addEventListener('resize', onWindowResize);
        }

        function onWindowResize() {
            const container = document.getElementById('visualization');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function createAgentMesh(agent) {
            const role = agentRoles[agent.role] || { color: '#6b7280', icon: 'ü§ñ' };
            const color = new THREE.Color(role.color || '#6b7280');

            // Agent ‰∏ª‰Ωì - 3D ÁêÉ‰Ωì
            const geometry = new THREE.SphereGeometry(30, 32, 32);
            const material = new THREE.MeshPhongMaterial({
                color: color,
                emissive: color,
                emissiveIntensity: 0.3,
                shininess: 100
            });
            const mesh = new THREE.Mesh(geometry, material);

            // ‰ΩçÁΩÆÊò†Â∞Ñ (2D -> 3D)
            mesh.position.x = (agent.x - 400) * 0.8;
            mesh.position.y = 30;
            mesh.position.z = (agent.y - 300) * 0.8;
            mesh.userData = { agentId: agent.id };

            // ÂÖâÊôïÊïàÊûú
            const glowGeometry = new THREE.SphereGeometry(35, 32, 32);
            const glowMaterial = new THREE.MeshBasicMaterial({
                color: color,
                transparent: true,
                opacity: 0.2
            });
            const glow = new THREE.Mesh(glowGeometry, glowMaterial);
            mesh.add(glow);

            // Áä∂ÊÄÅÊåáÁ§∫Âô®
            const statusColors = {
                'running': 0x22c55e,
                'waiting': 0xeab308,
                'completed': 0x6b7280,
                'failed': 0xef4444
            };
            const statusColor = statusColors[agent.status] || 0x6b7280;

            const statusGeometry = new THREE.RingGeometry(38, 42, 32);
            const statusMaterial = new THREE.MeshBasicMaterial({
                color: statusColor,
                transparent: true,
                opacity: 0.8,
                side: THREE.DoubleSide
            });
            const statusRing = new THREE.Mesh(statusGeometry, statusMaterial);
            statusRing.rotation.x = Math.PI / 2;
            mesh.add(statusRing);

            // Ê∑ªÂä†Âà∞Âú∫ÊôØ
            scene.add(mesh);
            agentMeshes.push(mesh);

            return mesh;
        }

        function updateAgentMeshes() {
            // Ê∏ÖÈô§ÊóßÁöÑ mesh
            agentMeshes.forEach(mesh => {
                scene.remove(mesh);
            });
            agentMeshes = [];

            // ÈáçÊñ∞ÂàõÂª∫
            agents.forEach(agent => {
                createAgentMesh(agent);
            });
        }

        function createMessageParticle(fromAgent, toAgent) {
            const from = new THREE.Vector3(
                (fromAgent.x - 400) * 0.8,
                30,
                (fromAgent.y - 300) * 0.8
            );
            const to = new THREE.Vector3(
                (toAgent.x - 400) * 0.8,
                30,
                (toAgent.y - 300) * 0.8
            );

            // ÂàõÂª∫Á≤íÂ≠ê
            const geometry = new THREE.SphereGeometry(5, 16, 16);
            const material = new THREE.MeshBasicMaterial({
                color: 0x8b5cf6,
                transparent: true,
                opacity: 0.8
            });
            const particle = new THREE.Mesh(geometry, material);

            particle.position.copy(from);
            particle.userData = {
                start: from,
                end: to,
                progress: 0,
                speed: 0.01
            };

            scene.add(particle);
            messageParticles.push(particle);

            return particle;
        }

        function updateMessageParticles() {
            // Ê∏ÖÈô§ÊóßÁöÑÁ≤íÂ≠ê
            messageParticles.forEach(p => scene.remove(p));
            messageParticles = [];

            // ÂàõÂª∫Êñ∞ÁöÑÁ≤íÂ≠ê
            messages.forEach(msg => {
                const fromAgent = agents.find(a => a.id === msg.from);
                const toAgent = agents.find(a => a.id === msg.to);
                if (fromAgent && toAgent) {
                    createMessageParticle(fromAgent, toAgent);
                }
            });
        }

        function animate3D() {
            if (!is3DMode) return;

            requestAnimationFrame(animate3D);
            controls.update();

            // Á≤íÂ≠êÂä®Áîª
            messageParticles.forEach(particle => {
                particle.userData.progress += particle.userData.speed;
                if (particle.userData.progress > 1) {
                    particle.userData.progress = 0;
                }

                const t = particle.userData.progress;
                particle.position.lerpVectors(
                    particle.userData.start,
                    particle.userData.end,
                    t
                );

                // ËÑâÂÜ≤ÊïàÊûú
                const scale = 1 + Math.sin(t * Math.PI * 4) * 0.3;
                particle.scale.set(scale, scale, scale);
            });

            // ÊóãËΩ¨ÊïàÊûú
            agentMeshes.forEach(mesh => {
                mesh.rotation.y += 0.01;
            });

            renderer.render(scene, camera);
        }

        function toggle3DView() {
            is3DMode = !is3DMode;
            const svgCanvas = document.getElementById('flowCanvas');
            const threeCanvas = document.getElementById('threeCanvas');
            const viewToggle = document.getElementById('viewToggle');

            if (is3DMode) {
                // ÂàáÊç¢Âà∞ 3D
                svgCanvas.style.display = 'none';
                threeCanvas.style.display = 'block';
                viewToggle.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <line x1="3" y1="9" x2="21" y2="9"/>
                        <line x1="9" y1="21" x2="9" y2="9"/>
                    </svg>
                    2D ËßÜÂõæ
                `;

                if (!scene) {
                    init3DScene();
                }
                updateAgentMeshes();
                updateMessageParticles();
                animate3D();

                // ÊòæÁ§∫Êìç‰ΩúÊèêÁ§∫
                const hint = document.getElementById('viewHint');
                hint.classList.add('show');
                setTimeout(() => hint.classList.remove('show'), 3000);
            } else {
                // ÂàáÊç¢Âà∞ 2D
                svgCanvas.style.display = 'block';
                threeCanvas.style.display = 'none';
                viewToggle.innerHTML = `
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                        <path d="M2 17l10 5 10-5"/>
                        <path d="M2 12l10 5 10-5"/>
                    </svg>
                    3D ËßÜÂõæ
                `;
            }
        }

        // ÂØºÂá∫Êó∂ÂêåÊ≠• 3D Êï∞ÊçÆ
        const originalExportJSON = exportJSON;
        exportJSON = function() {
            const data = {
                agents: agents,
                messages: messages,
                exportedAt: new Date().toISOString(),
                viewMode: is3DMode ? '3D' : '2D'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'agent-workflow.json';
            a.click();
            URL.revokeObjectURL(url);
        };

        // ======== API Key Management ========

        // API Keys Â≠òÂÇ®
        let apiKeys = {
            openai: [],
            anthropic: [],
            google: [],
            ollama: []
        };

        // Âä†ËΩΩÂ≠òÂÇ®ÁöÑ API Keys
        function loadApiKeys() {
            const stored = localStorage.getItem('agentVisualizer_apiKeys');
            if (stored) {
                apiKeys = JSON.parse(stored);
            }
            updateAllKeyStatus();
            renderKeysList();
        }

        // ‰øùÂ≠ò API Keys Âà∞ localStorage
        function saveApiKeysToStorage() {
            localStorage.setItem('agentVisualizer_apiKeys', JSON.stringify(apiKeys));
        }

        // ÊâìÂºÄ API Keys Modal
        function openApiKeysModal() {
            document.getElementById('apiKeysModal').classList.add('show');
            loadApiKeys();
        }

        // ÂÖ≥Èó≠ API Keys Modal
        function closeApiKeysModal() {
            document.getElementById('apiKeysModal').classList.remove('show');
        }

        // ÊâìÂºÄÊ®°Êùø Modal
        function openTemplateModal() {
            renderTemplates();
            document.getElementById('templateModal').classList.add('show');
        }

        // ÂÖ≥Èó≠Ê®°Êùø Modal
        function closeTemplateModal() {
            document.getElementById('templateModal').classList.remove('show');
        }

        // ======== ‰øùÂ≠òÊ®°ÊùøÂäüËÉΩ ========
        function openSaveTemplateModal() {
            renderMyTemplates();
            document.getElementById('saveTemplateModal').classList.add('show');
            document.getElementById('shareLinkSection').style.display = 'none';
            document.getElementById('templateName').value = '';
            document.getElementById('templateDesc').value = '';
        }

        function closeSaveTemplateModal() {
            document.getElementById('saveTemplateModal').classList.remove('show');
        }

        // Ëé∑ÂèñÂΩìÂâçÂ∑•‰ΩúÊµÅÊï∞ÊçÆ
        function getCurrentWorkflowData() {
            const agents = window.agents || [];
            const messages = window.messages || [];
            const connections = window.connections || [];
            return { agents, messages, connections };
        }

        // ‰øùÂ≠òÊ®°ÊùøÂà∞Êú¨Âú∞
        function saveTemplateToLocal() {
            const name = document.getElementById('templateName').value.trim();
            if (!name) {
                showNotification('ËØ∑ËæìÂÖ•Ê®°ÊùøÂêçÁß∞', 'error');
                return;
            }

            const data = getCurrentWorkflowData();
            if (data.agents.length === 0) {
                showNotification('ÂΩìÂâçÊ≤°Êúâ AgentÔºåÊó†Ê≥ï‰øùÂ≠òÊ®°Êùø', 'error');
                return;
            }

            const templates = JSON.parse(localStorage.getItem('myTemplates') || '[]');
            const template = {
                id: 'template_' + Date.now(),
                name: name,
                desc: document.getElementById('templateDesc').value.trim(),
                data: data,
                createdAt: new Date().toISOString()
            };
            templates.push(template);
            localStorage.setItem('myTemplates', JSON.stringify(templates));

            showNotification('Ê®°Êùø‰øùÂ≠òÊàêÂäü', 'success');
            renderMyTemplates();
        }

        // ÁâàÊú¨ÂéÜÂè≤ÂäüËÉΩ
        function getVersions() {
            return JSON.parse(localStorage.getItem('workflowVersions') || '[]');
        }

        function saveVersions(versions) {
            localStorage.setItem('workflowVersions', JSON.stringify(versions));
        }

        function saveVersion() {
            const data = getCurrentWorkflowData();
            if (data.agents.length === 0) {
                showNotification('ÂΩìÂâçÊ≤°Êúâ AgentÔºåÊó†Ê≥ï‰øùÂ≠òÁâàÊú¨', 'error');
                return;
            }

            const versions = getVersions();
            const version = {
                id: 'v_' + Date.now(),
                name: 'ÁâàÊú¨ ' + (versions.length + 1),
                data: data,
                createdAt: new Date().toISOString(),
                agentCount: data.agents.length,
                messageCount: data.messages.length
            };
            versions.unshift(version); // Ê∑ªÂä†Âà∞ÊúÄÂâçÈù¢

            // ÊúÄÂ§ö‰øùÂ≠ò 20 ‰∏™ÁâàÊú¨
            if (versions.length > 20) {
                versions.pop();
            }

            saveVersions(versions);
            renderVersionList();
            showNotification('ÁâàÊú¨‰øùÂ≠òÊàêÂäü', 'success');
        }

        function renderVersionList() {
            const container = document.getElementById('versionList');
            const versions = getVersions();

            if (versions.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">ÊöÇÊó†ÁâàÊú¨ËÆ∞ÂΩï</p>';
                return;
            }

            container.innerHTML = versions.map((v, index) => `
                <div class="version-item" style="background: var(--bg-tertiary); padding: 12px; border-radius: 8px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;" onclick="restoreVersion('${v.id}')">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                        <span style="font-weight: 500;">${v.name}</span>
                        <span style="font-size: 12px; color: var(--text-secondary);">${formatDate(v.createdAt)}</span>
                    </div>
                    <div style="font-size: 12px; color: var(--text-secondary);">
                        ${v.agentCount} ‰∏™ Agent ¬∑ ${v.messageCount} Êù°Ê∂àÊÅØ
                    </div>
                </div>
            `).join('');
        }

        function formatDate(isoString) {
            const date = new Date(isoString);
            return date.toLocaleString('zh-CN', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
        }

        function restoreVersion(versionId) {
            const versions = getVersions();
            const version = versions.find(v => v.id === versionId);
            if (!version) {
                showNotification('ÁâàÊú¨‰∏çÂ≠òÂú®', 'error');
                return;
            }

            if (confirm(`Á°ÆÂÆöË¶ÅÊÅ¢Â§ç "${version.name}" ÂêóÔºüÂΩìÂâçÂ∑•‰ΩúÊµÅÂ∞ÜË¢´Ë¶ÜÁõñ„ÄÇ`)) {
                agents = version.data.agents.map(a => ({ ...a, status: 'waiting' }));
                messages = version.data.messages || [];
                window.connections = version.data.connections || [];

                renderAgents();
                renderConnections();
                renderAgentList();
                closeVersionHistoryModal();
                showNotification('ÁâàÊú¨ÊÅ¢Â§çÊàêÂäü', 'success');
            }
        }

        function clearAllVersions() {
            if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÁâàÊú¨ÂéÜÂè≤ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊÅ¢Â§ç„ÄÇ')) {
                saveVersions([]);
                renderVersionList();
                showNotification('ÁâàÊú¨ÂéÜÂè≤Â∑≤Ê∏ÖÁ©∫', 'success');
            }
        }

        function openVersionHistoryModal() {
            document.getElementById('versionHistoryModal').classList.add('show');
            renderVersionList();
        }

        function closeVersionHistoryModal() {
            document.getElementById('versionHistoryModal').classList.remove('show');
        }

        // ========== ÂÆûÊó∂Âçè‰ΩúÂäüËÉΩ ==========
        let peer = null;
        let connections = [];
        let isHost = false;
        let currentSessionId = null;
        let collaborationStatus = 'disconnected'; // disconnected, hosting, joined
        let peerSelections = {}; // Track which agent each peer is editing

        // Âçè‰ΩúÁä∂ÊÄÅÊåáÁ§∫Âô®
        let collaborationIndicator = null;

        function createCollaborationIndicator() {
            if (collaborationIndicator) return;
            const indicator = document.createElement('div');
            indicator.id = 'collabIndicator';
            indicator.style.cssText = `
                position: fixed;
                top: 70px;
                right: 20px;
                background: linear-gradient(135deg, #22c55e, #16a34a);
                color: white;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 13px;
                font-weight: 500;
                display: none;
                align-items: center;
                gap: 8px;
                z-index: 1000;
                box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);
                animation: pulse 2s infinite;
            `;
            indicator.innerHTML = `
                <span style="width: 8px; height: 8px; background: white; border-radius: 50%;"></span>
                <span id="collabStatusText">Âçè‰Ωú‰∏≠</span>
            `;
            document.body.appendChild(indicator);
            collaborationIndicator = indicator;
        }

        function updateCollaborationIndicator(status, peerCount = 0) {
            if (!collaborationIndicator) createCollaborationIndicator();
            const indicator = collaborationIndicator;
            const statusText = document.getElementById('collabStatusText');

            if (status === 'connected') {
                indicator.style.display = 'flex';
                indicator.style.background = 'linear-gradient(135deg, #22c55e, #16a34a)';
                statusText.textContent = peerCount > 0 ? `Âçè‰Ωú‰∏≠ (${peerCount + 1}‰∫∫)` : 'Âçè‰Ωú‰∏≠';
            } else if (status === 'hosting') {
                indicator.style.display = 'flex';
                indicator.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
                statusText.textContent = peerCount > 0 ? `ÊàøÈó¥Â∑≤ÂàõÂª∫ (${peerCount + 1}‰∫∫)` : 'Á≠âÂæÖÂä†ÂÖ•';
            } else {
                indicator.style.display = 'none';
            }
        }

        function openCollaborationModal() {
            document.getElementById('collaborationModal').classList.add('show');
            updateCollaborationView();
        }

        function closeCollaborationModal() {
            document.getElementById('collaborationModal').classList.remove('show');
        }

        function updateCollaborationView() {
            const setup = document.getElementById('collaborationSetup');
            const active = document.getElementById('collaborationActive');
            const joined = document.getElementById('collaborationJoined');

            if (collaborationStatus === 'disconnected') {
                setup.style.display = 'block';
                active.style.display = 'none';
                joined.style.display = 'none';
            } else if (collaborationStatus === 'hosting') {
                setup.style.display = 'none';
                active.style.display = 'block';
                joined.style.display = 'none';
                document.getElementById('currentSessionId').textContent = currentSessionId;
                updatePeerList();
            } else if (collaborationStatus === 'joined') {
                setup.style.display = 'none';
                active.style.display = 'none';
                joined.style.display = 'block';
                document.getElementById('currentSessionId').textContent = currentSessionId;
                updateJoinedPeerList();
            }
        }

        function generateSessionId() {
            return 'av-' + Math.random().toString(36).substr(2, 6) + '-' + Date.now().toString(36);
        }

        async function startCollaboration() {
            try {
                const sessionId = generateSessionId();
                currentSessionId = sessionId;
                isHost = true;

                // ÂàõÂª∫ PeerJS ÂÆû‰æã
                peer = new Peer(sessionId, {
                    debug: 0
                });

                peer.on('open', (id) => {
                    console.log('Created collaboration room:', id);
                    collaborationStatus = 'hosting';
                    updateCollaborationView();
                    updateCollaborationIndicator('hosting', 0);
                    showNotification('Âçè‰ΩúÊàøÈó¥Â∑≤ÂàõÂª∫ÔºÅÂàÜ‰∫´ÊàøÈó¥ ID ÁªôÂÖ∂‰ªñ‰∫∫', 'success');
                });

                peer.on('connection', (conn) => {
                    handleNewConnection(conn);
                });

                peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    showNotification('ÂàõÂª∫Âçè‰ΩúÂ§±Ë¥•: ' + err.message, 'error');
                });

            } catch (err) {
                console.error('Error starting collaboration:', err);
                showNotification('ÂàõÂª∫Âçè‰ΩúÂ§±Ë¥•: ' + err.message, 'error');
            }
        }

        async function joinCollaboration() {
            const sessionId = document.getElementById('joinSessionId').value.trim();
            if (!sessionId) {
                showNotification('ËØ∑ËæìÂÖ•ÊàøÈó¥ ID', 'error');
                return;
            }

            try {
                currentSessionId = sessionId;
                isHost = false;

                peer = new Peer({
                    debug: 0
                });

                peer.on('open', () => {
                    console.log('Joining collaboration room:', sessionId);
                    const conn = peer.connect(sessionId, {
                        reliable: true
                    });

                    conn.on('open', () => {
                        console.log('Connected to host');
                        connections.push(conn);
                        collaborationStatus = 'joined';
                        updateCollaborationView();
                        updateCollaborationIndicator('connected', 0);

                        // ËØ∑Ê±ÇÂêåÊ≠•ÂΩìÂâçÂ∑•‰ΩúÊµÅ
                        conn.send({
                            type: 'sync-request'
                        });

                        showNotification('Â∑≤Âä†ÂÖ•Âçè‰ΩúÊàøÈó¥ÔºÅ', 'success');
                    });

                    conn.on('data', (data) => {
                        handleCollaborationData(data, conn);
                    });

                    conn.on('close', () => {
                        showNotification('‰∏éÊàøÈó¥ÁöÑËøûÊé•Â∑≤Êñ≠ÂºÄ', 'warning');
                        leaveCollaboration();
                    });
                });

                peer.on('error', (err) => {
                    console.error('Peer error:', err);
                    if (err.type === 'peer-unavailable') {
                        showNotification('ÊàøÈó¥‰∏çÂ≠òÂú®ÊàñÂ∑≤ÂÖ≥Èó≠', 'error');
                    } else {
                        showNotification('Âä†ÂÖ•Âçè‰ΩúÂ§±Ë¥•: ' + err.message, 'error');
                    }
                });

            } catch (err) {
                console.error('Error joining collaboration:', err);
                showNotification('Âä†ÂÖ•Âçè‰ΩúÂ§±Ë¥•: ' + err.message, 'error');
            }
        }

        function handleNewConnection(conn) {
            connections.push(conn);

            conn.on('open', () => {
                console.log('New peer connected:', conn.peer);
                updatePeerList();
                updateCollaborationIndicator('hosting', connections.length);

                // ‰Ωú‰∏∫ hostÔºåÂèëÈÄÅÂΩìÂâçÂ∑•‰ΩúÊµÅÁªôÊñ∞ËøûÊé•ÁöÑ peer
                const workflowData = getCurrentWorkflowData();
                conn.send({
                    type: 'sync',
                    data: workflowData
                });
            });

            conn.on('data', (data) => {
                handleCollaborationData(data, conn);
            });

            conn.on('close', () => {
                connections = connections.filter(c => c !== conn);
                // Ê∏ÖÈô§ËØ• peer ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
                Object.keys(peerSelections).forEach(peerId => {
                    if (connections.findIndex(c => c.peer === peerId) === -1) {
                        delete peerSelections[peerId];
                    }
                });
                updatePeerList();
                updateCollaborationIndicator('hosting', connections.length);
                renderFlow();
            });
        }

        function handleCollaborationData(data, conn) {
            switch (data.type) {
                case 'sync':
                    // Êî∂Âà∞ÂÆåÊï¥Â∑•‰ΩúÊµÅÊï∞ÊçÆÔºåÂêåÊ≠•Êú¨Âú∞
                    console.log('Received workflow sync');
                    syncWorkflowFromRemote(data.data);
                    break;
                case 'sync-request':
                    // host Êî∂Âà∞ÂêåÊ≠•ËØ∑Ê±ÇÔºåÂèëÈÄÅÂΩìÂâçÂ∑•‰ΩúÊµÅ
                    if (isHost) {
                        const workflowData = getCurrentWorkflowData();
                        conn.send({
                            type: 'sync',
                            data: workflowData
                        });
                    }
                    break;
                case 'update':
                    // Êî∂Âà∞Â¢ûÈáèÊõ¥Êñ∞
                    console.log('Received incremental update');
                    applyRemoteUpdate(data.data);
                    break;
                case 'selection':
                    // Êî∂Âà∞ÂÖ∂‰ªñÁî®Êà∑ÈÄâ‰∏≠ÁöÑ Agent
                    console.log('Received peer selection:', data.data);
                    handlePeerSelection(data.data, conn);
                    break;
                case 'cursor':
                    // Êî∂Âà∞ÂÖâÊ†á‰ΩçÁΩÆÊõ¥Êñ∞ÔºàÂèØÈÄâÔºâ
                    break;
            }
        }

        // Â§ÑÁêÜÂÖ∂‰ªñÁî®Êà∑ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ
        function handlePeerSelection(data, conn) {
            // ËÆ∞ÂΩïËØ• peer ÈÄâ‰∏≠ÁöÑ agent
            const peerId = data.peerId;
            peerSelections[peerId] = data.agentId;

            // Â¶ÇÊûúÊòØ hostÔºåÂ∞ÜËøô‰∏™ÈÄâÊã©ÂπøÊí≠ÁªôÂÖ∂‰ªñÊâÄÊúâËøûÊé•ËÄÖ
            if (isHost) {
                connections.forEach(c => {
                    if (c !== conn && c.open) {
                        c.send({
                            type: 'selection',
                            data: data
                        });
                    }
                });
            }

            // ÈáçÊñ∞Ê∏≤ÊüìÊµÅÁ®ãÂõæ‰ª•ÊòæÁ§∫ÈÄâ‰∏≠Áä∂ÊÄÅ
            renderFlow();
        }

        function getCurrentWorkflowData() {
            return {
                agents: JSON.parse(JSON.stringify(agents)),
                messages: JSON.parse(JSON.stringify(messages)),
                connections: JSON.parse(JSON.stringify(connections || [])),
                groups: JSON.parse(JSON.stringify(window.agentGroups || [])),
                timestamp: Date.now()
            };
        }

        function syncWorkflowFromRemote(data) {
            // ÊöÇÊó∂Á¶ÅÁî®Ëá™Âä®‰øùÂ≠òÔºåÈÅøÂÖçÂÜ≤Á™Å
            const prevAutoSave = autoSaveEnabled;
            autoSaveEnabled = false;

            try {
                if (data.agents) {
                    agents = data.agents;
                    renderAgents();
                }
                if (data.messages) {
                    messages = data.messages;
                    renderConnections();
                }
                if (data.connections) {
                    window.connections = data.connections;
                }
                if (data.groups) {
                    window.agentGroups = data.groups;
                    renderGroupButtons();
                }
                showNotification('Â∑•‰ΩúÊµÅÂ∑≤ÂêåÊ≠•', 'success');
            } finally {
                autoSaveEnabled = prevAutoSave;
            }
        }

        function applyRemoteUpdate(data) {
            // Â¢ûÈáèÊõ¥Êñ∞Â§ÑÁêÜ
            if (data.action === 'add-agent') {
                agents.push(data.agent);
                renderAgents();
            } else if (data.action === 'update-agent') {
                const idx = agents.findIndex(a => a.id === data.agent.id);
                if (idx !== -1) {
                    agents[idx] = data.agent;
                    renderAgents();
                }
            } else if (data.action === 'delete-agent') {
                agents = agents.filter(a => a.id !== data.agentId);
                messages = messages.filter(m => m.from !== data.agentId && m.to !== data.agentId);
                renderAgents();
                renderConnections();
            } else if (data.action === 'add-message') {
                messages.push(data.message);
                renderConnections();
            }
        }

        function broadcastUpdate(data) {
            const message = {
                type: 'update',
                data: data
            };
            connections.forEach(conn => {
                if (conn.open) {
                    conn.send(message);
                }
            });
        }

        function updatePeerList() {
            const list = document.getElementById('peerList');
            const count = document.getElementById('peerCount');

            count.textContent = connections.length;

            if (connections.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 10px;">Á≠âÂæÖÂÖ∂‰ªñÁî®Êà∑Âä†ÂÖ•...</p>';
            } else {
                list.innerHTML = connections.map((conn, idx) => `
                    <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px;">
                        <span>üë§ Áî®Êà∑ ${idx + 1}</span>
                        <span style="color: var(--success);">‚óè Â∑≤ËøûÊé•</span>
                    </div>
                `).join('');
            }
        }

        function updateJoinedPeerList() {
            const list = document.getElementById('joinedPeerList');
            const count = document.getElementById('joinedPeerCount');

            count.textContent = connections.length + 1; // +1 for host

            list.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: space-between; padding: 8px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px;">
                    <span>üë§ Êàø‰∏ª</span>
                    <span style="color: var(--success);">‚óè Âú®Á∫ø</span>
                </div>
            `;
        }

        function copySessionId() {
            if (currentSessionId) {
                navigator.clipboard.writeText(currentSessionId).then(() => {
                    showNotification('ÊàøÈó¥ ID Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
                }).catch(() => {
                    showNotification('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂', 'error');
                });
            }
        }

        function leaveCollaboration() {
            // ÂÖ≥Èó≠ÊâÄÊúâËøûÊé•
            connections.forEach(conn => conn.close());
            connections = [];

            // ÂÖ≥Èó≠ peer
            if (peer) {
                peer.destroy();
                peer = null;
            }

            collaborationStatus = 'disconnected';
            currentSessionId = null;
            isHost = false;
            peerSelections = {}; // Ê∏ÖÈô§ÊâÄÊúâ peer ÁöÑÈÄâ‰∏≠Áä∂ÊÄÅ

            updateCollaborationIndicator('disconnected');
            updateCollaborationView();
            renderFlow();
            showNotification('Â∑≤Á¶ªÂºÄÂçè‰Ωú', 'info');
        }

        // Êã¶Êà™Â∑•‰ΩúÊµÅ‰øÆÊîπÊìç‰ΩúÔºåËá™Âä®ÂêåÊ≠•
        const originalAddAgent = window.addAgent;
        const originalUpdateAgent = window.updateAgent;
        const originalDeleteAgent = window.deleteAgent;
        const originalAddMessage = window.addMessage;

        // Âú®‰øÆÊîπÊï∞ÊçÆÂêéËá™Âä®ÂπøÊí≠
        function notifyCollaborators(action, data) {
            if (collaborationStatus === 'disconnected') return;
            if (isHost) {
                broadcastUpdate({ action, ...data });
            }
        }

        // Ëá™Âä®‰øùÂ≠òÂ∑•‰ΩúÊµÅÔºàÊØè10ÁßíÊàñÂÖ≥ÈîÆÊìç‰ΩúÊó∂Ôºâ
        let autoSaveEnabled = true;
        let lastSavedData = '';

        function getWorkflowHash() {
            const data = getCurrentWorkflowData();
            return JSON.stringify(data);
        }

        function autoSaveWorkflow() {
            if (!autoSaveEnabled) return;
            const currentData = getWorkflowHash();
            if (currentData === lastSavedData) return; // Ê≤°ÊúâÂèòÂåñÔºå‰∏ç‰øùÂ≠ò

            const workflowData = {
                agents: window.agents || [],
                messages: window.messages || [],
                connections: window.connections || [],
                savedAt: new Date().toISOString()
            };

            localStorage.setItem('agentVisualizer_autosave', JSON.stringify(workflowData));
            lastSavedData = currentData;

            // Êõ¥Êñ∞‰øùÂ≠òÁä∂ÊÄÅÊåáÁ§∫Âô®
            updateAutoSaveIndicator(true);
        }

        function updateAutoSaveIndicator(saved) {
            const indicator = document.getElementById('autoSaveIndicator');
            if (indicator) {
                indicator.textContent = saved ? 'Â∑≤Ëá™Âä®‰øùÂ≠ò' : '‰øùÂ≠ò‰∏≠...';
                indicator.className = saved ? 'auto-save-indicator saved' : 'auto-save-indicator saving';
                setTimeout(() => {
                    indicator.textContent = 'Â∑≤Ëá™Âä®‰øùÂ≠ò';
                    indicator.className = 'auto-save-indicator saved';
                }, 2000);
            }
        }

        function loadAutoSavedWorkflow() {
            const saved = localStorage.getItem('agentVisualizer_autosave');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.agents && data.agents.length > 0) {
                        // ÊúâËá™Âä®‰øùÂ≠òÁöÑÊï∞ÊçÆÔºåËØ¢ÈóÆÁî®Êà∑ÊòØÂê¶ÊÅ¢Â§ç
                        return data;
                    }
                } catch (e) {
                    console.error('Failed to load auto-save:', e);
                }
            }
            return null;
        }

        // ÊØè10ÁßíËá™Âä®‰øùÂ≠ò
        setInterval(autoSaveWorkflow, 10000);

        // ÂÖ≥ÈîÆÊìç‰ΩúÂêéÁ´ãÂç≥‰øùÂ≠ò
        function triggerAutoSave() {
            autoSaveWorkflow();
        }

        // Ëá™Âä®‰øùÂ≠òÁâàÊú¨ÔºàÂΩì Agent Êï∞ÈáèÂèòÂåñÊó∂Ôºâ
        let lastAgentCount = 0;
        setInterval(() => {
            if (agents.length > 0 && agents.length !== lastAgentCount) {
                lastAgentCount = agents.length;
                autoSaveWorkflow(); // Á´ãÂç≥‰øùÂ≠ò
            }
        }, 5000);

        // ÁîüÊàêÂàÜ‰∫´ÈìæÊé•
        function generateShareLink() {
            const name = document.getElementById('templateName').value.trim();
            if (!name) {
                showNotification('ËØ∑ËæìÂÖ•Ê®°ÊùøÂêçÁß∞', 'error');
                return;
            }

            const data = getCurrentWorkflowData();
            if (data.agents.length === 0) {
                showNotification('ÂΩìÂâçÊ≤°Êúâ AgentÔºåÊó†Ê≥ïÁîüÊàêÈìæÊé•', 'error');
                return;
            }

            // ÂéãÁº©Êï∞ÊçÆÂπ∂ÁºñÁ†Å‰∏∫ URL ÂèÇÊï∞
            const templateData = {
                n: name,
                d: document.getElementById('templateDesc').value.trim(),
                a: data.agents.map(a => ({
                    id: a.id,
                    name: a.name,
                    role: a.role,
                    model: a.model,
                    status: 'waiting'
                })),
                m: data.messages,
                c: data.connections
            };

            // ‰ΩøÁî® Base64 ÁºñÁ†Å
            const encoded = btoa(encodeURIComponent(JSON.stringify(templateData)));
            const shareUrl = window.location.origin + window.location.pathname + '?template=' + encoded;

            document.getElementById('shareLinkInput').value = shareUrl;
            document.getElementById('shareLinkSection').style.display = 'block';
        }

        // Â§çÂà∂ÂàÜ‰∫´ÈìæÊé•
        function copyShareLink() {
            const input = document.getElementById('shareLinkInput');
            input.select();
            document.execCommand('copy');
            showNotification('ÈìæÊé•Â∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø', 'success');
        }

        // Ê∏≤ÊüìÊàëÁöÑÊ®°ÊùøÂàóË°®
        function renderMyTemplates() {
            const list = document.getElementById('myTemplatesList');
            const templates = JSON.parse(localStorage.getItem('myTemplates') || '[]');

            if (templates.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px;">ÊöÇÊó†‰øùÂ≠òÁöÑÊ®°Êùø</p>';
                return;
            }

            list.innerHTML = templates.map(t => `
                <div class="my-template-item" onclick="loadMyTemplate('${t.id}')">
                    <div class="my-template-info">
                        <div class="my-template-name">${t.name}</div>
                        <div class="my-template-desc">${t.desc || 'Êó†ÊèèËø∞'} ¬∑ ${t.data.agents.length} ‰∏™ Agent</div>
                    </div>
                    <div class="my-template-actions" onclick="event.stopPropagation()">
                        <button class="my-template-btn load" onclick="loadMyTemplate('${t.id}')">Âä†ËΩΩ</button>
                        <button class="my-template-btn delete" onclick="deleteMyTemplate('${t.id}')">Âà†Èô§</button>
                    </div>
                </div>
            `).join('');
        }

        // Âä†ËΩΩÊàëÁöÑÊ®°Êùø
        function loadMyTemplate(templateId) {
            const templates = JSON.parse(localStorage.getItem('myTemplates') || '[]');
            const template = templates.find(t => t.id === templateId);
            if (!template) return;

            loadWorkflowData(template.data);
            closeSaveTemplateModal();
            showNotification(`Â∑≤Âä†ËΩΩÊ®°Êùø: ${template.name}`, 'success');
        }

        // Âà†Èô§ÊàëÁöÑÊ®°Êùø
        function deleteMyTemplate(templateId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ê®°ÊùøÂêóÔºü')) return;

            let templates = JSON.parse(localStorage.getItem('myTemplates') || '[]');
            templates = templates.filter(t => t.id !== templateId);
            localStorage.setItem('myTemplates', JSON.stringify(templates));
            renderMyTemplates();
            showNotification('Ê®°ÊùøÂ∑≤Âà†Èô§', 'success');
        }

        // ======== ÂàÜÁªÑÂäüËÉΩ ========
        let agentGroups = JSON.parse(localStorage.getItem('agentGroups') || '[]');

        // ÊâìÂºÄÂàÜÁªÑ Modal
        function openGroupModal() {
            renderGroupsList();
            document.getElementById('groupModal').classList.add('show');
        }

        // ÂÖ≥Èó≠ÂàÜÁªÑ Modal
        function closeGroupModal() {
            document.getElementById('groupModal').classList.remove('show');
        }

        // ÂàõÂª∫ÂàÜÁªÑ
        function createGroup() {
            const name = document.getElementById('newGroupName').value.trim();
            const color = document.getElementById('newGroupColor').value;

            if (!name) {
                showNotification('ËØ∑ËæìÂÖ•ÂàÜÁªÑÂêçÁß∞', 'error');
                return;
            }

            if (agentGroups.find(g => g.name === name)) {
                showNotification('ÂàÜÁªÑÂêçÁß∞Â∑≤Â≠òÂú®', 'error');
                return;
            }

            agentGroups.push({
                id: 'group_' + Date.now(),
                name: name,
                color: color,
                agents: []
            });

            saveGroups();
            renderGroupsList();
            renderAgents();
            document.getElementById('newGroupName').value = '';
            showNotification('ÂàÜÁªÑÂàõÂª∫ÊàêÂäü', 'success');
        }

        // Âà†Èô§ÂàÜÁªÑ
        function deleteGroup(groupId) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂàÜÁªÑÂêóÔºü')) return;

            agentGroups = agentGroups.filter(g => g.id !== groupId);
            saveGroups();
            renderGroupsList();
            renderAgents();
            showNotification('ÂàÜÁªÑÂ∑≤Âà†Èô§', 'success');
        }

        // Â∞Ü Agent Ê∑ªÂä†Âà∞ÂàÜÁªÑ
        function addAgentToGroup(agentId, groupId) {
            // ‰ªéÊâÄÊúâÂàÜÁªÑ‰∏≠ÁßªÈô§
            agentGroups.forEach(g => {
                g.agents = g.agents.filter(a => a !== agentId);
            });

            // Ê∑ªÂä†Âà∞ÊåáÂÆöÂàÜÁªÑ
            const group = agentGroups.find(g => g.id === groupId);
            if (group && !group.agents.includes(agentId)) {
                group.agents.push(agentId);
            }

            saveGroups();
            renderGroupsList();
            renderAgents();
        }

        // Â∞Ü Agent ‰ªéÂàÜÁªÑ‰∏≠ÁßªÈô§
        function removeAgentFromGroup(agentId, groupId) {
            const group = agentGroups.find(g => g.id === groupId);
            if (group) {
                group.agents = group.agents.filter(a => a !== agentId);
                saveGroups();
                renderGroupsList();
                renderAgents();
            }
        }

        // ‰øùÂ≠òÂàÜÁªÑÂà∞ localStorage
        function saveGroups() {
            localStorage.setItem('agentGroups', JSON.stringify(agentGroups));
        }

        // Ê∏≤ÊüìÂàÜÁªÑÂàóË°®
        function renderGroupsList() {
            const list = document.getElementById('groupsList');

            if (agentGroups.length === 0) {
                list.innerHTML = '<p style="color: var(--text-secondary); font-size: 13px; text-align: center; padding: 20px;">ÊöÇÊó†ÂàÜÁªÑÔºåËØ∑ÂÖàÂàõÂª∫ÂàÜÁªÑ</p>';
                return;
            }

            list.innerHTML = agentGroups.map(group => {
                const groupAgents = agents.filter(a => group.agents.includes(a.id));
                const ungroupedAgents = agents.filter(a => !agentGroups.some(g => g.agents.includes(a.id)));

                return `
                    <div class="agent-group" style="margin-bottom: 16px; padding: 12px; background: var(--bg-primary); border-radius: 8px;">
                        <div class="agent-group-header" style="margin-bottom: 12px;">
                            <div class="agent-group-title">
                                <span style="width: 12px; height: 12px; border-radius: 50%; background: ${group.color};"></span>
                                ${group.name}
                                <span class="agent-group-count">${groupAgents.length}</span>
                            </div>
                            <div class="agent-group-actions">
                                <button class="agent-group-btn delete" onclick="deleteGroup('${group.id}')" title="Âà†Èô§ÂàÜÁªÑ">√ó</button>
                            </div>
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 8px;">Â∞Ü Agent ÊãñÂÖ•ÂàÜÁªÑ:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 6px;">
                            ${agents.map(a => `
                                <div class="agent-draggable" draggable="true" ondragstart="dragAgent(event, '${a.id}', '${group.id}')"
                                     style="padding: 6px 12px; background: ${group.agents.includes(a.id) ? group.color + '30' : 'var(--bg-tertiary)'};
                                            border: 1px solid ${group.agents.includes(a.id) ? group.color : 'transparent'};
                                            border-radius: 6px; cursor: grab; font-size: 12px; display: flex; align-items: center; gap: 6px;">
                                    <span>${agentRoles[a.role]?.icon || 'ü§ñ'}</span>
                                    <span>${a.name}</span>
                                    ${group.agents.includes(a.id) ? `<span onclick="removeAgentFromGroup('${a.id}', '${group.id}'); event.stopPropagation();" style="cursor:pointer;color:var(--text-secondary)">√ó</span>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ÊãñÊãΩ Agent
        function dragAgent(event, agentId, groupId) {
            event.dataTransfer.setData('agentId', agentId);
            event.dataTransfer.setData('targetGroupId', groupId);
        }

        // Ëé∑Âèñ Agent ÊâÄÂ±ûÂàÜÁªÑ
        function getAgentGroup(agentId) {
            return agentGroups.find(g => g.agents.includes(agentId));
        }

        // Ê£ÄÊü• URL ÂèÇÊï∞Âπ∂Âä†ËΩΩÂàÜ‰∫´ÁöÑÊ®°Êùø
        function checkUrlForTemplate() {
            const params = new URLSearchParams(window.location.search);
            const templateParam = params.get('template');

            if (templateParam) {
                try {
                    const decoded = JSON.parse(decodeURIComponent(atob(templateParam)));
                    const workflowData = {
                        agents: decoded.a || [],
                        messages: decoded.m || [],
                        connections: decoded.c || []
                    };
                    loadWorkflowData(workflowData);
                    showNotification(`Â∑≤Âä†ËΩΩÂàÜ‰∫´ÁöÑÊ®°Êùø: ${decoded.n}`, 'success');

                    // Ê∏ÖÈô§ URL ÂèÇÊï∞
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (e) {
                    console.error('Failed to load template from URL:', e);
                    showNotification('Êó†ÊïàÁöÑÊ®°ÊùøÈìæÊé•', 'error');
                }
            }
        }

        // ======== ÂØºÂÖ•ÂäüËÉΩ ========
        let importedData = null;

        function openImportModal() {
            document.getElementById('importModal').classList.add('show');
            importedData = null;
            document.getElementById('importPreview').style.display = 'none';
            document.getElementById('confirmImportBtn').disabled = true;
            setupImportDropZone();
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.remove('show');
            importedData = null;
        }

        function setupImportDropZone() {
            const dropZone = document.getElementById('importDropZone');
            const fileInput = document.getElementById('importFileInput');

            // ÁÇπÂáªÈÄâÊã©Êñá‰ª∂
            dropZone.onclick = () => fileInput.click();

            // Êñá‰ª∂ÈÄâÊã©
            fileInput.onchange = (e) => {
                if (e.target.files.length > 0) {
                    handleImportFile(e.target.files[0]);
                }
            };

            // ÊãñÊãΩ‰∫ã‰ª∂
            dropZone.ondragover = (e) => {
                e.preventDefault();
                dropZone.classList.add('drag-over');
            };

            dropZone.ondragleave = () => {
                dropZone.classList.remove('drag-over');
            };

            dropZone.ondrop = (e) => {
                e.preventDefault();
                dropZone.classList.remove('drag-over');
                if (e.dataTransfer.files.length > 0) {
                    handleImportFile(e.dataTransfer.files[0]);
                }
            };
        }

        function handleImportFile(file) {
            if (!file.name.endsWith('.json')) {
                showNotification('ËØ∑ÈÄâÊã© JSON Êñá‰ª∂', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    importedData = JSON.parse(e.target.result);

                    // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                    if (!importedData.agents || !Array.isArray(importedData.agents)) {
                        throw new Error('Êó†ÊïàÁöÑÂ∑•‰ΩúÊµÅÊñá‰ª∂');
                    }

                    // ÊòæÁ§∫È¢ÑËßà‰ø°ÊÅØ
                    const preview = document.getElementById('importPreview');
                    const content = document.getElementById('importPreviewContent');
                    const agentCount = importedData.agents.length;
                    const messageCount = importedData.messages ? importedData.messages.length : 0;

                    content.innerHTML = `
                        <p><strong>Agents:</strong> ${agentCount} ‰∏™</p>
                        <p><strong>Messages:</strong> ${messageCount} Êù°</p>
                        <p><strong>ÂØºÂá∫Êó∂Èó¥:</strong> ${importedData.exportedAt || 'Êú™Áü•'}</p>
                    `;
                    preview.style.display = 'block';
                    document.getElementById('confirmImportBtn').disabled = false;

                } catch (err) {
                    showNotification('Êñá‰ª∂Ëß£ÊûêÂ§±Ë¥•: ' + err.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function importJSON() {
            if (!importedData) return;

            // Ê∏ÖÈô§Áé∞ÊúâÊï∞ÊçÆ
            agents = [];
            messages = [];

            // ÂØºÂÖ• Agents
            importedData.agents.forEach(agent => {
                agents.push({
                    id: agent.id,
                    name: agent.name,
                    role: agent.role,
                    status: agent.status || 'waiting',
                    x: agent.x || 100,
                    y: agent.y || 100
                });
            });

            // ÂØºÂÖ• Messages
            if (importedData.messages) {
                importedData.messages.forEach(msg => {
                    messages.push({
                        id: msg.id,
                        from: msg.from,
                        to: msg.to,
                        content: msg.content,
                        timestamp: msg.timestamp || 0
                    });
                });
            }

            // Ê∏≤ÊüìÁïåÈù¢
            renderAgents();
            renderFlow();

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            closeImportModal();

            showNotification(`Â∑≤ÂØºÂÖ•Â∑•‰ΩúÊµÅ: ${agents.length} ‰∏™ Agents`, 'success');
        }

        // Ê∏≤ÊüìÊ®°ÊùøÂàóË°®
        function renderTemplates() {
            const grid = document.getElementById('templateGrid');
            grid.innerHTML = workflowTemplates.map(template => `
                <div class="template-card" onclick="loadTemplate('${template.id}')">
                    <div class="template-card-header">
                        <span class="template-icon">${template.icon}</span>
                        <span class="template-name">${template.name}</span>
                    </div>
                    <div class="template-desc">${template.desc}</div>
                    <div class="template-agents">
                        ${template.agents.map(a => `<span class="template-agent-tag">${agentRoles[a]?.icon || ''} ${a}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        // Âä†ËΩΩÊ®°Êùø
        function loadTemplate(templateId) {
            const template = workflowTemplates.find(t => t.id === templateId);
            if (!template) return;

            // Ê∏ÖÈô§Áé∞ÊúâÊï∞ÊçÆ
            agents = [];
            messages = [];

            // ÂàõÂª∫ Agents
            const agentMap = {};
            template.positions.forEach((pos, index) => {
                const newId = index + 1;
                const role = agentRoles[pos.role] || agentRoles['Developer'];
                const newAgent = {
                    id: newId,
                    name: pos.role,
                    role: pos.role,
                    status: 'waiting',
                    x: pos.x,
                    y: pos.y
                };
                agents.push(newAgent);
                agentMap[pos.role] = newId;
            });

            // ÂàõÂª∫Ê∂àÊÅØÊµÅ
            template.messageFlows.forEach((flow, index) => {
                const fromId = agentMap[flow.from];
                const toId = agentMap[flow.to];
                if (fromId && toId) {
                    messages.push({
                        id: index + 1,
                        from: fromId,
                        to: toId,
                        content: flow.content,
                        timestamp: index
                    });
                }
            });

            // Ê∏≤ÊüìÁïåÈù¢
            renderAgents();
            renderFlow();

            // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
            closeTemplateModal();

            // ÊòæÁ§∫ÈÄöÁü•
            showNotification(`Â∑≤Âä†ËΩΩÊ®°Êùø: ${template.name}`, 'success');
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                background: ${type === 'success' ? '#22c55e' : type === 'error' ? '#ef4444' : '#3b82f6'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                animation: slideIn 0.3s ease;
            `;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // ÊâπÈáèÈÄâÊã©Áõ∏ÂÖ≥ÂèòÈáè
        let batchMode = false;
        let selectedAgents = new Set();

        // ÂÖãÈöÜÂ∑•‰ΩúÊµÅ
        function cloneWorkflow() {
            if (agents.length === 0) {
                showNotification('Ê≤°ÊúâÂèØÂÖãÈöÜÁöÑÂ∑•‰ΩúÊµÅ', 'warning');
                return;
            }

            // Ê∑±Êã∑Ë¥ù agents Âíå messages
            const clonedAgents = agents.map(agent => ({
                ...agent,
                id: Date.now() + Math.random(),
                name: agent.name + ' (ÂÖãÈöÜ)',
                status: 'waiting',
                messages: []
            }));

            const clonedMessages = messages.map(msg => ({
                ...msg,
                id: Date.now() + Math.random(),
                fromId: clonedAgents.find(a => a.name === agents.find(oa => oa.id === msg.fromId)?.name + ' (ÂÖãÈöÜ)')?.id || msg.fromId,
                toId: clonedAgents.find(a => a.name === agents.find(oa => oa.id === msg.toId)?.name + ' (ÂÖãÈöÜ)')?.id || msg.toId
            }));

            // ÈáçÊñ∞Êò†Â∞ÑÊ∂àÊÅØ‰∏≠ÁöÑ fromId Âíå toId
            const idMap = {};
            agents.forEach((agent, idx) => {
                idMap[agent.id] = clonedAgents[idx].id;
            });

            const remappedMessages = messages.map(msg => ({
                ...msg,
                id: Date.now() + Math.random(),
                fromId: idMap[msg.fromId] || msg.fromId,
                toId: idMap[msg.toId] || msg.toId
            }));

            // Ê∑ªÂä†ÂÖãÈöÜÁöÑ agents Âíå messages
            agents = [...agents, ...clonedAgents];
            messages = [...messages, ...remappedMessages];

            renderAgents();
            renderFlow();
            showNotification(`ÂÖãÈöÜÂÆåÊàêÔºÅÂ∑≤Â§çÂà∂ ${clonedAgents.length} ‰∏™ Agent`, 'success');
        }

        // ÂàáÊç¢ÊâπÈáèÈÄâÊã©Ê®°Âºè
        function toggleBatchMode() {
            batchMode = !batchMode;
            selectedAgents.clear();

            const btn = document.getElementById('batchSelectBtn');
            const deleteBtn = document.getElementById('batchDeleteBtn');

            if (batchMode) {
                btn.classList.remove('btn-secondary');
                btn.classList.add('btn-primary');
                btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> ÈÄÄÂá∫Â§öÈÄâ`;
                showNotification('Â∑≤ËøõÂÖ•Â§öÈÄâÊ®°ÂºèÔºåÁÇπÂáª Agent ËøõË°åÈÄâÊã©', 'info');
            } else {
                btn.classList.remove('btn-primary');
                btn.classList.add('btn-secondary');
                btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Â§öÈÄâ`;
                deleteBtn.style.display = 'none';
            }

            renderAgents();
            renderFlow();
        }

        // ÂàáÊç¢ Agent ÈÄâÊã©Áä∂ÊÄÅ
        function toggleAgentSelection(agentId) {
            if (!batchMode) {
                selectAgent(agentId);
                return;
            }

            if (selectedAgents.has(agentId)) {
                selectedAgents.delete(agentId);
            } else {
                selectedAgents.add(agentId);
            }

            // Êõ¥Êñ∞Âà†Èô§ÊåâÈíÆÊòæÁ§∫
            const deleteBtn = document.getElementById('batchDeleteBtn');
            deleteBtn.style.display = selectedAgents.size > 0 ? 'inline-flex' : 'none';

            renderAgents();
            renderFlow();
        }

        // ÊâπÈáèÂà†Èô§ÈÄâ‰∏≠ÁöÑ Agent
        function batchDeleteSelected() {
            if (selectedAgents.size === 0) {
                showNotification('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÂà†Èô§ÁöÑ Agent', 'warning');
                return;
            }

            // Âà†Èô§ÈÄâ‰∏≠ÁöÑ agents
            agents = agents.filter(a => !selectedAgents.has(a.id));

            // Âà†Èô§Áõ∏ÂÖ≥ÁöÑÊ∂àÊÅØ
            messages = messages.filter(m => !selectedAgents.has(m.fromId) && !selectedAgents.has(m.toId));

            // Ê∏ÖÈô§ÈÄâÊã©Áä∂ÊÄÅ
            selectedAgents.clear();
            batchMode = false;

            // ÈáçÁΩÆÊåâÈíÆÁä∂ÊÄÅ
            const btn = document.getElementById('batchSelectBtn');
            const deleteBtn = document.getElementById('batchDeleteBtn');
            btn.classList.remove('btn-primary');
            btn.classList.add('btn-secondary');
            btn.innerHTML = `<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg> Â§öÈÄâ`;
            deleteBtn.style.display = 'none';

            // Ê∏ÖÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
            selectedAgent = null;

            renderAgents();
            renderFlow();
            closeDetails();

            // ÂπøÊí≠Âà†Èô§ÁªôÂçè‰ΩúËÄÖ
            if (collaborationStatus !== 'disconnected') {
                const deletedIds = Array.from(selectedAgents);
                deletedIds.forEach(agentId => {
                    notifyCollaborators('delete-agent', { agentId });
                });
            }

            showNotification(`Â∑≤Âà†Èô§ ${selectedAgents.size || 'ÈÄâ‰∏≠ÁöÑ'} ‰∏™ Agent`, 'success');
        }

        // ÊâπÈáèÁßªÂä®ÈÄâ‰∏≠ÁöÑ Agent
        function batchMoveSelected(dx, dy) {
            if (selectedAgents.size === 0) {
                showNotification('ËØ∑ÂÖàÈÄâÊã©Ë¶ÅÁßªÂä®ÁöÑ Agent', 'warning');
                return;
            }

            agents.forEach(agent => {
                if (selectedAgents.has(agent.id)) {
                    agent.x += dx;
                    agent.y += dy;
                }
            });

            renderFlow();
            showNotification(`Â∑≤ÁßªÂä® ${selectedAgents.size} ‰∏™ Agent`, 'success');
        }

        // ÊâπÈáèÈÄâÊã©Ê®°Âºè‰∏ãÊ∏≤Êüì Agent ËäÇÁÇπ
        function renderBatchSelectedNodes() {
            if (!batchMode) return;

            // ÈáçÊñ∞Ê∏≤Êüì‰ª•ÊòæÁ§∫ÈÄâÊã©Ê°Ü
            renderFlow();
        }

        // Êõ¥Êñ∞ Key Áä∂ÊÄÅÊåáÁ§∫Âô®
        function updateKeyStatus(provider) {
            let input, statusEl;
            if (provider === 'ollama') {
                input = document.getElementById('ollamaUrl');
            } else {
                input = document.getElementById(provider + 'Key');
            }
            statusEl = document.getElementById(provider + 'Status');

            if (input && statusEl) {
                if (input.value && input.value.length > 0) {
                    statusEl.classList.add('active');
                    statusEl.classList.remove('inactive');
                } else {
                    statusEl.classList.remove('active');
                    statusEl.classList.add('inactive');
                }
            }
        }

        // Êõ¥Êñ∞ÊâÄÊúâ Key Áä∂ÊÄÅ
        function updateAllKeyStatus() {
            ['openai', 'anthropic', 'google', 'ollama'].forEach(updateKeyStatus);
        }

        // Ê∏≤ÊüìÂ∑≤‰øùÂ≠òÁöÑ Keys ÂàóË°®
        function renderKeysList() {
            ['openai', 'anthropic', 'google'].forEach(provider => {
                const listEl = document.getElementById(provider + 'KeysList');
                if (!listEl) return;

                const keys = apiKeys[provider] || [];
                if (keys.length === 0) {
                    listEl.innerHTML = '';
                    return;
                }

                listEl.innerHTML = keys.map((key, idx) => `
                    <div class="api-key-item">
                        <span class="api-key-name">${key.name || 'Key ' + (idx + 1)}</span>
                        <span class="api-key-preview">${key.key.substring(0, 8)}...${key.key.substring(key.key.length - 4)}</span>
                        <button class="api-key-delete" onclick="deleteApiKey('${provider}', ${idx})" title="Âà†Èô§">üóëÔ∏è</button>
                    </div>
                `).join('');
            });
        }

        // ‰øùÂ≠ò API Key
        function saveApiKey(provider) {
            let keyValue, keyName;

            if (provider === 'ollama') {
                keyValue = document.getElementById('ollamaUrl').value.trim();
                keyName = 'Êú¨Âú∞ÊúçÂä°';
            } else {
                keyValue = document.getElementById(provider + 'Key').value.trim();
                keyName = provider + ' Key ' + ((apiKeys[provider]?.length || 0) + 1);
            }

            if (!keyValue) {
                alert('ËØ∑ËæìÂÖ• API Key');
                return;
            }

            // Ê∑ªÂä†Âà∞ÂàóË°®
            if (!apiKeys[provider]) {
                apiKeys[provider] = [];
            }
            apiKeys[provider].push({
                key: keyValue,
                name: keyName,
                createdAt: new Date().toISOString()
            });

            saveApiKeysToStorage();
            updateKeyStatus(provider);
            renderKeysList();

            // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
            if (provider !== 'ollama') {
                document.getElementById(provider + 'Key').value = '';
            }

            // ÊòæÁ§∫‰øùÂ≠òÊàêÂäü
            showNotification('API Key Â∑≤‰øùÂ≠ò', 'success');
        }

        // Âà†Èô§ API Key
        function deleteApiKey(provider, index) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ API Key ÂêóÔºü')) {
                apiKeys[provider].splice(index, 1);
                saveApiKeysToStorage();
                updateKeyStatus(provider);
                renderKeysList();
                showNotification('API Key Â∑≤Âà†Èô§', 'success');
            }
        }

        // ÊµãËØï API Key
        async function testApiKey(provider) {
            let keyValue;
            if (provider === 'ollama') {
                keyValue = document.getElementById('ollamaUrl').value.trim();
            } else {
                keyValue = document.getElementById(provider + 'Key').value.trim();
            }

            if (!keyValue) {
                alert('ËØ∑ÂÖàËæìÂÖ• API Key ËøõË°åÊµãËØï');
                return;
            }

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'ÊµãËØï‰∏≠...';
            btn.disabled = true;

            try {
                if (provider === 'openai') {
                    const response = await fetch('https://api.openai.com/v1/models', {
                        headers: { 'Authorization': 'Bearer ' + keyValue }
                    });
                    if (response.ok) {
                        showNotification('OpenAI API ËøûÊé•ÊàêÂäü!', 'success');
                    } else {
                        throw new Error('API Key Êó†Êïà');
                    }
                } else if (provider === 'anthropic') {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'x-api-key': keyValue,
                            'anthropic-version': '2023-06-01',
                            'content-type': 'application/json'
                        },
                        body: JSON.stringify({
                            model: 'claude-3-haiku-20240307',
                            max_tokens: 10,
                            messages: [{ role: 'user', content: 'Hi' }]
                        })
                    });
                    if (response.ok || response.status === 400) {
                        showNotification('Anthropic API ËøûÊé•ÊàêÂäü!', 'success');
                    } else {
                        throw new Error('API Key Êó†Êïà');
                    }
                } else if (provider === 'google') {
                    const response = await fetch('https://generativelanguage.googleapis.com/v1/models?key=' + keyValue);
                    if (response.ok) {
                        showNotification('Google API ËøûÊé•ÊàêÂäü!', 'success');
                    } else {
                        throw new Error('API Key Êó†Êïà');
                    }
                } else if (provider === 'ollama') {
                    const response = await fetch(keyValue + '/api/tags');
                    if (response.ok) {
                        const data = await response.json();
                        const models = data.models?.map(m => m.name).join(', ') || 'Êó†ÂèØÁî®Ê®°Âûã';
                        showNotification('Ollama ËøûÊé•ÊàêÂäü! ÂèØÁî®Ê®°Âûã: ' + models, 'success');
                    } else {
                        throw new Error('Êó†Ê≥ïËøûÊé•Âà∞ Ollama');
                    }
                }
            } catch (error) {
                showNotification('ÊµãËØïÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        // ÂØºÂá∫ÂØÜÈí•
        function exportKeys() {
            const data = {
                exportedAt: new Date().toISOString(),
                providers: {}
            };

            ['openai', 'anthropic', 'google', 'ollama'].forEach(provider => {
                data.providers[provider] = apiKeys[provider].map(k => ({
                    name: k.name,
                    key: k.key.substring(0, 4) + '****' + k.key.substring(k.key.length - 4),
                    createdAt: k.createdAt
                }));
            });

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'api-keys-backup.json';
            a.click();
            URL.revokeObjectURL(url);
            showNotification('ÂØÜÈí•Â§á‰ªΩÂ∑≤ÂØºÂá∫', 'success');
        }

        // ÊòæÁ§∫ÈÄöÁü•
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 80px;
                right: 20px;
                padding: 12px 20px;
                background: ${type === 'success' ? 'var(--success)' : 'var(--error)'};
                color: white;
                border-radius: 8px;
                font-size: 14px;
                z-index: 2000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // ÂàùÂßãÂåñ API Keys
        loadApiKeys();

        // Ê£ÄÊü•Âπ∂ÊÅ¢Â§çËá™Âä®‰øùÂ≠òÁöÑÂ∑•‰ΩúÊµÅ
        function checkAutoSave() {
            const saved = localStorage.getItem('agentVisualizer_autosave');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    if (data.agents && data.agents.length > 0) {
                        // ÊúâËá™Âä®‰øùÂ≠òÁöÑÊï∞ÊçÆÔºåËØ¢ÈóÆÁî®Êà∑ÊòØÂê¶ÊÅ¢Â§ç
                        const savedTime = data.savedAt ? new Date(data.savedAt).toLocaleString() : 'Êú™Áü•Êó∂Èó¥';
                        if (confirm('ÂèëÁé∞Êú™‰øùÂ≠òÁöÑÂ∑•‰ΩúÊµÅÔºåÊòØÂê¶Ë¶ÅÊÅ¢Â§çÔºü\n‰øùÂ≠òÊó∂Èó¥Ôºö' + savedTime + '\nÂåÖÂê´ ' + data.agents.length + ' ‰∏™ Agent')) {
                            window.agents = data.agents;
                            window.messages = data.messages || [];
                            window.connections = data.connections || [];
                            renderAgents();
                            renderFlow();
                            showNotification('Â∑≤ÊÅ¢Â§çËá™Âä®‰øùÂ≠òÁöÑÂ∑•‰ΩúÊµÅ', 'success');
                        }
                    }
                } catch (e) {
                    console.error('Failed to load auto-save:', e);
                }
            }
        }

        // È°µÈù¢Âä†ËΩΩÂêéÊ£ÄÊü•Ëá™Âä®‰øùÂ≠òÔºàÂª∂Ëøü‰∏Ä‰∏ãÁ°Æ‰øùÂÖ∂‰ªñÂàùÂßãÂåñÂÆåÊàêÔºâ
        setTimeout(checkAutoSave, 500);

        // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
        document.getElementById('apiKeysModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeApiKeysModal();
            }
        });
    </script>
</body>
</html>
